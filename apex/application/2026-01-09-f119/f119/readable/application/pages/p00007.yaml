---
# ====== Page: ChatPot - AI Assistant ========================
id: 7
identification: 
  name: ChatPot - AI Assistant
  alias: CHATPOT-AI-ASSISTANT2
  title: ChatPot - AI Assistant

appearance: 
  page-mode: Normal
  page-template: Theme Default
  template-options: 
  - '#DEFAULT#'

navigation-menu: 
  override-user-interface-level: false

navigation: 
  cursor-focus: Do not focus cursor
  warn-on-unsaved-changes: true

javascript: 
  function-and-global-variable-declaration: |2
     
    // ============================================================================
    // CHAT SESSION MANAGER
    // Manages current conversation context (like ChatGPT/Claude)
    // ============================================================================
    
    var chatApp = {
        currentSessionId: null,
        isInitialized: false,
        
        // ========================================================================
        // INITIALIZATION
        // ========================================================================
        
        /**
         * Initialize chat application on page load
         */
        init: function() {
            console.log('ChatApp: Initializing...');
            
            // Check if session_id passed via page item (from navigation)
            const sessionIdFromItem = apex.item('P100_SESSION_ID').getValue();
            
            if (sessionIdFromItem && sessionIdFromItem !== '') {
                console.log('ChatApp: Loading existing session:', sessionIdFromItem);
                this.loadSession(sessionIdFromItem);
            } else {
                console.log('ChatApp: No session found, getting or creating...');
                this.getOrCreateSession();
            }
    
            //this.updateSendButtonState();
        },
        
        // ========================================================================
        // SESSION OPERATIONS
        // ========================================================================
        
        /**
         * Get existing session or create new one
         */
        getOrCreateSession: function(modelProvider = 'OPENAI') {
            console.log('ChatApp: Getting or creating session...');
            
            apex.server.process(
                'GET_OR_CREATE_SESSION',
                {
                    x01: modelProvider  // Pass model provider
                },
                {
                    dataType: 'json',
                    loadingIndicator: '#chat-container',
                    success: function(data) {
                        if (data.status === 'success') {
                            console.log('ChatApp: Session ready:', data.session_id);
                            
                            chatApp.currentSessionId = data.session_id;
                            apex.item('P100_SESSION_ID').setValue(data.session_id);
                            
                            // Load messages for this session
                            chatApp.loadMessages();
                            
                            // Update UI
                            chatApp.updateSessionInfo(data);
                            
                            chatApp.isInitialized = true;
                            
                            // Show success if new session
                            if (data.is_new === 'true') {
                                apex.message.showPageSuccess('New conversation started');
                            }
                        } else {
                            console.error('ChatApp: Session initialization failed:', data.error_message);
                            apex.message.showErrors([{
                                type: 'error',
                                location: 'page',
                                message: 'Failed to initialize chat session: ' + data.error_message
                            }]);
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.error('ChatApp: AJAX error:', textStatus, errorThrown);
                        apex.message.showErrors([{
                            type: 'error',
                            location: 'page',
                            message: 'Unable to connect to chat service. Please refresh the page.'
                        }]);
                    }
                }
            );
        },
        
        /**
         * Create new chat session (like clicking "New Chat" button)
         */
        createNewSession: function(modelProvider = 'OPENAI') {
            console.log('ChatApp: Creating new session...');
            
            apex.server.process(
                'CREATE_NEW_SESSION',
                {
                    x01: modelProvider
                },
                {
                    dataType: 'json',
                    loadingIndicator: '#chat-container',
                    success: function(data) {
                        if (data.status === 'success') {
                            console.log('ChatApp: New session created:', data.session_id);
                            
                            chatApp.currentSessionId = data.session_id;
                            apex.item('P100_SESSION_ID').setValue(data.session_id);
                            
                            // Clear message display
                            chatApp.clearMessages();
                            
                            // Refresh session history sidebar
                            chatApp.refreshSessionList();
                            
                            apex.message.showPageSuccess(data.message);
                        } else {
                            apex.message.showErrors([{
                                type: 'error',
                                location: 'page',
                                message: 'Failed to create new session: ' + data.error_message
                            }]);
                        }
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        console.error('ChatApp: New session creation failed:', textStatus, errorThrown);
                        apex.message.showErrors([{
                            type: 'error',
                            location: 'page',
                            message: 'Unable to create new session.'
                        }]);
                    }
                }
            );
        },
        
        /**
         * Load specific session (when user clicks from history)
         */
        loadSession: function(sessionId) {
            console.log('ChatApp: Loading session:', sessionId);
            
            // Update current session
            this.currentSessionId = sessionId;
            apex.item('P100_SESSION_ID').setValue(sessionId);
            
            // Load messages
            this.loadMessages();
            
            // Update UI (optional: load session metadata)
            apex.server.process(
                'LOAD_SESSION_MESSAGES',
                {
                    x01: sessionId
                },
                {
                    dataType: 'json',
                    success: function(data) {
                        if (data.status === 'success') {
                            chatApp.updateSessionInfo(data);
                        }
                    }
                }
            );
        },
        
        // ========================================================================
        // MESSAGE OPERATIONS
        // ========================================================================
        
        /**
         * Load messages for current session
         */
        loadMessages: function() {
            console.log('ChatApp: Loading messages for session:', this.currentSessionId);
            
            // Refresh messages region (assumes region static ID = 'messages')
            if (apex.region('messages')) {
                apex.region('messages').refresh();
            }
        },
        
        /**
         * Clear message display (for new session)
         */
        clearMessages: function() {
            console.log('ChatApp: Clearing messages');
            
            // Clear message display area
            $('#messages-container').empty();
            
            // Or refresh region if empty
            if (apex.region('messages')) {
                apex.region('messages').refresh();
            }
        },
        
        /**
         * Send user message
         */
        sendMessage: function(messageContent) {
            if (!this.currentSessionId) {
                apex.message.showErrors([{
                    type: 'error',
                    location: 'page',
                    message: 'No active session. Please refresh the page.'
                }]);
                return;
            }
            
            console.log('ChatApp: Sending message to session:', this.currentSessionId);
            
            // Your existing message send logic here
            // This would call your RAG processing
        },
        
        // ========================================================================
        // UI UPDATES
        // ========================================================================
        
        /**
         * Update session info display
         */
        updateSessionInfo: function(sessionData) {
            // Update session title if element exists
            if ($('#current-session-title').length) {
                $('#current-session-title').text(sessionData.session_title || 'Conversation');
            }
            
            // Update message count if element exists
            if ($('#message-count').length) {
                $('#message-count').text(sessionData.message_count || 0);
            }
        },
        
        /**
         * Refresh session history list
         */
        refreshSessionList: function() {
            if (apex.region('session-history')) {
                apex.region('session-history').refresh();
            }
        },
    
    
    
        /**
     * Enable/disable send button based on prompt content
     */
    updateSendButtonState: function() {
        const promptValue = apex.item('P100_PROMPT').getValue();
        const sendButton = $('#SEND_BTN');
        
        if (promptValue && promptValue.trim().length > 0) {
            // Enable button
            sendButton.prop('disabled', false)
                     .removeClass('is-disabled')
                     .attr('aria-disabled', 'false');
        } else {
            // Disable button
            sendButton.prop('disabled', true)
                     .addClass('is-disabled')
                     .attr('aria-disabled', 'true');
        }
    },
        
        // ========================================================================
        // UTILITY FUNCTIONS
        // ========================================================================
        
        /**
         * Get current session ID
         */
        getCurrentSessionId: function() {
            return this.currentSessionId;
        },
        
        /**
         * Check if app is initialized
         */
        isReady: function() {
            return this.isInitialized && this.currentSessionId !== null;
        }
    };
    
    // ============================================================================
    // AUTO-INITIALIZE ON PAGE LOAD
    // ============================================================================
    apex.jQuery(document).ready(function() {
        chatApp.init();
    });
  execute-when-page-loads: |2
     document.addEventListener("DOMContentLoaded", function() {
      const settings = document.getElementById("advanced-settings");
      const toggleBtn = document.getElementById("toggle-settings");
      const chatArea = document.getElementById("chat-area");
      const sendBtn = document.getElementById("send-btn");
      const input = document.getElementById("chat-input");
    
      // Toggle advanced settings visibility
      toggleBtn.addEventListener("click", () => {
        settings.classList.toggle("hidden");
      });
    
      // Send chat message (simple mockup)
      sendBtn.addEventListener("click", () => {
        const msg = input.value.trim();
        if (!msg) return;
    
        // Add user message
        const userMsg = document.createElement("div");
        userMsg.className = "chat-message user";
        userMsg.textContent = msg;
        chatArea.appendChild(userMsg);
    
        // Scroll down
        chatArea.scrollTop = chatArea.scrollHeight;
    
        input.value = "";
    
        // Simulate bot reply
        setTimeout(() => {
          const botMsg = document.createElement("div");
          botMsg.className = "chat-message bot";
          botMsg.textContent = "Processing your query...";
          chatArea.appendChild(botMsg);
          chatArea.scrollTop = chatArea.scrollHeight;
        }, 500);
      });
    });

css: 
  inline: |2
     /* Disabled send button styling */
    .send-message-btn.is-disabled,
    .send-message-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        pointer-events: none;
    }
    
    .send-message-btn.is-disabled .t-Icon,
    .send-message-btn:disabled .t-Icon {
        opacity: 0.5;
    }
    
    /*//////////////////////////////*/
    .chat-container {
      display: flex;
      flex-direction: column;
      height: 90vh;
      background: #f9fafb;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      overflow: hidden;
      position: relative;
    }
    
    .chat-area {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
      background-color: #ffffff;
    }
    
    .chat-message {
      margin: 0.5rem 0;
      padding: 0.8rem 1rem;
      border-radius: 8px;
      max-width: 80%;
      line-height: 1.4;
    }
    
    .chat-message.user {
      background: #dbeafe;
      align-self: flex-end;
      margin-left: auto;
    }
    
    .chat-message.bot {
      background: #e5e7eb;
      align-self: flex-start;
    }
    
    .chat-message-thread {
      display: flex;
      align-items: center;
      padding: 0.8rem;
      border-top: 1px solid #e5e7eb;
      background: #fff;
    }
    
    .chat-input-bar textarea {
      flex: 1;
      resize: none;
      padding: 0.5rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 0.9rem;
    }
    
    .send-message-btn, .btn-settings {
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 8px;
      margin-left: 0.5rem;
      padding: 0.6rem 0.9rem;
      cursor: pointer;
    }
    
    .btn-settings {
      background: #6b7280;
    }
    
    .btn-send:hover, .btn-settings:hover {
      opacity: 0.9;
    }
    
    .advanced-settings {
      background: #f3f4f6;
      padding: 1rem;
      border-top: 1px solid #e5e7eb;
    }
    
    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
    }
    
    .hidden {
      display: none;
    }
    
    
    /* ============================================================================
       SEND BUTTON - DISABLED STATE
       ============================================================================ */
    
    /* Disabled button appearance */
    #SEND_BTN.is-disabled,
    #SEND_BTN:disabled,
    #SEND_BTN.apex_disabled {
        opacity: 0.5 !important;
        cursor: not-allowed !important;
        pointer-events: none !important;
        filter: grayscale(40%);
        transition: all 0.2s ease;
    }
    
    /* Disabled button icon */
    #SEND_BTN.is-disabled .t-Icon,
    #SEND_BTN:disabled .t-Icon {
        opacity: 0.5;
    }
    
    /* Prevent hover effects on disabled button */
    #SEND_BTN.is-disabled:hover,
    #SEND_BTN:disabled:hover {
        transform: none !important;
        box-shadow: none !important;
    }
    
    /* ============================================================================
       CHARACTER COUNTER
       ============================================================================ */
    
    .char-counter {
        font-size: 0.875rem;
        margin-top: 0.5rem;
        padding: 0.25rem 0.5rem;
        text-align: right;
        font-weight: 500;
        transition: all 0.3s ease;
        border-radius: 4px;
    }
    
    /* Empty state - no text entered */
    .char-counter-empty {
        color: #6c757d;
        background-color: #f8f9fa;
        font-style: italic;
    }
    
    /* Warning state - below minimum */
    .char-counter-warning {
        color: #ff9800;
        background-color: #fff3e0;
        font-weight: 600;
    }
    
    /* Error state - above maximum */
    .char-counter-error {
        color: #f44336;
        background-color: #ffebee;
        font-weight: 600;
        animation: pulse-error 2s ease-in-out infinite;
    }
    
    /* Valid state - within acceptable range */
    .char-counter-valid {
        color: #4caf50;
        background-color: #e8f5e9;
    }
    
    /* Pulse animation for errors */
    @keyframes pulse-error {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }
    
    /* ============================================================================
       RESPONSIVE DESIGN
       ============================================================================ */
    
    @media (max-width: 768px) {
        .char-counter {
            font-size: 0.75rem;
            padding: 0.2rem 0.4rem;
        }
    }
    
    /* ============================================================================
       ACCESSIBILITY
       ============================================================================ */
    
    /* High contrast mode support */
    @media (prefers-contrast: high) {
        .char-counter-warning {
            border: 2px solid #ff9800;
        }
        
        .char-counter-error {
            border: 2px solid #f44336;
        }
    }
    
    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
        .char-counter,
        #SEND_BTN {
            transition: none;
        }
        
        @keyframes pulse-error {
            0%, 100% { opacity: 1; }
        }
    }
    
    /* Override Oracle's default AVP label width on this page only */
    .t-AVPList--fixedLabelSmall {
      --ut-avp-label-width: 3rem !important;
    }
    
    /* ============================================================================
       FIX: APEX Grid Layout - Expand RIGHT when LEFT hidden
       ============================================================================ */
    
    /* LEFT PANEL parent (col col-3) */
    #LEFT_PANEL {
        transition: all 0.3s ease;
    }
    
    /* When LEFT_PANEL is hidden, hide its parent column */
    body:has(#LEFT_PANEL[style*="display: none"]) .col.col-3.col-start {
        display: none !important;
        width: 0 !important;
        flex: 0 0 0 !important;
    }
    
    /* RIGHT PANEL parent (col col-9) - expand to full width */
    body:has(#LEFT_PANEL[style*="display: none"]) .col.col-9.apex-col-auto.col-end {
        flex: 1 1 100% !important;
        max-width: 100% !important;
        width: 100% !important;
    }
    
    /* Smooth transitions */
    .col.col-3.col-start,
    .col.col-9.apex-col-auto.col-end {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    /* Keep row as flex ALWAYS */
    body .row,
    .t-Region-body > div[class*="row"] {
        display: flex !important;
        flex-wrap: nowrap !important;
    }
    
    /* Grid columns */
    .col {
        flex-shrink: 0;
    }
    
    
    /* ============================================
       CHATGPT-STYLE PROMPT INTERFACE
       Oracle AI ChatPot - Page 100
       ============================================ */
    
    /* 1. CONTAINER - Main prompt wrapper */
    .chatgpt-prompt-container {
      max-width: 1024px;
      margin: 40px auto;
      padding: 0 20px;
    }
    
    /* 2. INPUT WRAPPER - Rounded container with shadow */
    .prompt-input-wrapper {
      display: flex;
      align-items: center;
      gap: 12px;
      background: #ffffff;
      border: 1px solid #d1d5db;
      border-radius: 24px;
      padding: 12px 16px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      transition: all 0.2s ease;
    }
    
    .prompt-input-wrapper:focus-within {
      border-color: #3b82f6;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
    }
    
    /* 3. TEXTAREA - Auto-expanding input */
    .chatgpt-prompt-input {
      flex: 1;
      border: none;
      outline: none;
      resize: none;
      font-size: 16px;
      line-height: 1.5;
      max-height: 200px;
      overflow-y: auto;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    
    .chatgpt-prompt-input::placeholder {
      color: #9ca3af;
    }
    
    /* 4. ACTION BUTTONS - Plus, Mic, Voice Chat */
    .prompt-action-btn {
      width: 40px;
      height: 40px;
      border: none;
      background: transparent;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      color: #6b7280;
    }
    
    .prompt-action-btn:hover {
      background: #f3f4f6;
      color: #111827;
    }
    
    .prompt-action-btn:active {
      transform: scale(0.95);
    }
    
    /* Microphone Active State */
    .mic-toggle[data-mic-state="on"] {
      background: #ef4444;
      color: white;
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    /* 5. SUBMIT BUTTON - Primary action */
    .prompt-submit-btn {
      width: 40px;
      height: 40px;
      border: none;
      background: #3b82f6;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .prompt-submit-btn:hover {
      background: #2563eb;
      transform: scale(1.05);
    }
    
    .prompt-submit-btn:disabled {
      background: #d1d5db;
      cursor: not-allowed;
    }
    
    /* 6. FOOTER - Clear button */
    .prompt-footer {
      margin-top: 12px;
      text-align: center;
    }
    
    .prompt-clear-btn {
      border: none;
      background: transparent;
      color: #6b7280;
      font-size: 14px;
      cursor: pointer;
      padding: 8px 16px;
      border-radius: 8px;
    }
    
    .prompt-clear-btn:hover {
      background: #f3f4f6;
    }
    
    /* 7. RESPONSIVE DESIGN */
    @media (max-width: 768px) {
      .chatgpt-prompt-container {
        padding: 0 12px;
        margin: 20px auto;
      }
      
      .prompt-input-wrapper {
        padding: 10px 12px;
      }
      
      .prompt-action-btn,
      .prompt-submit-btn {
        width: 36px;
        height: 36px;
      }
    }

security: 
  authentication: Page Requires Authentication
  deep-linking: Application Default
  page-access-protection: Arguments Must Have Checksum
  form-auto-complete: Off
  browser-cache: Application Default

session-management: 
  rejoin-sessions: Application Default

advanced: 
  enable-duplicate-page-submissions: Yes - Enable page to be re-posted
  reload-on-submit: Only for Success

server-cache: 
  caching: Disabled

regions: 
- # ====== Region: New =========================================
  id: 137178709835539921
  identification: 
    name: New
    type: Static Content

  source: 
    html-code: |
      <!-- ChatGPT-Inspired Prompt Container -->
      <div class="chatgpt-prompt-container">
        <div class="prompt-input-wrapper">
          <!-- Plus Sign (New Chat/Attachment) -->
          <button class="prompt-action-btn" id="btn-new-chat" title="New Chat">
            <i class="fa fa-plus"></i>
          </button>
          
          <!-- Auto-Expanding Textarea -->
          <textarea id="P100_PROMPT" 
                    class="chatgpt-prompt-input" 
                    placeholder="Ask anything..."
                    rows="1"></textarea>
          
          <!-- Voice Controls Container -->
          <div class="prompt-voice-controls">
            <!-- Microphone Toggle -->
            <button class="prompt-action-btn mic-toggle" 
                    id="btn-mic-toggle" 
                    title="Toggle Microphone"
                    data-mic-state="off">
              <i class="fa fa-microphone"></i>
            </button>
            
            <!-- Voice Chat Mode -->
            <button class="prompt-action-btn voice-chat" 
                    id="btn-voice-chat" 
                    title="Voice Chat Mode">
              <svg class="voice-wave-icon" viewBox="0 0 24 24">
                <!-- Voice wave animation icon -->
              </svg>
            </button>
          </div>
          
          <!-- Submit/Send Button -->
          <button class="prompt-submit-btn" id="btn-submit" title="Send">
            <i class="fa fa-paper-plane"></i>
          </button>
        </div>
        
        <!-- Optional: Clear Button Below -->
        <div class="prompt-footer">
          <button class="prompt-clear-btn" id="btn-clear">
            <i class="fa fa-eraser"></i> Clear
          </button>
        </div>
      </div>
      

  layout: 
    sequence: 20
    parent-region: RIGHT_PANEL # 272689415877330251
    slot: SUB_REGIONS
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Standard
    template-options: 
    - '#DEFAULT#'
    - t-Region--scrollBody
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: session =====================================
  id: 272688711710330244
  identification: 
    name: session
    type: Static Content

  source: 
    html-code: |2
           <div style="font-family: monospace; padding: 20px; background: #f5f5f5;">
               <h2>Session Variables</h2>
               <table border="1" cellpadding="10">
                   <tr>
                       <td><strong>APP_USER</strong></td>
                       <td>&APP_USER.</td>
                   </tr>
                   <tr>
                       <td><strong>G_USER_ROLE_ID</strong></td>
                       <td>&G_USER_ROLE_ID.</td>
                   </tr>
                   <tr>
                       <td><strong>G_USER_ROLE_NAME</strong></td>
                       <td>&G_USER_ROLE_NAME.</td>
                   </tr>
                   <tr>
                       <td><strong>G_CLASSIFICATION_LEVEL</strong></td>
                       <td>&G_CLASSIFICATION_LEVEL.</td>
                   </tr>
                   <tr>
                       <td><strong>G_SESSION_START</strong></td>
                       <td>&G_SESSION_START.</td>
                   </tr>
                   <tr>
                       <td><strong>G_TENANT_ID</strong></td>
                       <td>&G_TENANT_ID.</td>
                   </tr>
                   <tr>
                       <td><strong>G_TENANT_CODE</strong></td>
                       <td>&G_TENANT_CODE.</td>
                   </tr>
                   <tr>
                       <td><strong>G_TENANT_NAME</strong></td>
                       <td>&G_TENANT_NAME.</td>
                   </tr>
               </table>
           </div>

  layout: 
    sequence: 30
    parent-region: No Parent
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Collapsible
    template-options: 
    - '#DEFAULT#'
    - js-useLocalStorage
    - is-collapsed
    - t-Region--scrollBody
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  configuration: 
    build-option: Commented Out # 123954063565486069

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: CONTAINER ===================================
  id: 272688960027330247
  identification: 
    name: CONTAINER
    type: Static Content

  layout: 
    sequence: 20
    parent-region: No Parent
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Blank with Attributes
    template-options: 
    - '#DEFAULT#'
    css-classes: 
    - chat-container
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: CHAT_HISTORY ================================
  id: 272689067922330248
  identification: 
    name: CHAT_HISTORY
    title: History
    type: Classic Report

  source: 
    location: Local Database
    type: SQL Query
    sql-query: |
      SELECT 
          session_id,
          session_title,
          TO_CHAR(last_activity_date, 'MM/DD HH24:MI') as last_activity,
          message_count,
          CASE 
              WHEN :P7_SESSION_ID IS NOT NULL 
                   AND session_id = TO_NUMBER(:P7_SESSION_ID) THEN 'active-session'
              ELSE ''
          END as css_class
      FROM ai_chat_sessions
      WHERE user_id =  (select user_id from users u where user_name =:APP_USER )
        AND is_active = 'Y'
      ORDER BY 
          is_pinned DESC,
          last_activity_date DESC
      FETCH FIRST 20 ROWS ONLY
    page-items-to-submit: 
    - P7_SESSION_ID

  order-by: 
    type: None

  layout: 
    sequence: 10
    parent-region: LEFT_PANEL # 274411879979675326
    slot: SUB_REGIONS
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Standard
    template-options: 
    - '#DEFAULT#'
    - t-Region--showIcon
    - t-Region--accent14
    - t-Region--scrollBody
    - t-Form--noPadding
    - t-Form--leftLabels
    css-classes: 
    - chat-sidebar
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    static-id: session-history
    region-display-selector: false
    exclude-title-from-translation: false

  server-cache: 
    caching: Disabled

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    layout: 
      number-of-rows-type: Static Value
      number-of-rows: 15

    appearance: 
      template-type: Theme
      template: Value Attribute Pairs - Row
      template-options: 
      - '#DEFAULT#'
      - t-AVPList--fixedLabelSmall
      - t-AVPList--leftAligned

    pagination: 
      type: Row Ranges X to Y (with next and previous links)
      display-position: Bottom - Right
      partial-page-refresh: true

    performance: 
      lazy-loading: false

    break-formatting: 
      break-columns: First Column
      style: Default Break Formatting

    advanced: 
      strip-html: false
      sort-nulls: Last

    heading: 
      type: Custom Headings

    download: 
      csv-export-enabled: false

    printing: 
      enabled: false

  columns: 
  - # ====== Column: SESSION_ID ==================================
    id: 137256261194135492
    identification: 
      column-name: SESSION_ID
      type: Hidden

    layout: 
      sequence: 10

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: SESSION_TITLE ===============================
    id: 137256603911135493
    identification: 
      column-name: SESSION_TITLE
      type: Link

    heading: 
      heading: Session Title
      alignment: start

    layout: 
      sequence: 30
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    link: 
      target: 
        url: 'f?p=&APP_ID.:100:&SESSION.::&DEBUG.:RP:P100_SESSION_ID:#SESSION_ID#'
        page: 100
        clear-cache: RP
        values: 
          p100_session_id: '#SESSION_ID#'

      link-text: '#SESSION_TITLE#'

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: false

  - # ====== Column: LAST_ACTIVITY ===============================
    id: 137257063696135494
    identification: 
      column-name: LAST_ACTIVITY
      type: Plain Text

    heading: 
      heading: Last Activity
      alignment: start

    layout: 
      sequence: 60
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

    configuration: 
      build-option: Commented Out # 123954063565486069

  - # ====== Column: MESSAGE_COUNT ===============================
    id: 137257489456135495
    identification: 
      column-name: MESSAGE_COUNT
      type: Hidden

    layout: 
      sequence: 50

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: CSS_CLASS ===================================
    id: 137257807382135496
    identification: 
      column-name: CSS_CLASS
      type: Hidden

    layout: 
      sequence: 70

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

- # ====== Region: SELECTED_SESSION ============================
  id: 272689211335330249
  identification: 
    name: SELECTED_SESSION
    type: Classic Report

  source: 
    location: Local Database
    type: SQL Query
    sql-query: |
      SELECT 
            message_id,
            session_id,
            message_seq,
            message_role,
            message_content,
            TO_CHAR(message_timestamp, 'HH24:MI:SS') AS time_display,
            token_count_total,
            processing_time_ms,
            CASE 
                WHEN message_role = 'USER' THEN 'user-message'
                WHEN message_role = 'ASSISTANT' THEN 'assistant-message'
                WHEN message_role = 'SYSTEM' THEN 'system-message'
            END AS message_css_class,
            CASE 
                WHEN message_role = 'USER' THEN 'üí¨'
                WHEN message_role = 'ASSISTANT' THEN 'ü§ñ'
                ELSE '‚ÑπÔ∏è'
            END AS role_icon,
            user_feedback,
            CASE 
                WHEN user_feedback = 'POSITIVE' THEN 'üëç'
                WHEN user_feedback = 'NEGATIVE' THEN 'üëé'
                ELSE ''
            END AS feedback_icon
        FROM ai_chat_messages
        WHERE session_id = :P7_SESSION_ID
        ORDER BY message_seq
    page-items-to-submit: 
    - P7_SESSION_ID

  order-by: 
    type: None

  layout: 
    sequence: 10
    parent-region: RIGHT_PANEL # 272689415877330251
    slot: SUB_REGIONS
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Blank with Attributes
    template-options: 
    - '#DEFAULT#'
    css-classes: 
    - chat-header-bar
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: false
    exclude-title-from-translation: false

  server-cache: 
    caching: Disabled

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    layout: 
      number-of-rows-type: Static Value
      number-of-rows: 15

    appearance: 
      template-type: Theme
      template: Standard
      template-options: 
      - '#DEFAULT#'
      - t-Report--stretch
      - t-Report--altRowsDefault
      - t-Report--rowHighlight
      - t-Report--noBorders

    pagination: 
      type: Row Ranges X to Y (with next and previous links)
      display-position: Bottom - Right
      partial-page-refresh: true

    performance: 
      lazy-loading: false

    break-formatting: 
      break-columns: No Break

    advanced: 
      strip-html: false
      sort-nulls: Last

    heading: 
      type: Custom Headings

    download: 
      csv-export-enabled: false

    printing: 
      enabled: false

  columns: 
  - # ====== Column: MESSAGE_ID ==================================
    id: 137241437692135450
    identification: 
      column-name: MESSAGE_ID
      type: Hidden

    layout: 
      sequence: 10

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: SESSION_ID ==================================
    id: 137241808590135451
    identification: 
      column-name: SESSION_ID
      type: Hidden

    layout: 
      sequence: 20

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: MESSAGE_SEQ =================================
    id: 137242276270135452
    identification: 
      column-name: MESSAGE_SEQ
      type: Hidden

    layout: 
      sequence: 30

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: MESSAGE_ROLE ================================
    id: 137242609986135453
    identification: 
      column-name: MESSAGE_ROLE
      type: Hidden

    layout: 
      sequence: 40

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: MESSAGE_CONTENT =============================
    id: 137243026883135454
    identification: 
      column-name: MESSAGE_CONTENT
      type: Plain Text

    heading: 
      heading: Message Content
      alignment: start

    layout: 
      sequence: 50
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    column-formatting: 
      html-expression: |2
         <div class="message-bubble #MESSAGE_CSS_CLASS#" data-message-id="#MESSAGE_ID#">
                  <div class="message-header">
                      <span class="role-label">#ROLE_ICON# #MESSAGE_ROLE#</span>
                      <span class="message-time">#TIME_DISPLAY#</span>
                  </div>
                  <div class="message-body">
                      #MESSAGE_CONTENT#
                  </div>
                  <div class="message-footer">
                      <button class="copy-btn" data-message-id="#MESSAGE_ID#">üìã Copy</button>
                      <button class="feedback-btn" data-message-id="#MESSAGE_ID#">#FEEDBACK_ICON#</button>
                      <span class="token-badge">#TOKEN_COUNT_TOTAL# tokens</span>
                  </div>
              </div>

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: false

  - # ====== Column: TIME_DISPLAY ================================
    id: 137243468054135455
    identification: 
      column-name: TIME_DISPLAY
      type: Hidden

    layout: 
      sequence: 60

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: TOKEN_COUNT_TOTAL ===========================
    id: 137243892938135456
    identification: 
      column-name: TOKEN_COUNT_TOTAL
      type: Hidden

    layout: 
      sequence: 70

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: PROCESSING_TIME_MS ==========================
    id: 137244279360135457
    identification: 
      column-name: PROCESSING_TIME_MS
      type: Hidden

    layout: 
      sequence: 80

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: MESSAGE_CSS_CLASS ===========================
    id: 137244620999135458
    identification: 
      column-name: MESSAGE_CSS_CLASS
      type: Hidden

    layout: 
      sequence: 90

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: ROLE_ICON ===================================
    id: 137245097478135459
    identification: 
      column-name: ROLE_ICON
      type: Hidden

    layout: 
      sequence: 100

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: USER_FEEDBACK ===============================
    id: 137245464780135460
    identification: 
      column-name: USER_FEEDBACK
      type: Hidden

    layout: 
      sequence: 110

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: FEEDBACK_ICON ===============================
    id: 137245848228135461
    identification: 
      column-name: FEEDBACK_ICON
      type: Hidden

    layout: 
      sequence: 120

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

- # ====== Region: RIGHT_PANEL =================================
  id: 272689415877330251
  identification: 
    name: RIGHT_PANEL
    type: Static Content

  layout: 
    sequence: 30
    parent-region: CONTAINER # 272688960027330247
    slot: SUB_REGIONS
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Blank with Attributes
    template-options: 
    - '#DEFAULT#'
    - margin-top-none
    - margin-bottom-none
    - margin-left-none
    - margin-right-none
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    static-id: RIGHT_PANEL
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: PROMPT ======================================
  id: 272689500662330252
  identification: 
    name: PROMPT
    type: Static Content

  layout: 
    sequence: 30
    parent-region: RIGHT_PANEL # 272689415877330251
    slot: SUB_REGIONS
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Blank with Attributes
    template-options: 
    - '#DEFAULT#'
    css-classes: 
    - chat-message-thread
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: ADVANCED_SETTINGS ===========================
  id: 272689715447330254
  identification: 
    name: ADVANCED_SETTINGS
    title: Advanced Settings
    type: Static Content

  layout: 
    sequence: 40
    parent-region: RIGHT_PANEL # 272689415877330251
    slot: SUB_REGIONS
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Collapsible
    template-options: 
    - '#DEFAULT#'
    - js-useLocalStorage
    - t-Region--hideShowIconsMath
    - t-Region--controlsPosEnd
    - is-collapsed
    - t-Region--accent12
    - t-Region--noUI
    - t-Region--scrollBody
    - t-Form--labelsAbove
    css-classes: 
    - advanced-settings
    icon: fa-sliders-h
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    static-id: ADVANCED_SETTINGS
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: CHAT_SESSION ================================
  id: 273708050944923746
  identification: 
    name: CHAT_SESSION
    title: Current Chat session
    type: Classic Report

  source: 
    location: Local Database
    type: SQL Query
    sql-query: |
      SELECT 
          message_id,
          message_seq,
          message_role,
          message_content,
          TO_CHAR(message_timestamp, 'HH24:MI:SS') as time_display,
          token_count_total,
          processing_time_ms,
          CASE 
              WHEN message_role = 'USER' THEN 'user-message'
              WHEN message_role = 'ASSISTANT' THEN 'assistant-message'
              ELSE 'system-message'
          END as css_class
      FROM ai_chat_messages
      WHERE  session_id = TO_NUMBER(:P7_SESSION_ID) 
             AND :P7_SESSION_ID IS NOT NULL   
      ORDER BY message_seq
      
      
              
    page-items-to-submit: 
    - P7_SESSION_ID

  order-by: 
    type: None

  layout: 
    sequence: 10
    parent-region: session # 272688711710330244
    slot: SUB_REGIONS
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Standard
    template-options: 
    - '#DEFAULT#'
    - t-Region--scrollBody
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    static-id: messages
    region-display-selector: false
    exclude-title-from-translation: false

  server-cache: 
    caching: Disabled

  customization: 
    customizable: Not Customizable By End Users

  configuration: 
    build-option: Commented Out # 123954063565486069

  attributes: 
    layout: 
      number-of-rows-type: Static Value
      number-of-rows: 15

    appearance: 
      template-type: Theme
      template: Standard
      template-options: 
      - '#DEFAULT#'
      - t-Report--altRowsDefault
      - t-Report--rowHighlight

    pagination: 
      type: Row Ranges X to Y (with next and previous links)
      display-position: Bottom - Right
      partial-page-refresh: true

    performance: 
      lazy-loading: false

    break-formatting: 
      break-columns: No Break

    advanced: 
      strip-html: false
      sort-nulls: Last

    heading: 
      type: Custom Headings

    download: 
      csv-export-enabled: false

    printing: 
      enabled: false

  columns: 
  - # ====== Column: MESSAGE_ID ==================================
    id: 137236475021135435
    identification: 
      column-name: MESSAGE_ID
      type: Plain Text

    heading: 
      heading: Message Id
      alignment: end

    layout: 
      sequence: 10
      column-alignment: end

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: MESSAGE_SEQ =================================
    id: 137236826268135436
    identification: 
      column-name: MESSAGE_SEQ
      type: Plain Text

    heading: 
      heading: Message Seq
      alignment: end

    layout: 
      sequence: 20
      column-alignment: end

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: MESSAGE_ROLE ================================
    id: 137237226195135437
    identification: 
      column-name: MESSAGE_ROLE
      type: Plain Text

    heading: 
      heading: Message Role
      alignment: start

    layout: 
      sequence: 30
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: MESSAGE_CONTENT =============================
    id: 137237615351135438
    identification: 
      column-name: MESSAGE_CONTENT
      type: Plain Text

    heading: 
      heading: Message Content
      alignment: start

    layout: 
      sequence: 40
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: TIME_DISPLAY ================================
    id: 137238013597135439
    identification: 
      column-name: TIME_DISPLAY
      type: Plain Text

    heading: 
      heading: Time Display
      alignment: start

    layout: 
      sequence: 50
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: TOKEN_COUNT_TOTAL ===========================
    id: 137238414329135440
    identification: 
      column-name: TOKEN_COUNT_TOTAL
      type: Plain Text

    heading: 
      heading: Token Count Total
      alignment: end

    layout: 
      sequence: 60
      column-alignment: end

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: PROCESSING_TIME_MS ==========================
    id: 137238862808135441
    identification: 
      column-name: PROCESSING_TIME_MS
      type: Plain Text

    heading: 
      heading: Processing Time Ms
      alignment: end

    layout: 
      sequence: 70
      column-alignment: end

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: CSS_CLASS ===================================
    id: 137239200014135442
    identification: 
      column-name: CSS_CLASS
      type: Plain Text

    heading: 
      heading: Css Class
      alignment: start

    layout: 
      sequence: 80
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

- # ====== Region: LEFT_PANEL ==================================
  id: 274411879979675326
  identification: 
    name: LEFT_PANEL
    type: Static Content

  layout: 
    sequence: 10
    parent-region: CONTAINER # 272688960027330247
    slot: SUB_REGIONS
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: 3

  appearance: 
    template: Blank with Attributes
    template-options: 
    - '#DEFAULT#'
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    static-id: LEFT_PANEL
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: CTRL_BTN_BAR ================================
  id: 274411944049675327
  identification: 
    name: CTRL_BTN_BAR
    type: Static Content

  layout: 
    sequence: 20
    parent-region: No Parent
    slot: REGION_POSITION_01
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Buttons Container
    template-options: 
    - '#DEFAULT#'
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

page-items: 
- # ====== Page Item: P7_PROMPT ================================
  id: 259741962943480884
  identification: 
    name: P7_PROMPT
    type: Textarea

  label: 
    label: Your Question
    alignment: Left

  settings: 
    resizable: true
    auto-height: false
    character-counter: true
    trim-spaces: Leading and Trailing

  layout: 
    sequence: 30
    region: PROMPT # 272689500662330252
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Required - Floating
    template-options: 
    - '#DEFAULT#'
    width: 30
    height: 4
    value-placeholder: How can I help today!

  validation: 
    value-required: false
    maximum-length: 4000

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P7_PROCESSING_STATUS =====================
  id: 259743117200480890
  identification: 
    name: P7_PROCESSING_STATUS
    type: Display Only

  label: 
    label: Status
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: true

  layout: 
    sequence: 110
    region: ADVANCED_SETTINGS # 272689715447330254
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Hidden
    template-options: 
    - '#DEFAULT#'

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  server-side-condition: 
    type: Item is NOT NULL
    item: P7_PROCESSING_STATUS

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P7_MODEL_NAME ============================
  id: 259753711598480918
  identification: 
    name: P7_MODEL_NAME
    type: Select List

  label: 
    label: Model
    alignment: Left

  settings: 
    page-action-on-selection: None

  multiple-values: 
    type: No

  layout: 
    sequence: 30
    region: CTRL_BTN_BAR # 274411944049675327
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    height: 1

  validation: 
    value-required: false

  list-of-values: 
    type: SQL Query
    sql-query: |2
        SELECT 
            provider_code || ' - ' || model_name AS display_value,
            model_code AS return_value
        FROM LLM_PROVIDER_MODELS
        WHERE is_active = 'Y'
          AND provider_code = :P7_MODEL_PROVIDER
        ORDER BY 
            CASE WHEN is_default = 'Y' THEN 0 ELSE 1 END,
            display_order NULLS LAST,
            model_name
       
    display-extra-values: true
    display-null-value: false

  cascading-list-of-values: 
    parent-item(s): 
    - P7_MODEL_PROVIDER
    parent-required: true

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: SQL Query (return single value)
    sql-query-(return-single-value): |
      SELECT model_code  
      FROM LLM_PROVIDER_MODELS 
      WHERE is_active = 'Y' 
        AND provider_code = NVL(:P7_MODEL_PROVIDER, 'OPENAI')  
        AND is_default = 'Y' 
        AND ROWNUM = 1

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P7_TOKEN_COUNT ===========================
  id: 259754132147480922
  identification: 
    name: P7_TOKEN_COUNT
    type: Display Only

  label: 
    label: Tokens Used
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: true

  layout: 
    sequence: 40
    region: CTRL_BTN_BAR # 274411944049675327
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    format-mask: 999,999

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: Static
    static-value: 000.000.000

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  server-side-condition: 
    type: Item is NOT NULL
    item: P7_PROCESSING_STATUS

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P7_CONTEXT_JSON ==========================
  id: 259755724357480926
  identification: 
    name: P7_CONTEXT_JSON
    type: Hidden

  settings: 
    value-protected: true

  layout: 
    sequence: 10
    region: No Parent
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Checksum Required - Session Level
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P7_SESSION_ID ============================
  id: 272694761104330275
  identification: 
    name: P7_SESSION_ID
    type: Hidden

  settings: 
    value-protected: false

  layout: 
    sequence: 10
    region: CONTAINER # 272688960027330247
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P7_SESSION_UUID ==========================
  id: 272694925282330276
  identification: 
    name: P7_SESSION_UUID
    type: Hidden

  settings: 
    value-protected: true

  layout: 
    sequence: 20
    region: CONTAINER # 272688960027330247
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: SQL Query (return single value)
    sql-query-(return-single-value): |
      SELECT session_uuid
          FROM ai_chat_sessions
          WHERE session_id = :P7_SESSION_ID

  session-state: 
    data-type: VARCHAR2
    storage: Per Request (Memory Only)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P7_TEMPERATURE ===========================
  id: 272704495892330305
  identification: 
    name: P7_TEMPERATURE
    type: Number Field

  label: 
    label: Temperature
    alignment: Left

  settings: 
    minimum-value: 0
    maximum-value: 1
    number-alignment: Start
    virtual-keyboard: Decimal

  layout: 
    sequence: 10
    region: ADVANCED_SETTINGS # 272689715447330254
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    width: 30

  validation: 
    value-required: false

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: Static
    static-value: 0.7

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: true
    label-1: 0.1
    value-1: 0.1
    label-2: 0.2
    value-2: 0.2
    label-3: 0.3
    value-3: 0.3
    label-4: 0.4
    value-4: 0.4
    label-5: 0.5
    value-5: 0.5
    label-6: 0.6
    value-6: 0.6
    label-7: 0.7
    value-7: 0.7
    label-8: 0.8
    value-8: 0.8
    label-9: 0.9
    value-9: 0.9
    label-10: 1
    value-10: 1

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

  help: 
    help-text: |
      |
        Controls randomness. Lower = more focused, higher = more creative.
        Range: 0.0 - 1.0

- # ====== Page Item: P7_TOP_P =================================
  id: 272704504496330306
  identification: 
    name: P7_TOP_P
    type: Number Field

  label: 
    label: Top P (Nucleus Sampling)
    alignment: Left

  settings: 
    minimum-value: 0
    maximum-value: 1
    number-alignment: Start
    virtual-keyboard: Decimal

  layout: 
    sequence: 30
    region: ADVANCED_SETTINGS # 272689715447330254
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    width: 30

  validation: 
    value-required: false

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: Static
    static-value: 1.0

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: true
    label-1: 0.05
    value-1: 0.05
    label-2: 0.10
    value-2: 0.10
    label-3: 0.20
    value-3: 0.20
    label-4: 0.30
    value-4: 0.30
    label-5: 0.40
    value-5: 0.40
    label-6: 0.50
    value-6: 0.50
    label-7: 0.60
    value-7: 0.60
    label-8: 0.70
    value-8: 0.70
    label-9: 0.80
    value-9: 0.80
    label-10: 0.90
    value-10: 0.90

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

  help: 
    help-text: |2
       |
        Controls diversity via nucleus sampling. Recommended to alter this OR temperature, not both.
        Range: 0.0 - 1.0

- # ====== Page Item: P7_MAX_TOKENS ============================
  id: 272704668557330307
  identification: 
    name: P7_MAX_TOKENS
    type: Number Field

  label: 
    label: Max Tokens
    alignment: Left

  settings: 
    minimum-value: 1
    maximum-value: 4096
    number-alignment: Start
    virtual-keyboard: Decimal

  layout: 
    sequence: 50
    region: ADVANCED_SETTINGS # 272689715447330254
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    width: 30

  validation: 
    value-required: false

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: Static
    static-value: 2048

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

  help: 
    help-text: |
      |
        Maximum tokens in the response. Typical: 500-2000 for chat, 4000 for detailed responses.

- # ====== Page Item: P7_FREQUENCY_PENALTY =====================
  id: 272704790372330308
  identification: 
    name: P7_FREQUENCY_PENALTY
    type: Number Field

  label: 
    label: Frequency Penalty
    alignment: Left

  settings: 
    minimum-value: -2
    maximum-value: 2
    number-alignment: Start
    virtual-keyboard: Decimal

  layout: 
    sequence: 60
    region: ADVANCED_SETTINGS # 272689715447330254
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    width: 30

  validation: 
    value-required: false

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: Static
    static-value: 0

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

  help: 
    help-text: |
      |
        Penalizes repetition of tokens. Positive = less repetition, Negative = more repetition.
        Range: -2.0 - 2.0

- # ====== Page Item: P7_PRESENCE_PENALTY ======================
  id: 272704864299330309
  identification: 
    name: P7_PRESENCE_PENALTY
    type: Number Field

  label: 
    label: Presence Penalty
    alignment: Left

  settings: 
    minimum-value: -2
    maximum-value: 2
    number-alignment: Start
    virtual-keyboard: Decimal

  layout: 
    sequence: 70
    region: ADVANCED_SETTINGS # 272689715447330254
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    width: 30

  validation: 
    value-required: false

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: Static
    static-value: 0

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

  help: 
    help-text: |
      |
        Penalizes new topics. Positive = more diverse topics, Negative = stays on topic.
        Range: -2.0 - 2.0

- # ====== Page Item: P7_SEED ==================================
  id: 272704926709330310
  identification: 
    name: P7_SEED
    type: Number Field

  label: 
    label: Seed (Optional)
    alignment: Left

  settings: 
    number-alignment: Start
    virtual-keyboard: Decimal

  layout: 
    sequence: 80
    region: ADVANCED_SETTINGS # 272689715447330254
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    width: 30

  validation: 
    value-required: false

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

  help: 
    help-text: |
      |
        For deterministic responses. Same seed + inputs = same output.
        Leave blank for random responses.

- # ====== Page Item: P7_RESPONSE_FORMAT =======================
  id: 272705028194330311
  identification: 
    name: P7_RESPONSE_FORMAT
    type: Select List

  label: 
    label: Response Format
    alignment: Left

  settings: 
    page-action-on-selection: None

  multiple-values: 
    type: No

  layout: 
    sequence: 90
    region: ADVANCED_SETTINGS # 272689715447330254
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    height: 1

  validation: 
    value-required: false

  list-of-values: 
    type: Static Values
    static-values: 'STATIC:Text (Default) ;text,JSON Object;json_object'
    display-extra-values: true
    display-null-value: true

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: Static
    static-value: text

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P7_STOP_SEQUENCES ========================
  id: 272705111173330312
  identification: 
    name: P7_STOP_SEQUENCES
    type: Text Field

  label: 
    label: Stop Sequences (comma-separated)
    alignment: Left

  settings: 
    subtype: Text
    trim-spaces: Leading and Trailing
    text-case: NO CHANGE
    submit-when-enter-pressed: false
    disabled: false

  layout: 
    sequence: 100
    region: ADVANCED_SETTINGS # 272689715447330254
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    width: 30

  validation: 
    value-required: false

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

  help: 
    help-text: |
      |
        Stop generation when these sequences are encountered.
        Example: "\n\n", "END", "---"

- # ====== Page Item: P7_MODEL_PROVIDER ========================
  id: 272715130462330334
  identification: 
    name: P7_MODEL_PROVIDER
    type: Select List

  label: 
    label: Provider
    alignment: Left

  settings: 
    page-action-on-selection: None

  multiple-values: 
    type: No

  layout: 
    sequence: 20
    region: CTRL_BTN_BAR # 274411944049675327
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    height: 1

  validation: 
    value-required: false

  list-of-values: 
    type: Static Values
    static-values: 'STATIC:OpenAI;OPENAI,Claude;CLAUDE,Gemini;GEMINI'
    display-extra-values: true
    display-null-value: true

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: Static
    static-value: OPENAI

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P7_CURRENT_SESSION_TITLE =================
  id: 272716122335330344
  identification: 
    name: P7_CURRENT_SESSION_TITLE
    type: Display Only

  label: 
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: true

  layout: 
    sequence: 10
    region: CTRL_BTN_BAR # 274411944049675327
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    css-classes: 
    - session-title-display
    - null
    icon: fa-map-pin-circle

  advanced: 
    pre-text: Chat Title
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: SQL Query (return single value)
    sql-query-(return-single-value): |2
       SELECT NVL(session_title, 'New Conversation')
          FROM ai_chat_sessions
          WHERE session_id = :P7_SESSION_ID

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P7_LIVE_TOKEN_COUNT ======================
  id: 272716181718330345
  identification: 
    name: P7_LIVE_TOKEN_COUNT
    type: Display Only

  label: 
    label: Tokens
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: false

  layout: 
    sequence: 60
    region: CTRL_BTN_BAR # 274411944049675327
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    icon: fa-calculator
    format-mask: 999,999

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: SQL Query (return single value)
    sql-query-(return-single-value): |
      SELECT TO_CHAR(NVL(total_tokens, 0), '999,999')
          FROM ai_chat_sessions
          WHERE session_id = :P7_SESSION_ID

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P7_HIDE_SHOW_ADV =========================
  id: 273679106014547366
  identification: 
    name: P7_HIDE_SHOW_ADV
    type: Hidden

  settings: 
    value-protected: true

  layout: 
    sequence: 80
    region: SELECTED_SESSION # 272689211335330249
    slot: NEXT

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: Static
    static-value: Y

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

buttons: 
- # ====== Button: REGENERATE_BTN ==============================
  id: 137246937804135464
  identification: 
    button-name: REGENERATE_BTN
    label: Regenerate

  layout: 
    sequence: 10
    region: PROMPT # 272689500662330252
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    alignment: Left center

  appearance: 
    button-template: Text with Icon
    hot: false
    template-options: 
    - '#DEFAULT#'
    - t-Button--iconLeft
    icon: fa-redo

  behavior: 
    action: Submit Page
    execute-validations: true
    show-processing: false
    warn-on-unsaved-changes: Do Not Check

  server-side-condition: 
    type: Rows returned
    sql-query: |
      SELECT 1
        FROM ai_chat_messages
        WHERE session_id = :P7_SESSION_ID
          AND message_seq = (
              SELECT MAX(message_seq)
              FROM ai_chat_messages
              WHERE session_id = :P7_SESSION_ID
          )
          AND message_role = 'ASSISTANT'

- # ====== Button: SEND_BTN ====================================
  id: 137247339345135465
  identification: 
    button-name: SEND_BTN
    label: 'üöÄ Ask ChatPot '

  layout: 
    sequence: 40
    region: PROMPT # 272689500662330252
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    alignment: Left center

  appearance: 
    button-template: Icon
    hot: true
    template-options: 
    - '#DEFAULT#'
    css-classes: 
    - send-message-btn
    icon: fa-paper-plane

  behavior: 
    action: Submit Page
    execute-validations: true
    show-processing: false
    warn-on-unsaved-changes: Do Not Check

  advanced: 
    static-id: SEND_BTN

- # ====== Button: CLEAR_BTN ===================================
  id: 137247723845135466
  identification: 
    button-name: CLEAR_BTN
    label: 'Clear '

  layout: 
    sequence: 50
    region: PROMPT # 272689500662330252
    slot: BODY
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic
    alignment: Left center

  appearance: 
    button-template: Text with Icon
    hot: false
    template-options: 
    - '#DEFAULT#'
    - t-Button--iconLeft
    icon: fa-eraser

  behavior: 
    action: Defined by Dynamic Action
    execute-validations: true

- # ====== Button: REFRESH_BTN =================================
  id: 137248197714135467
  identification: 
    button-name: REFRESH_BTN
    label: Refresh

  layout: 
    sequence: 60
    region: PROMPT # 272689500662330252
    slot: BODY
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic
    alignment: Left center

  appearance: 
    button-template: Icon
    hot: false
    template-options: 
    - '#DEFAULT#'
    icon: fa-refresh

  behavior: 
    action: Defined by Dynamic Action
    execute-validations: true

- # ====== Button: NEW_CHAT_BTN ================================
  id: 137258547166135498
  identification: 
    button-name: NEW_CHAT_BTN
    label: New Chat

  layout: 
    sequence: 110
    region: CTRL_BTN_BAR # 274411944049675327
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    alignment: Left center

  appearance: 
    button-template: Text with Icon
    hot: true
    template-options: 
    - '#DEFAULT#'
    - t-Button--large
    - t-Button--noUI
    - t-Button--iconLeft
    - t-Button--gapTop
    icon: fa-plus

  behavior: 
    action: Defined by Dynamic Action
    execute-validations: true

- # ====== Button: SETTINGS_BTN ================================
  id: 137258980636135499
  identification: 
    button-name: SETTINGS_BTN
    label: Settings Btn

  layout: 
    sequence: 80
    region: CTRL_BTN_BAR # 274411944049675327
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    alignment: Left center

  appearance: 
    button-template: Icon
    hot: false
    template-options: 
    - '#DEFAULT#'
    - t-Button--padRight
    - t-Button--gapTop
    icon: fa-cog

  behavior: 
    action: Defined by Dynamic Action
    execute-validations: true

  advanced: 
    static-id: SETTINGS_BTN

- # ====== Button: EXPORT_BTN ==================================
  id: 137259317280135500
  identification: 
    button-name: EXPORT_BTN
    label: Export

  layout: 
    sequence: 90
    region: CTRL_BTN_BAR # 274411944049675327
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    alignment: Left center

  appearance: 
    button-template: Icon
    hot: false
    template-options: 
    - '#DEFAULT#'
    - t-Button--padRight
    - t-Button--gapTop
    icon: fa-download

  behavior: 
    action: Defined by Dynamic Action
    execute-validations: true

- # ====== Button: Panel_Toggle_ptn ============================
  id: 137259712304135501
  identification: 
    button-name: Panel_Toggle_ptn
    label: Left Panel Toggle

  layout: 
    sequence: 100
    region: CTRL_BTN_BAR # 274411944049675327
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    alignment: Left center

  appearance: 
    button-template: Icon
    hot: false
    template-options: 
    - '#DEFAULT#'
    icon: fa-arrow-circle-o-left

  behavior: 
    action: Defined by Dynamic Action
    execute-validations: true

  advanced: 
    static-id: PANEL_TOGGLE_BTN

dynamic-actions: 
- # ====== Dynamic Action: Key Press ===========================
  id: 137264048350135515
  identification: 
    name: Key Press

  execution: 
    sequence: 30
    event-scope: Static
    type: Immediate

  when: 
    event: Key Press
    selection-type: Item(s)
    item(s): 
    - P7_PROMPT

  client-side-condition: 
    type: JavaScript expression
    javascript-expression: this.browserEvent.key === 'Enter' && this.browserEvent.ctrlKey

  actions: 
  - # ====== Action: Submit Page =================================
    id: 137264504256135516
    identification: 
      action: Submit Page

    settings: 
      request-/-button-name: SEND_BTN
      show-processing: true

    execution: 
      sequence: 10
      event: Key Press # 137264048350135515
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: download ============================
  id: 137264982941135517
  identification: 
    name: download

  execution: 
    sequence: 70
    event-scope: Static
    type: Immediate

  when: 
    event: Double Tap
    selection-type: Button
    button: EXPORT_BTN # 137259317280135500

  actions: 
  - # ====== Action: chat_export_&P7_SESSION_UUID..json ==========
    id: 137265472222135518
    identification: 
      name: chat_export_&P7_SESSION_UUID..json
      action: Download

    settings: 
      multiple-files: false
      view-file-as: Attachment

    source: 
      sql-query: 'select chat_manager_pkg.export_session_json(  p_session_id => :P7_SESSION_ID ) x from dual;'
      items-to-submit: 
      - P7_SESSION_ID

    execution: 
      sequence: 10
      event: download # 137264982941135517
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: Clear Session State (P7_PROMPT) =====
  id: 137265875201135519
  identification: 
    name: Clear Session State (P7_PROMPT)

  execution: 
    sequence: 80
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: Button
    button: CLEAR_BTN # 137247723845135466

  actions: 
  - # ====== Action: Clear =======================================
    id: 137266389331135520
    identification: 
      action: Clear

    affected-elements: 
      selection-type: Item(s)
      item(s): 
      - P7_PROMPT

    execution: 
      sequence: 20
      event: Clear Session State (P7_PROMPT) # 137265875201135519
      fire-when-event-result-is: True
      fire-on-initialization: false

    configuration: 
      build-option: Commented Out # 123954063565486069

  - # ====== Action: Set Value ===================================
    id: 137266829083135521
    identification: 
      action: Set Value

    settings: 
      set-type: Static Assignment
      suppress-change-event: false

    affected-elements: 
      selection-type: Item(s)
      item(s): 
      - P7_PROMPT

    execution: 
      sequence: 10
      event: Clear Session State (P7_PROMPT) # 137265875201135519
      fire-when-event-result-is: True
      fire-on-initialization: false
      stop-execution-on-error: true
      wait-for-result: true

- # ====== Dynamic Action: DA_AUTO_SCROLL_CHAT =================
  id: 137267242083135522
  identification: 
    name: DA_AUTO_SCROLL_CHAT

  execution: 
    sequence: 90
    event-scope: Static
    type: Immediate

  when: 
    event: After Refresh
    selection-type: Region
    region: PROMPT # 272689500662330252

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 137267754118135523
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        // Scroll chat thread to bottom
               var chatThread = document.querySelector('.chat-message-thread');
               if (chatThread) {
                   chatThread.scrollTop = chatThread.scrollHeight;
               }

    execution: 
      sequence: 10
      event: DA_AUTO_SCROLL_CHAT # 137267242083135522
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: DA_UPDATE_TOKEN_COUNTER =============
  id: 137268198888135524
  identification: 
    name: DA_UPDATE_TOKEN_COUNTER

  execution: 
    sequence: 100
    event-scope: Static
    type: Immediate

  when: 
    event: Key Release
    selection-type: Item(s)
    item(s): 
    - P7_PROMPT

  client-side-condition: 
    type: Item is not null
    item: P7_PROMPT

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 137268634260135525
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        // Estimate tokens (rough: 1 token ‚âà 4 characters)
               var text = apex.item('P7_PROMPT').getValue();
               var estimatedTokens = Math.ceil(text.length / 4);
               
               apex.item('P7_LIVE_TOKEN_COUNT').setValue(
                   estimatedTokens.toLocaleString()
               );

    execution: 
      sequence: 10
      event: DA_UPDATE_TOKEN_COUNTER # 137268198888135524
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: DA_TOGGLE_ADVANCED_CTRLS ============
  id: 137269020152135526
  identification: 
    name: DA_TOGGLE_ADVANCED_CTRLS

  execution: 
    sequence: 110
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: Button
    button: SETTINGS_BTN # 137258980636135499

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 137269560565135527
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        // Toggle Advanced Settings
        (function() {
            var region = $('#ADVANCED_SETTINGS');
            var button = $('#SETTINGS_BTN');
            var icon = button.find('.t-Icon, .fa');
            
            // Check elements exist
            if (!region.length || !button.length) {
                console.error('Elements not found');
                return;
            }
            
            var isVisible = region.is(':visible');
            
            if (isVisible) {
                // COLLAPSE
                region.slideUp(300, function() {
                    button.removeClass('is-active')
                          .attr('aria-expanded', 'false')
                          .attr('title', 'Show Advanced Settings');
                    
                    if (icon.length) {
                        icon.removeClass('fa-chevron-up').addClass('fa-cog');
                    }
                });
            } else {
                // EXPAND
                region.slideDown(300, function() {
                    button.addClass('is-active')
                          .attr('aria-expanded', 'true')
                          .attr('title', 'Hide Advanced Settings');
                    
                    if (icon.length) {
                        icon.removeClass('fa-cog').addClass('fa-chevron-up');
                    }
                });
            }
            
            // Set ARIA
            button.attr('aria-controls', 'ADVANCED_SETTINGS');
        })();

    execution: 
      sequence: 10
      event: DA_TOGGLE_ADVANCED_CTRLS # 137269020152135526
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: DA_COPY_MESSAGE =====================
  id: 137269951685135528
  identification: 
    name: DA_COPY_MESSAGE

  execution: 
    sequence: 120
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: jQuery Selector
    jquery-selector: .copy-btn

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 137270491404135529
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |2
         var messageId = $(this.triggeringElement).data('message-id');
               var messageText = $(this.triggeringElement)
                   .closest('.message-bubble')
                   .find('.message-body')
                   .text();
               
               navigator.clipboard.writeText(messageText).then(function() {
                   apex.message.showPageSuccess('Message copied to clipboard! üìã');
               });

    execution: 
      sequence: 10
      event: DA_COPY_MESSAGE # 137269951685135528
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: DA_MESSAGE_FEEDBACK =================
  id: 137270881669135530
  identification: 
    name: DA_MESSAGE_FEEDBACK

  execution: 
    sequence: 130
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: jQuery Selector
    jquery-selector: .feedback-btn

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 137271388133135531
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |2
         var messageId = $(this.triggeringElement).data('message-id');
               
               // Show feedback dialog
               apex.item('P7_FEEDBACK_MESSAGE_ID').setValue(messageId);
               apex.theme.openRegion('FEEDBACK_DIALOG');

    execution: 
      sequence: 10
      event: DA_MESSAGE_FEEDBACK # 137270881669135530
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: New Chat ============================
  id: 137271716122135532
  identification: 
    name: New Chat

  execution: 
    sequence: 150
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: Button
    button: NEW_CHAT_BTN # 137258547166135498

  actions: 
  - # ====== Action: set empty prompt ============================
    id: 137272280693135533
    identification: 
      name: set empty prompt
      action: Set Value

    settings: 
      set-type: Static Assignment
      suppress-change-event: false

    affected-elements: 
      selection-type: Item(s)
      item(s): 
      - P7_PROMPT

    execution: 
      sequence: 20
      event: New Chat # 137271716122135532
      fire-when-event-result-is: True
      fire-on-initialization: true
      stop-execution-on-error: true
      wait-for-result: true

  - # ====== Action: Refresh =====================================
    id: 137272754335135534
    identification: 
      action: Refresh

    settings: 
      maintain-pagination: false

    affected-elements: 
      selection-type: Region
      region: CHAT_HISTORY # 272689067922330248

    execution: 
      sequence: 30
      event: New Chat # 137271716122135532
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Refresh =====================================
    id: 137273228815135536
    identification: 
      action: Refresh

    settings: 
      maintain-pagination: false

    affected-elements: 
      selection-type: Region
      region: CHAT_SESSION # 273708050944923746

    execution: 
      sequence: 40
      event: New Chat # 137271716122135532
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Execute JavaScript Code =====================
    id: 137273723769135537
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        // Action: Execute JavaScript Code
        
        apex.server.process(
            'CREATE_NEW_SESSION',
            {},
            {
                success: function(data) {
                    currentSessionId = data.session_id;
                    apex.item('P7_SESSION_ID').setValue(currentSessionId);
                    
                    // Clear message display
                   // clearMessages();
                    
                    // Update UI
                    apex.message.showPageSuccess('New conversation started');
                }
            }
        );

    execution: 
      sequence: 10
      event: New Chat # 137271716122135532
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Execute JavaScript Code =====================
    id: 137274299457135538
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        chatApp.createNewSession();
        

    execution: 
      sequence: 10
      event: New Chat # 137271716122135532
      fire-when-event-result-is: True
      fire-on-initialization: false

    configuration: 
      build-option: Commented Out # 123954063565486069

- # ====== Dynamic Action: Session History Item Click ==========
  id: 137274674546135539
  identification: 
    name: Session History Item Click

  execution: 
    sequence: 170
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: jQuery Selector
    jquery-selector: .session-history-item

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 137275137209135540
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        // Get session_id from clicked element's data attribute
        var sessionId = $(this.triggeringElement).data('session-id');
        chatApp.loadSession(sessionId);
        
         

    execution: 
      sequence: 10
      event: Session History Item Click # 137274674546135539
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: LogApplicationItems =================
  id: 137275583089135541
  identification: 
    name: LogApplicationItems

  execution: 
    sequence: 1009
    event-scope: Static

  when: 
    event: Page Load

  actions: 
  - # ====== Action: Log Global Items ============================
    id: 137276017349135542
    identification: 
      name: Log Global Items
      action: Execute JavaScript Code

    settings: 
      code: |
        console.log('Role ID:', '&G_USER_ROLE_ID.');
        console.log('Role Name:', '&G_USER_ROLE_NAME.');
        console.log('Classification:', '&G_CLASSIFICATION_LEVEL.');
        console.log('Tenant ID:', '&G_TENANT_ID.');
        console.log('Tenant Name:', '&G_TENANT_NAME.');
        console.log('Tenant Code:', '&G_TENANT_CODE.');
        console.log('Session Start:', '&G_SESSION_START.');

    execution: 
      sequence: 10
      event: LogApplicationItems # 137275583089135541
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Panel Structure Diagnostic ==================
    id: 137276591226135543
    identification: 
      name: Panel Structure Diagnostic
      action: Execute JavaScript Code

    settings: 
      code: |
        // Panel Structure Diagnostic
        console.log('‚ïê‚ïê‚ïê PANEL DIAGNOSTIC ‚ïê‚ïê‚ïê');
        
        var left = $('#LEFT_PANEL');
        var right = $('#RIGHT_PANEL');
        
        console.log('LEFT exists:', left.length);
        console.log('RIGHT exists:', right.length);
        
        if (left.length && right.length) {
            console.log('\nüå≥ STRUCTURE:');
            console.log('LEFT parent:', left.parent().attr('id') || left.parent()[0].className);
            console.log('RIGHT parent:', right.parent().attr('id') || right.parent()[0].className);
            console.log('Same parent?', left.parent().is(right.parent()));
            console.log('Are siblings?', left.next().is(right));
            
            console.log('\nüìè SIZES:');
            console.log('LEFT width:', left.width());
            console.log('RIGHT width:', right.width());
            console.log('Parent width:', left.parent().width());
            
            console.log('\nüé® LAYOUT:');
            console.log('Parent display:', left.parent().css('display'));
            console.log('LEFT position:', left.css('position'));
            console.log('RIGHT position:', right.css('position'));
            console.log('LEFT float:', left.css('float'));
            console.log('RIGHT float:', right.css('float'));
        }
        
        console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');

    execution: 
      sequence: 20
      event: LogApplicationItems # 137275583089135541
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: New =================================
  id: 137276916001135544
  identification: 
    name: New

  execution: 
    sequence: 1019
    event-scope: Static

  when: 
    event: Page Load

  configuration: 
    build-option: Commented Out # 123954063565486069

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 137277443898135545
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |2
          // Initialize send button state
            this.updateSendButtonState();

    execution: 
      sequence: 10
      event: New # 137276916001135544
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: DA_KEY_RELEASE_PROMPT ===============
  id: 137277831932135546
  identification: 
    name: DA_KEY_RELEASE_PROMPT

  execution: 
    sequence: 1029
    event-scope: Static
    type: Immediate

  when: 
    event: Key Release
    selection-type: Item(s)
    item(s): 
    - P7_PROMPT

  actions: 
  - # ====== Action: Validate Prompt and Update Button ===========
    id: 137278303651135547
    identification: 
      name: Validate Prompt and Update Button
      action: Execute JavaScript Code

    settings: 
      code: |2
         
        // SEND BUTTON VALIDATION WITH CHARACTER COUNT
         
        (function() {
        
            // CONFIGURATION (Adjust these values as needed)
            const CONFIG = {
                MIN_CHARS: 3,           // Minimum required characters
                MAX_CHARS: 4000,        // Maximum allowed characters
                SHOW_COUNTER: true,     // Show character counter
                DEBUG: true             // Console logging
            };
        
            // GET VALUES
            const promptValue = apex.item('P7_PROMPT').getValue() || '';
            const promptLength = promptValue.trim().length;
            const sendButton = $('#SEND_BTN');
            
            // ========================================================================
            // VALIDATION LOGIC
            let isValid = false;
            let message = '';
            let counterClass = '';
            
            if (promptLength === 0) {
                // Empty prompt
                isValid = false;
                message = `${CONFIG.MIN_CHARS} characters minimum`;
                counterClass = 'char-counter-empty';
                if (CONFIG.DEBUG) console.log('‚ùå Validation: Empty prompt');
                
            } else if (promptLength < CONFIG.MIN_CHARS) {
                // Too short
                isValid = false;
                const needed = CONFIG.MIN_CHARS - promptLength;
                message = `${promptLength}/${CONFIG.MIN_CHARS} (${needed} more needed)`;
                counterClass = 'char-counter-warning';
                if (CONFIG.DEBUG) console.log(`‚ö†Ô∏è Validation: Too short (${promptLength} chars)`);
                
            } else if (promptLength > CONFIG.MAX_CHARS) {
                // Too long
                isValid = false;
                const excess = promptLength - CONFIG.MAX_CHARS;
                message = `${promptLength}/${CONFIG.MAX_CHARS} (${excess} too many)`;
                counterClass = 'char-counter-error';
                if (CONFIG.DEBUG) console.log(`‚ùå Validation: Too long (${promptLength} chars)`);
                
            } else {
                // Valid!
                isValid = true;
                message = `${promptLength} characters`;
                counterClass = 'char-counter-valid';
                if (CONFIG.DEBUG) console.log(`‚úÖ Validation: Valid (${promptLength} chars)`);
            }
            
            // ========================================================================
            // UPDATE SEND BUTTON STATE
            // ========================================================================
            if (isValid) {
                // ENABLE button
                sendButton.prop('disabled', false)
                         .removeClass('is-disabled apex_disabled')
                         .attr('aria-disabled', 'false')
                         .attr('title', 'Send message (Ctrl+Enter)');
                
            } else {
                // DISABLE button
                sendButton.prop('disabled', true)
                         .addClass('is-disabled apex_disabled')
                         .attr('aria-disabled', 'true')
                         .attr('title', message);
            }
            
        // ========================================================================
            // UPDATE CHARACTER COUNTER
            // ========================================================================
            if (CONFIG.SHOW_COUNTER) {
                let counter = $('#prompt-char-counter');
                
                // Create counter if doesn't exist
                if (counter.length === 0) {
                    $('#P7_PROMPT').parent().append(
                        '<div id="prompt-char-counter" class="char-counter"></div>'
                    );
                    counter = $('#prompt-char-counter');
                }
                
                // Update counter
                counter.text(message)
                      .removeClass('char-counter-empty char-counter-warning char-counter-error char-counter-valid')
                      .addClass(counterClass);
            }
            
        })();

    execution: 
      sequence: 20
      event: DA_KEY_RELEASE_PROMPT # 137277831932135546
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Execute JavaScript Code =====================
    id: 137278871005135549
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        // Get prompt value
        var promptValue = apex.item('P7_PROMPT').getValue();
        var sendButton = $('#SEND_BTN');
        
        // Check if prompt has content
        if (promptValue && promptValue.trim().length > 0) {
            // Enable button
            sendButton.prop('disabled', false)
                     .removeClass('is-disabled')
                     .removeClass('apex_disabled')
                     .attr('aria-disabled', 'false');
            
            console.log('Send button enabled');
        } else {
            // Disable button
            sendButton.prop('disabled', true)
                     .addClass('is-disabled')
                     .addClass('apex_disabled')
                     .attr('aria-disabled', 'true');
            
            console.log('Send button disabled');
        }

    execution: 
      sequence: 10
      event: DA_KEY_RELEASE_PROMPT # 137277831932135546
      fire-when-event-result-is: True
      fire-on-initialization: false

    configuration: 
      build-option: Commented Out # 123954063565486069

- # ====== Dynamic Action: refresh Regions =====================
  id: 137279293203135549
  identification: 
    name: refresh Regions

  execution: 
    sequence: 1039
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: Button
    button: REFRESH_BTN # 137248197714135467

  actions: 
  - # ====== Action: Refresh =====================================
    id: 137279702705135551
    identification: 
      action: Refresh

    settings: 
      maintain-pagination: false

    affected-elements: 
      selection-type: Region
      region: PROMPT # 272689500662330252

    execution: 
      sequence: 10
      event: refresh Regions # 137279293203135549
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Refresh =====================================
    id: 137280241953135552
    identification: 
      action: Refresh

    settings: 
      maintain-pagination: false

    affected-elements: 
      selection-type: Region
      region: SELECTED_SESSION # 272689211335330249

    execution: 
      sequence: 20
      event: refresh Regions # 137279293203135549
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Refresh =====================================
    id: 137280742818135553
    identification: 
      action: Refresh

    settings: 
      maintain-pagination: false

    affected-elements: 
      selection-type: Region
      region: CHAT_HISTORY # 272689067922330248

    execution: 
      sequence: 30
      event: refresh Regions # 137279293203135549
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: Show_Hidel_Left_Panel ===============
  id: 137281120320135554
  identification: 
    name: Show_Hidel_Left_Panel

  execution: 
    sequence: 1049
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: Button
    button: Panel_Toggle_ptn # 137259712304135501

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 137281691063135555
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        // Toggle with forced flex layout
        (function() {
            var leftPanel = $('#LEFT_PANEL');
            var rightPanel = $('#RIGHT_PANEL');
            var button = $('#PANEL_TOGGLE_BTN');
            var icon = button.find('.t-Icon, .fa');
            
            var leftContainer = leftPanel.parent();
            var rightContainer = rightPanel.parent();
            var rowContainer = leftContainer.parent();
            
            if (!leftPanel.length || !button.length) return;
            
            // ALWAYS force flex layout on parent
            rowContainer.css('display', 'flex');
            
            if (leftPanel.is(':visible')) {
                // HIDE
                leftPanel.slideUp(300, function() {
                    button.removeClass('is-active');
                    icon.removeClass('fa-chevron-left').addClass('fa-bars');
                    
                    leftContainer.hide();
                    rightContainer.removeClass('col-9').addClass('col-12');
                    
                    // Force flex again after change
                    rowContainer.css('display', 'flex');
                    
                    console.log('‚úÖ Hidden');
                });
            } else {
                // SHOW
                rightContainer.removeClass('col-12').addClass('col-9');
                leftContainer.show();
                
                // Force flex BEFORE animation - THIS IS KEY!
                rowContainer.css('display', 'flex');
                
                leftPanel.slideDown(300, function() {
                    button.addClass('is-active');
                    icon.removeClass('fa-bars').addClass('fa-chevron-left');
                    console.log('‚úÖ Shown side-by-side');
                });
            }
        })();

    execution: 
      sequence: 10
      event: Show_Hidel_Left_Panel # 137281120320135554
      fire-when-event-result-is: True
      fire-on-initialization: false

processes: 
- # ====== Process: SEND_MESSAGE_TO_AI =========================
  id: 137262419200135510
  identification: 
    name: SEND_MESSAGE_TO_AI
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
          v_session_id       NUMBER;
          v_user_message_id  NUMBER;
          v_assistant_msg_id NUMBER;
          v_prompt           CLOB;
          v_response         CLOB;
          v_model_name       VARCHAR2(100);
          v_model_params     JSON;
          v_rag_context      CLOB;
          v_rag_doc_count    NUMBER := 0;
          v_token_input      NUMBER := 0;
          v_token_output     NUMBER := 0;
          v_token_total      NUMBER := 0;
          v_processing_time  NUMBER;
          v_start_time       TIMESTAMP;
          v_error_occurred   BOOLEAN := FALSE;
          v_error_message    VARCHAR2(4000);
      BEGIN
          apex_debug.info('=== SEND MESSAGE TO AI - START ===');
          v_start_time := SYSTIMESTAMP;
           -- ==================================================================
      -- STEP 0: VALIDATE PROMPT (ADD THIS!)
      -- ==================================================================
              v_prompt := TRIM(:P7_PROMPT);
      
              IF v_prompt IS NULL OR LENGTH(v_prompt) = 0 THEN
                  apex_error.add_error(
                      p_message          => 'Please enter a message before sending.',
                      p_display_location => apex_error.c_inline_in_notification
                  );
                  apex_debug.error('Validation failed: Empty prompt');
                  RETURN; -- Exit process immediately
              END IF;
      
              -- Minimum length validation (optional)
              IF LENGTH(v_prompt) < 3 THEN
                  apex_error.add_error(
                      p_message          => 'Message is too short. Please enter at least 3 characters.',
                      p_display_location => apex_error.c_inline_in_notification
                  );
                  apex_debug.error('Validation failed: Prompt too short');
                  RETURN;
              END IF;
      
              apex_debug.info('<<SEND_MESSAGE_TO_AI>>Prompt validation passed: %s characters', LENGTH(v_prompt));
      
          -- ==================================================================
          -- STEP 1: GET OR CREATE SESSION
          -- ==================================================================
          v_session_id := :P7_SESSION_ID;
          
          IF v_session_id IS NULL THEN
              v_session_id := chat_manager_pkg.get_or_create_session(
                  p_user_id        => :APP_USER,
                  p_model_provider => :P7_MODEL_PROVIDER
              );
              :P7_SESSION_ID := v_session_id;
              apex_debug.info('Created new session: %s', v_session_id);
          END IF;
      
          -- ==================================================================
          -- STEP 2: SAVE USER MESSAGE
          -- ==================================================================
          v_prompt := :P7_PROMPT;
          
          v_user_message_id := chat_manager_pkg.add_message(
              p_session_id      => v_session_id,
              p_message_role    => 'USER',
              p_message_content => v_prompt
          );
          
          apex_debug.info('User message saved: %s', v_user_message_id);
      
          -- ==================================================================
          -- STEP 3: BUILD MODEL NAME
          -- ==================================================================
          v_model_name := :P7_MODEL_NAME;
          apex_debug.info('Model: %s', v_model_name);
      
          -- ==================================================================
          -- STEP 4: RETRIEVE RAG CONTEXT (if applicable)
          -- ==================================================================
          BEGIN
             /* v_rag_context := rag_context_util.get_context_for_prompt(
                  p_prompt  => v_prompt,
                  p_user_id => :APP_USER,
                  p_top_k   => 5
              );*/
              
              IF v_rag_context IS NOT NULL THEN
                  SELECT COUNT(*) 
                  INTO v_rag_doc_count
                  FROM JSON_TABLE(v_rag_context, '$[*]' 
                      COLUMNS (doc_id NUMBER PATH '$.doc_id')
                  );
                  
                  -- üî• INJECT RAG CONTEXT INTO PROMPT
                  v_prompt := 'Context:' || CHR(10) || v_rag_context || CHR(10) || CHR(10) ||
                              'User Question:' || CHR(10) || :P7_PROMPT;
                  
                  apex_debug.info('RAG context retrieved: %s docs', v_rag_doc_count);
              END IF;
          EXCEPTION
              WHEN OTHERS THEN
                  apex_debug.warn('RAG context retrieval failed: %s', SQLERRM);
                  v_rag_context   := NULL;
                  v_rag_doc_count := 0;
          END;
      
          -- ==================================================================
          -- STEP 5: BUILD MODEL PARAMETERS JSON
          -- ==================================================================
         -- ==================================================================
      DECLARE
          v_stop_sequences JSON_ARRAY_T;
      BEGIN
          -- Parse stop sequences if provided
          IF :P7_STOP_SEQUENCES IS NOT NULL THEN
              BEGIN
                  -- If stored as JSON array string: ["\\n", "User:"]
                  v_stop_sequences := JSON_ARRAY_T(:P7_STOP_SEQUENCES);
              EXCEPTION
                  WHEN OTHERS THEN
                      apex_debug.warn('Invalid stop sequences format, ignoring: %s', SQLERRM);
                      v_stop_sequences := NULL;
              END;
          END IF;
      
          -- Build parameters with explicit type conversions
         /* v_model_params := JSON_OBJECT(
              'model'               VALUE v_model_name,
              'temperature'         VALUE CASE 
                                              WHEN :P7_TEMPERATURE IS NOT NULL 
                                              THEN TO_NUMBER(:P7_TEMPERATURE) 
                                          END,
              'top_p'               VALUE CASE 
                                              WHEN :P7_TOP_P IS NOT NULL 
                                              THEN TO_NUMBER(:P7_TOP_P) 
                                          END,
              'max_tokens'          VALUE CASE 
                                              WHEN :P7_MAX_TOKENS IS NOT NULL 
                                              THEN TO_NUMBER(:P7_MAX_TOKENS) 
                                          END,
              'frequency_penalty'   VALUE CASE 
                                              WHEN :P7_FREQUENCY_PENALTY IS NOT NULL 
                                              THEN TO_NUMBER(:P7_FREQUENCY_PENALTY) 
                                          END,
              'presence_penalty'    VALUE CASE 
                                              WHEN :P7_PRESENCE_PENALTY IS NOT NULL 
                                              THEN TO_NUMBER(:P7_PRESENCE_PENALTY) 
                                          END,
              'seed'                VALUE CASE 
                                              WHEN :P7_SEED IS NOT NULL 
                                              THEN TO_NUMBER(:P7_SEED) 
                                          END,
              'response_format'     VALUE :P7_RESPONSE_FORMAT,
              'stop'                VALUE v_stop_sequences
              ABSENT ON NULL -- Critical: removes null values from JSON
          );
          */
        --  apex_debug.info('Model Parameters: %s', v_model_params.to_string());
          
      EXCEPTION
          WHEN OTHERS THEN
              apex_debug.error('Failed to build model parameters: %s', SQLERRM);
              -- Build minimal parameters as fallback
             /* v_model_params := JSON_OBJECT(
                  'model'      VALUE v_model_name,
                  'max_tokens' VALUE 4000
              );*/
      END;
          --apex_debug.info('Parameters: %s', v_model_params.to_string());
      
          -- ==================================================================
          -- STEP 6: CALL LLM API
          -- ==================================================================
          BEGIN
              -- Option A: If OPENAI_PKG expects (p_prompt, p_params)
            /*  v_response := openai_pkg.call_openai(
                  p_prompt => v_prompt,
                  p_params => v_model_params
              );*/
              
              -- Option B: If OPENAI_PKG expects JSON request object, use this instead:
              /*
              v_response := openai_pkg.call_openai(
                  p_request => JSON_OBJECT(
                      'prompt' VALUE v_prompt,
                      'model'  VALUE v_model_name,
                      'params' VALUE v_model_params
                  )
              );
              */
      
              -- Extract token usage from response metadata
              BEGIN
                  SELECT 
                      NVL(JSON_VALUE(v_response, '$.usage.prompt_tokens'), 0),
                      NVL(JSON_VALUE(v_response, '$.usage.completion_tokens'), 0),
                      NVL(JSON_VALUE(v_response, '$.usage.total_tokens'), 0)
                  INTO 
                      v_token_input,
                      v_token_output,
                      v_token_total
                  FROM DUAL;
              EXCEPTION
                  WHEN OTHERS THEN
                      v_token_input  := 0;
                      v_token_output := 0;
                      v_token_total  := 0;
                      apex_debug.warn('Token extraction failed: %s', SQLERRM);
              END;
      
              apex_debug.info('OpenAI response received: %s tokens', v_token_total);
      
          EXCEPTION
              WHEN OTHERS THEN
                  v_error_occurred := TRUE;
                  v_error_message  := SQLERRM;
                  v_response       := '‚ùå Error: ' || v_error_message;
                  apex_debug.error('OpenAI call failed: %s', v_error_message);
          END;
      
          -- ==================================================================
          -- STEP 7: CALCULATE PROCESSING TIME
          -- ==================================================================
          v_processing_time := EXTRACT(SECOND FROM (SYSTIMESTAMP - v_start_time)) * 1000;
      
          -- ==================================================================
          -- STEP 8: SAVE ASSISTANT RESPONSE
          -- ==================================================================
          v_assistant_msg_id := chat_manager_pkg.add_message(
              p_session_id      => v_session_id,
              p_message_role    => 'ASSISTANT',
              p_message_content => v_response,
              p_model_params    => v_model_params,
              p_rag_context     => v_rag_context,
              p_rag_doc_count   => v_rag_doc_count,
              p_token_input     => v_token_input,
              p_token_output    => v_token_output,
              p_token_total     => v_token_total,
              p_processing_time => v_processing_time
          );
          
          apex_debug.info('Assistant message saved: %s', v_assistant_msg_id);
      
          -- ==================================================================
          -- STEP 9: UPDATE SESSION TOTALS
          -- ==================================================================
          chat_manager_pkg.update_session_totals(
              p_session_id => v_session_id
          );
      
          -- ==================================================================
          -- STEP 10: COMPREHENSIVE AUDIT LOGGING
          -- ==================================================================
          BEGIN
              ai_log_util.log_llm_call(
                  p_user_id            => :APP_USER,
                  p_model_provider     => :P7_MODEL_PROVIDER,
                  p_model_name         => v_model_name,
                  p_call_purpose       => 'CHAT_RESPONSE',
                  p_query_text         => :P7_PROMPT, -- Original user prompt
                  p_response_text      => v_response,
                  p_token_count_input  => v_token_input,
                  p_token_count_output => v_token_output,
                  p_token_count_total  => v_token_total,
                  p_processing_time_ms => v_processing_time,
                  p_temperature        => :P7_TEMPERATURE,
                  p_top_p              => :P7_TOP_P,
                  p_max_tokens         => :P7_MAX_TOKENS,
                  p_apex_session_id    => :APP_SESSION,
                  p_is_error           => CASE WHEN v_error_occurred THEN 'Y' ELSE 'N' END,
                  p_error_message      => v_error_message
              );
      
              IF v_rag_context IS NOT NULL THEN
                  ai_log_util.log_rag_search(
                      p_user_id            => :APP_USER,
                      p_query_text         => :P7_PROMPT,
                      p_search_type        => 'HYBRID',
                      p_chunks_retrieved   => v_rag_doc_count,
                      p_chunks_selected    => v_rag_doc_count,
                      p_context_size_bytes => LENGTH(v_rag_context),
                      p_apex_session_id    => :APP_SESSION,
                      p_is_error           => 'N'
                  );
              END IF;
      
              COMMIT;
              
          EXCEPTION
              WHEN OTHERS THEN
                  apex_debug.error('Audit logging failed: %s', SQLERRM);
                  -- Continue execution even if logging fails
          END;
      
          -- ==================================================================
          -- STEP 11: CLEAR INPUT & SET STATUS
          -- ==================================================================
          :P7_PROMPT := NULL; -- Clear input after successful send
          :P7_PROCESSING_STATUS := CASE 
              WHEN v_error_occurred THEN '‚ùå Error' 
              ELSE '‚úÖ Success' 
          END;
      
          apex_debug.info('=== SEND MESSAGE TO AI - COMPLETE ===');
      
      EXCEPTION
          WHEN OTHERS THEN
              apex_debug.error('=== CRITICAL ERROR ===');
              apex_debug.error('Error: %s', SQLERRM);
              apex_debug.error('Backtrace: %s', DBMS_UTILITY.FORMAT_ERROR_BACKTRACE);
              
              apex_error.add_error(
                  p_message          => 'Failed to send message: ' || SQLERRM,
                  p_display_location => apex_error.c_inline_in_notification
              );
              
              :P7_PROCESSING_STATUS := '‚ùå Critical Error';
              
              ROLLBACK;
      END;

  execution: 
    sequence: 40
    point: Processing
    run-process: Once Per Page Visit (default)

  success-message: 
    success-message: Message sent successfully! ‚úÖ

  error: 
    error-message: Failed to send message. Please try again.
    display-location: Inline in Notification

  server-side-condition: 
    when-button-pressed: SEND_BTN # 137247339345135465

- # ====== Process: GET_OR_CREATE_SESSION ======================
  id: 137262819490135512
  identification: 
    name: GET_OR_CREATE_SESSION
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
          v_session_id     NUMBER;
          v_session_title  VARCHAR2(200);
          v_message_count  NUMBER;
          v_model_provider VARCHAR2(50);
          v_user_id number;
      BEGIN
           select user_id into v_user_id from users u where user_name =:APP_USER ;
          -- Get model provider from request or default
          v_model_provider := NVL(apex_application.g_x01, 'OPENAI');
          
          -- Get or create session (this does the DML)
          v_session_id := chat_manager_pkg.get_or_create_session(
              p_user_id        => v_user_id,
              p_model_provider => v_model_provider
          );
          
          -- Get session details for UI
          BEGIN
              SELECT 
                  session_title,
                  message_count
              INTO 
                  v_session_title,
                  v_message_count
              FROM ai_chat_sessions
              WHERE session_id = v_session_id;
          EXCEPTION
              WHEN NO_DATA_FOUND THEN
                  v_session_title := 'New Conversation';
                  v_message_count := 0;
          END;
          
          -- Return JSON response
          apex_json.open_object;
          apex_json.write('status', 'success');
          apex_json.write('session_id', v_session_id);
          apex_json.write('session_title', v_session_title);
          apex_json.write('message_count', v_message_count);
          apex_json.write('is_new', CASE WHEN v_message_count = 0 THEN 'true' ELSE 'false' END);
          apex_json.close_object;
          
          -- Log for debugging
          apex_debug.info('Session initialized: %s for user: %s', v_session_id, :APP_USER);
          
      EXCEPTION
          WHEN OTHERS THEN
              apex_json.open_object;
              apex_json.write('status', 'error');
              apex_json.write('error_code', SQLCODE);
              apex_json.write('error_message', SQLERRM);
              apex_json.close_object;
              
              apex_debug.error('Session initialization failed: %s', SQLERRM);
      END;

  execution: 
    sequence: 10
    point: Ajax Callback
    run-process: Once Per Session or When Reset

- # ====== Process: CREATE_NEW_SESSION =========================
  id: 137263253044135513
  identification: 
    name: CREATE_NEW_SESSION
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
          v_session_id     NUMBER;
          v_model_provider VARCHAR2(50);
          v_user_id number;
      BEGIN
      
      :P7_SESSION_ID := NULL;
      :P7_SESSION_UUID := NULL;
      :P7_PROMPT := NULL;         
      :P7_PROCESSING_STATUS := NULL;
      
      
           select user_id into v_user_id from users u where user_name =:APP_USER ;
          -- Get model provider from request or default
          v_model_provider := NVL(apex_application.g_x01, 'OPENAI');
          
          -- Force creation of new session
          v_session_id := chat_manager_pkg.create_session(
              p_user_id        => v_user_id,
              p_model_provider => v_model_provider,
              p_session_title  => 'New Conversation',
              p_apex_session_id => V('APP_SESSION')
          );
          
          -- Return JSON response
          apex_json.open_object;
          apex_json.write('status', 'success');
          apex_json.write('session_id', v_session_id);
          apex_json.write('message', 'New conversation created');
          apex_json.close_object;
          
          apex_debug.info('New session created: %s for user: %s', v_session_id, :APP_USER);
          
      EXCEPTION
          WHEN OTHERS THEN
              apex_json.open_object;
              apex_json.write('status', 'error');
              apex_json.write('error_message', SQLERRM);
              apex_json.close_object;
              
              apex_debug.error('New session creation failed: %s', SQLERRM);
      END;

  execution: 
    sequence: 20
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

- # ====== Process: LOAD_SESSION_MESSAGES ======================
  id: 137263604594135514
  identification: 
    name: LOAD_SESSION_MESSAGES
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
          v_session_id     NUMBER;
          v_session_title  VARCHAR2(200);
          v_message_count  NUMBER;
          v_user_id        NUMBER;
          v_session_userid NUMBER;
      BEGIN
      
       
           select user_id into v_session_userid from users u where user_name =:APP_USER ;
          -- Get session_id from request
          v_session_id := TO_NUMBER(apex_application.g_x01);
          
          -- Validate session belongs to user
          BEGIN
              SELECT 
                  user_id,
                  session_title,
                  message_count
              INTO 
                  v_user_id,
                  v_session_title,
                  v_message_count
              FROM ai_chat_sessions
              WHERE session_id = v_session_id;
              
              -- Security check
              IF v_user_id != v_session_userid THEN
                  RAISE_APPLICATION_ERROR(-20001, 'Access denied: Session belongs to different user');
              END IF;
              
          EXCEPTION
              WHEN NO_DATA_FOUND THEN
                  RAISE_APPLICATION_ERROR(-20002, 'Session not found: ' || v_session_id);
          END;
          
          -- Return session info
          apex_json.open_object;
          apex_json.write('status', 'success');
          apex_json.write('session_id', v_session_id);
          apex_json.write('session_title', v_session_title);
          apex_json.write('message_count', v_message_count);
          apex_json.close_object;
          
      EXCEPTION
          WHEN OTHERS THEN
              apex_json.open_object;
              apex_json.write('status', 'error');
              apex_json.write('error_message', SQLERRM);
              apex_json.close_object;
      END;

  execution: 
    sequence: 30
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

