---
# ====== Page: Enterprise AI Assistant =======================
id: 114
identification: 
  name: Enterprise AI Assistant
  alias: ENTERPRISE-AI-ASSISTANT2
  title: Enterprise AI Assistant

appearance: 
  page-mode: Normal
  page-template: Left and Right Side Columns
  template-options: 
  - '#DEFAULT#'

navigation-menu: 
  override-user-interface-level: false

navigation: 
  cursor-focus: Do not focus cursor
  warn-on-unsaved-changes: true

javascript: 
  function-and-global-variable-declaration: |2
     /* ==========================================================================
       FORCE UI REFRESH FIX
       Ensures Page Item is synced BEFORE the refresh fires
       ========================================================================== */
    (function() {
        const initInterval = setInterval(() => {
            if (window.chatPrompt && window.chatPrompt.initPage) {
                clearInterval(initInterval);
                applyHotfix();
            }
        }, 100);
    
        function applyHotfix() {
            console.log("üîß Applying Session State Hotfix...");
    
            // Override sendMessage with State Safety
            chatPrompt.sendMessage = async function(userText) {
                
                // Basic validation
                if (!chatPrompt.getValue("provider") || !chatPrompt.getValue("model")) return;
                if (chatPrompt.state.isSending) return;
                
                chatPrompt.state.isSending = true;
                let mustRefresh = true; 
                let activeSessionId = null; // Store ID locally to guarantee access
    
                try {
                    // UI Setup
                    if (chatPrompt.state.typing) chatPrompt.state.typing.style.display = "block";
                    if (chatPrompt.state.btnSend) chatPrompt.state.btnSend.disabled = true;
    
                    // 1Ô∏è‚É£ ENSURE SESSION
                    const session = await chatPrompt.ensureSession(userText);
                    
                    // üö® CRITICAL FIX: Sync ID immediately upon success
                    if (session.success && session.sessionId) {
                        activeSessionId = session.sessionId;
                        
                        // Force value into APEX Page Item so Region Refresh sees it
                        const sessionItem = chatPrompt.page.items.chatSessionId || "P114_CHAT_SESSION_ID";
                        apex.item(sessionItem).setValue(session.sessionId);
                        
                        console.log(`‚úÖ Session ID [${session.sessionId}] synced to UI`);
                    }
    
                    if (!session.success) return; 
    
                    // 2Ô∏è‚É£ DETECT DOMAIN
                    const domain = await chatPrompt.detectDomain(
                        { sessionId: session.sessionId, callId: session.callId, traceId: session.traceId }, 
                        userText
                    );
                    
                    if (!domain.success) return; 
    
                    // 3Ô∏è‚É£ INVOKE LLM
                    const llm = await chatPrompt.invokeLLM(
                        { sessionId: session.sessionId, callId: session.callId, traceId: session.traceId, contextDomainId: domain.contextDomainId }, 
                        userText
                    );
    
                } catch (e) {
                    console.error("üí• Pipeline Error (Refreshing anyway):", e);
                    mustRefresh = true; 
                } finally {
                    
                    chatPrompt.state.isSending = false;
                    if (chatPrompt.state.typing) chatPrompt.state.typing.style.display = "none";
                    if (chatPrompt.state.btnSend) chatPrompt.state.btnSend.disabled = false;
    
                    // üîÑ ROBUST REFRESH
                    if (mustRefresh) {
                        console.log(`üîÑ Refreshing Regions for Session: ${activeSessionId || "Existing"}`);
                        
                        // Safety: Ensure item is set one last time before refresh
                        if (activeSessionId) {
                             apex.item("P114_CHAT_SESSION_ID").setValue(activeSessionId);
                        }
    
                        setTimeout(() => {
                            const callsRegion = chatPrompt.page.regions.chatCalls;
                            const sessionsRegion = chatPrompt.page.regions.chatSessions;
                            
                            if (callsRegion) apex.region(callsRegion).refresh();
                            if (sessionsRegion) apex.region(sessionsRegion).refresh();
                            
                        }, 200); // Slight delay for DB latency
                    }
                }
            };
            console.log("‚úÖ Hotfix Applied: Session ID will now sync before refresh.");
        }
    })();
  execute-when-page-loads: |
    /* ======================================================================
       ENTERPRISE AI ASSISTANT ‚Äî PAGE LOAD BOOTSTRAP
       APEX 24.x Safe | DEV / PROD | Sequential Loading
       ====================================================================== */
    
    /* ------------------------------------------------------------
       ENV
    ------------------------------------------------------------ */
    window.APP_ENV = '&G_APP_ENV.'.trim();
    console.log("üåç APP_ENV =", window.APP_ENV);
    
    /* ------------------------------------------------------------
       GLOBAL SEQUENTIAL SCRIPT LOADER
    ------------------------------------------------------------ */
    window.loadSequential = function (urls, done) {
        if (!urls || !urls.length) {
            console.log("üéâ All scripts loaded");
            if (typeof done === "function") done();
            return;
        }
    
        const url = urls.shift();
        const s = document.createElement("script");
        s.src = url;
        s.type = "text/javascript";
    
        s.onload = () => {
            console.log("üì¶ Loaded:", url);
            window.loadSequential(urls, done);
        };
    
        s.onerror = () => {
            console.error("‚ùå Failed:", url);
            window.loadSequential(urls, done);
        };
    
        document.head.appendChild(s);
    };
    
    /* ------------------------------------------------------------
       SCRIPT LIST
    ------------------------------------------------------------ */
    const scripts = [
        "#WORKSPACE_FILES#chat/assistant/src/chatContext#MIN#.js",
        "#WORKSPACE_FILES#chat/assistant/src/chatPrompt#MIN#.js",
        "#WORKSPACE_FILES#chat/assistant/src/chatSession#MIN#.js",
        "#WORKSPACE_FILES#chat/assistant/src/chatCalls#MIN#.js"
    ];
    
    /* ------------------------------------------------------------
       LOAD + INIT (ONLY PLACE WHERE MODULES ARE TOUCHED)
    ------------------------------------------------------------ */
    window.loadSequential(scripts, function () {
        console.log("üî• Chat Assistant scripts ready");
    
        /* -----------------------------
           1Ô∏è‚É£ INIT CONTEXT FIRST
        ----------------------------- */
        window.chatContext?.init?.();
    
        /* -----------------------------
           2Ô∏è‚É£ BIND PAGE CONTRACT
        ----------------------------- */
        window.chatPrompt?.initPage?.({
            items: {
                // --- Core Configuration ---
                provider:           "P114_PROVIDER",
                model:              "P114_MODEL",
                systemInstructions: "P114_SYSTEM_INSTRUCTIONS", 
    
                // --- Hyperparameters ---
                temperature:        "P114_TEMPERATURE",
                maxTokens:          "P114_MAX_TOKENS",
                topP:               "P114_TOP_P",
                topK:               "P114_TOP_K",
                
                // --- Streaming & RAG (NEW) ---
                streamEnabled:      "P114_STREAM_ENABLED",
                streamChannel:      "P114_STREAM_CHANNEL",
                contextDomainId:    "P114_CONTEXT_DOMAIN_ID", 
    
                // --- App Metadata ---
                sessionTitle:       "P114_SESSION_TITLE",
                reportIssueUrl:     "P114_REPORT_ISSUE_URL"
            },
            regions: {
                chatCalls:      "ChatCallsStaticId",
                chatSessions:   "myActiveSessionStaticID",
                chatProjects:   "myProjectsTreeStaticID"
            }
        });
    
        /* -----------------------------
           3Ô∏è‚É£ INIT MODULES (ORDERED)
        ----------------------------- */
        window.chatPrompt?.init?.();
        window.chatSession?.init?.();
        window.chatCalls?.init?.();
    
     
        /* -----------------------------
           5Ô∏è‚É£ DEBUG (DEV ONLY)
        ----------------------------- */
        if (window.APP_ENV === "DEV") {
            console.log("üß™ chatPrompt API:", Object.keys(window.chatPrompt || {}));
            console.log("üß† Current Session:", window.chatContext?.getSession?.());
        }
    });

css: 
  inline: |
    /* ============================================================
       CHATGPT-STYLE PROMPT BAR ‚Äî FINAL / CLEAN / APEX SAFE
       ============================================================ */
    
    /* ------------------------------------------------------------
       Sticky wrapper at bottom
    ------------------------------------------------------------ */
    #chatPrompt.chatPrompt-wrapper {
        position: sticky;
        bottom: 0;
        z-index: 100;
        border-top: 1px solid #e5e7eb;
        padding: 12px 0 14px;
    }
    
    /* ------------------------------------------------------------
       Center content (ChatGPT width)
    ------------------------------------------------------------ */
    #chatPrompt .container {
        max-width: 920px;
        margin: 0 auto;
        padding: 0 12px;
    }
    
    /* ------------------------------------------------------------
       Neutralize APEX grid + floating label spacing
    ------------------------------------------------------------ */
    #chatPrompt .row,
    #chatPrompt .col,
    #chatPrompt .t-Form-fieldContainer {
        margin: 0 !important;
        padding: 0 !important;
    }
    
    /* ------------------------------------------------------------
       Prompt container (anchor for floating send button)
    ------------------------------------------------------------ */
    #P114_USER_PROMPT_CONTAINER {
        position: relative;
    }
    
    /* ------------------------------------------------------------
       Textarea ‚Äî ChatGPT style
    ------------------------------------------------------------ */
    .chatPrompt-input {
        width: 100%;
        min-height: 48px;
        max-height: 200px;
    
        padding: 14px 56px 14px 16px;
        border-radius: 24px;
    
        border: 1px solid #d1d5db;
     
    
        font-size: 15px;
        line-height: 1.45;
    
        resize: none !important;
        overflow-y: auto;
    
        box-shadow: none;
        transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }
    
    /* Focus effect */
    .chatPrompt-input:focus {
        outline: none;
        border-color: #2563eb;
        box-shadow: 0 0 0 1px #2563eb;
    }
    
    /* ------------------------------------------------------------
       Floating SEND button (ChatGPT style)
    ------------------------------------------------------------ */
    .chatPrompt-sendBtn {
        position: absolute;
        right: 10px;
        bottom: 8px;
    
        width: 36px;
        height: 36px;
        padding: 0;
    
        border-radius: 50%;
        border: none;
    
        background: #2563eb;
        color: #ffffff;
    
        display: flex;
        align-items: center;
        justify-content: center;
    
        cursor: pointer;
    
        box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        transition: background 0.15s ease, transform 0.1s ease;
    }
    
    /* Hide APEX button label */
    .chatPrompt-sendBtn .t-Button-label {
        display: none;
    }
    
    /* Arrow icon */
    .chatPrompt-sendBtn::before {
        content: "‚û§";
        font-size: 16px;
        margin-left: 2px;
    }
    
    /* Hover */
    .chatPrompt-sendBtn:hover {
        background: #1d4ed8;
        transform: scale(1.05);
    }
    
    /* Disabled (streaming-safe) */
    .chatPrompt-sendBtn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        box-shadow: none;
        transform: none;
    }
    
    /* ------------------------------------------------------------
       Typing indicator (optional)
    ------------------------------------------------------------ */
    .chatPrompt-typingIndicator span {
        animation: blink 1.4s infinite both;
        opacity: 0.3;
    }
    
    @keyframes blink {
        0%   { opacity: .3; }
        20%  { opacity: 1; }
        100% { opacity: .3; }
    }
    
    /* ------------------------------------------------------------
       Mobile adjustments
    ------------------------------------------------------------ */
    @media (max-width: 640px) {
        #chatPrompt .container {
            padding: 0 8px;
        }
    
        .chatPrompt-input {
            font-size: 14px;
        }
    }
    
     
     
     
    
     /* ============================================================
       Chat Call ‚ãÆ Menu ‚Äî SINGLE SOURCE OF TRUTH
       ============================================================ */
    
    .chatCall-header {
        position: relative;
        z-index: 1;
    }
    
    .chatCall-more {
        position: relative;
        z-index: 10;
    }
    
    
    .chatCall-moreDropdown {
        display: none;
        position: fixed;
        z-index: 2147483647;
    
        min-width: 180px;
    
        /* üîí HARD BACKGROUND LOCK */
        background-color: #ffffff !important;
        background-clip: padding-box;
        opacity: 1 !important;
    
        border: 1px solid #dcdcdc;
        border-radius: 6px;
        padding: 6px 0;
    
        box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    
        /* üîí COMPOSITING + ISOLATION */
        isolation: isolate;
        transform: translate3d(0,0,0);
        backface-visibility: hidden;
        will-change: transform;
    
        /* üîí PREVENT BLENDING */
        mix-blend-mode: normal;
        filter: none !important;
    
        /* üîí INTERACTION SAFETY */
        pointer-events: auto;
    }
    
    .chatCall-menuItem {
        display: block;
        width: 100%;
        padding: 8px 14px;
        background: transparent;
        border: 0;
        text-align: left;
        cursor: pointer;
    }
    
    .chatCall-menuItem:hover {
        background: #f3f4f6;
    }
    
    
    .chatCall-moreDropdown {
        display: none;
    }
    
    .chatCall-moreDropdown.is-visible {
        display: block;
    }
    
    
    /* ============================================================
       CHAT CALL CARD ‚Äî CLEAN & MODERN
       ============================================================ */
    
    .chatCall-wrapper {
        display: flex;
        justify-content: center;
        margin: 14px 0;
    }
    
    .chatCall-wrapper.is-active .chatCall-card {
        border-color: #2563eb;
        box-shadow: 0 6px 22px rgba(37, 99, 235, 0.18);
    }
    
    /* Card */
    .chatCall-card {
        width: 100%;
        max-width: 920px;
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 14px;
        padding: 14px 16px 12px;
        transition: box-shadow 0.2s ease, border-color 0.2s ease;
    }
    
    /* ============================================================
       HEADER
       ============================================================ */
    
    .chatCall-header {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 13px;
        color: #4b5563;
        margin-bottom: 8px;
    }
    
    /* Domain badge */
    .chatCall-domainBadge {
        background: #eef2ff;
        color: #3730a3;
        font-weight: 600;
        font-size: 11px;
        padding: 3px 10px;
        border-radius: 999px;
    }
    
    /* Time */
    .chatCall-time {
        margin-left: auto;
        font-size: 11px;
        color: #6b7280;
        white-space: nowrap;
    }
    
    /* ============================================================
       CONTENT
       ============================================================ */
    
    .chatCall-content {
        display: flex;
        flex-direction: column;
        gap: 6px;
        font-size: 14px;
        line-height: 1.55;
    }
    
    /* User */
    .chatCall-userText {
        color: #111827;
        font-weight: 600;
    }
    
    /* Assistant */
    .chatCall-assistantText {
        color: #1f2937;
        background: #f9fafb;
        padding: 10px 12px;
        border-radius: 10px;
    }
    
    /* ============================================================
       METADATA
       ============================================================ */
    
    .chatCall-metadataToggle {
        margin-top: 8px;
        font-size: 12px;
        color: #2563eb;
        cursor: pointer;
        user-select: none;
    }
    
    .chatCall-metadata {
        display: none;
        margin-top: 8px;
        padding-top: 8px;
        border-top: 1px dashed #e5e7eb;
        font-size: 12px;
        color: #374151;
    }
    
    /* ============================================================
       ‚ãÆ MENU BUTTON
       ============================================================ */
    
    .chatCall-more {
        position: relative;
    }
    
    .chatCall-moreBtn {
        cursor: pointer;
        font-size: 18px;
        line-height: 1;
        padding: 4px 6px;
        border-radius: 6px;
        color: #6b7280;
    }
    
    .chatCall-moreBtn:hover {
        background: #f3f4f6;
        color: #111827;
    }
    
    /* ============================================================
       ‚ãÆ DROPDOWN MENU
       ============================================================ */
    
    .chatCall-moreDropdown {
        display: none;
        position: fixed;
        z-index: 2147483647;
    
        min-width: 180px;
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 10px;
        padding: 6px 0;
    
        box-shadow:
            0 12px 28px rgba(0,0,0,0.12),
            0 2px 6px rgba(0,0,0,0.08);
    }
    
    /* Visible state (controlled by JS) */
    .chatCall-moreDropdown.is-visible {
        display: block;
    }
    
    /* ============================================================
       MENU ITEMS
       ============================================================ */
    
    .chatCall-menuItem {
        width: 100%;
        padding: 9px 14px;
        border: 0;
        background: transparent;
        font-size: 13px;
        color: #111827;
        text-align: left;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .chatCall-menuItem:hover {
        background: #f3f4f6;
    }
    
    /* Danger action */
    .chatCall-deleteBtn {
        color: #dc2626;
    }
    
    .chatCall-deleteBtn:hover {
        background: #fee2e2;
    }
    
    /* ============================================================
       ACCESSIBILITY
       ============================================================ */
    
    .chatCall-menuItem:focus-visible,
    .chatCall-moreBtn:focus-visible {
        outline: 2px solid #2563eb;
        outline-offset: 2px;
    }
    
    /* ============================================================
       MOBILE TWEAKS
       ============================================================ */
    
    @media (max-width: 640px) {
        .chatCall-card {
            border-radius: 12px;
            padding: 12px;
        }
    
        .chatCall-domainBadge {
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
    }

security: 
  authentication: Page Requires Authentication
  deep-linking: Application Default
  page-access-protection: Arguments Must Have Checksum
  form-auto-complete: Off
  browser-cache: Application Default

session-management: 
  rejoin-sessions: Application Default

advanced: 
  enable-duplicate-page-submissions: Yes - Enable page to be re-posted
  reload-on-submit: Only for Success

server-cache: 
  caching: Disabled

regions: 
- # ====== Region: chatCall-scrollBtn ==========================
  id: 151725297394589509
  identification: 
    name: chatCall-scrollBtn
    type: Static Content

  source: 
    html-code: <button class="chatCall-scrollBtn">‚Üì Latest</button>

  layout: 
    sequence: 10
    parent-region: MAIN CONTAINER # 441655286029646467
    slot: SUB_REGIONS
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Blank with Attributes
    template-options: 
    - '#DEFAULT#'
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    static-id: chatCall-scrollBtn
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: dlg-Call-Rating =============================
  id: 151726325874589520
  identification: 
    name: dlg-Call-Rating
    type: Static Content

  layout: 
    sequence: 150
    parent-region: No Parent
    slot: REGION_POSITION_04
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Standard
    template-options: 
    - '#DEFAULT#'
    - t-Region--scrollBody
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: darkModeToggle ==============================
  id: 151727682637589533
  identification: 
    name: darkModeToggle
    type: Static Content

  source: 
    html-code: |
      <button id="darkModeToggle" class="darkmode-toggle-btn" type="button">
          üåô
      </button>

  layout: 
    sequence: 10
    parent-region: Right Panel # 443085927550063585
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Standard
    template-options: 
    - '#DEFAULT#'
    - t-Region--scrollBody
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  configuration: 
    build-option: Commented Out # 123954063565486069

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: dlg-Move-Session ============================
  id: 155687807448186614
  identification: 
    name: dlg-Move-Session
    title: Move Session
    type: Static Content

  source: 
    html-code: ' '

  layout: 
    sequence: 140
    parent-region: No Parent
    slot: REGION_POSITION_04
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Inline Dialog
    template-options: 
    - '#DEFAULT#'
    - js-dialog-autoheight
    - js-dialog-size480x320
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    static-id: moveSessionRegionId
    custom-attributes: 
    - data-parent-element="#btnNewSession"
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: MAIN CONTAINER ==============================
  id: 155691286455186648
  identification: 
    name: MAIN CONTAINER
    title: AI Assistant
    type: Static Content

  source: 
    html-code: |
      <div id="chatWindow" class="chat-window"></div>
      
      <button id="loadMoreBtn" style="
          display:none;
          margin: 10px auto;
          padding: 8px 18px;
          border-radius: 8px;
          border: 1px solid #ccc;
          background: #fff;
      ">Load More</button>
      
      <div id="typingIndicator" class="typing-indicator" style="display:none;">
          <span class="dot"></span><span class="dot"></span><span class="dot"></span>
      </div>
       
      <!-- Session-Level Actions -->
      <div id="session-actions" style="position: absolute; top: 16px; right: 16px;">
          <div class="more-menu-container">
              <button class="action-btn session-more-btn" title="Session options" style="
                  width: 36px;
                  height: 36px;
                  border: 1px solid #e2e8f0;
                  border-radius: 8px;
                  background: white;
                  color: #64748b;
                  cursor: pointer;
              ">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="1"></circle>
                      <circle cx="19" cy="12" r="1"></circle>
                      <circle cx="5" cy="12" r="1"></circle>
                  </svg>
              </button>
              <div class="more-menu session-more-menu" style="display: none; right: 0; left: auto;">
                  <button class="more-menu-item report-session-issue-btn">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                          <line x1="12" y1="9" x2="12" y2="13"></line>
                          <line x1="12" y1="17" x2="12.01" y2="17"></line>
                      </svg>
                      Report Session Issue
                  </button>
                  <button class="more-menu-item export-session-btn">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                          <polyline points="7 10 12 15 17 10"></polyline>
                          <line x1="12" y1="15" x2="12" y2="3"></line>
                      </svg>
                      Export Conversation
                  </button>
                  <button class="more-menu-item clear-session-btn">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <polyline points="3 6 5 6 21 6"></polyline>
                          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                      </svg>
                      Clear Session
                  </button>
              </div>
          </div>
       
      </div>

  layout: 
    sequence: 50
    parent-region: No Parent
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Blank with Attributes
    template-options: 
    - '#DEFAULT#'
    icon: fa-ai-sparkle-enlarge
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  configuration: 
    build-option: Commented Out # 123954063565486069

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: Classifier ==================================
  id: 297380456515313363
  identification: 
    name: Classifier
    title: ...
    type: Static Content

  layout: 
    sequence: 70
    parent-region: No Parent
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Collapsible
    template-options: 
    - '#DEFAULT#'
    - js-useLocalStorage
    - t-Region--hideShowIconsMath
    - is-collapsed
    - t-Region--noUI
    - t-Region--scrollBody
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    static-id: cxd_classifier
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: Left_Side ===================================
  id: 299892034523071248
  identification: 
    name: Left_Side
    type: Static Content

  layout: 
    sequence: 60
    parent-region: No Parent
    slot: REGION_POSITION_02
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Blank with Attributes
    template-options: 
    - '#DEFAULT#'
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    static-id: myProjectsTreeStaticID
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: MyProjectsTree ==============================
  id: 300461147415765424
  identification: 
    name: MyProjectsTree
    title: Projects
    type: Tree

  source: 
    location: Local Database
    type: SQL Query
    sql-query: |
      SELECT 
          LEVEL                                             AS tree_level,
          
          -- Required by APEX Tree Region
           item_id                      AS node_id,
          parent_id                                         AS parent_node_id,
          DECODE(item_type, 'PROJECT','üìÅ ','üí¨ ') 
              || item_title                                AS node_label,
          item_type||'|' || item_id  || '|'  || parent_id AS Node_Value_Column, --Workaround to get nodeIds
          -- Optional but useful for APEX config
          item_type                                         AS node_type,
          item_title                                        AS title,
          created_at                                        AS created_at,
          last_activity                                     AS last_activity,
          session_count                                     AS session_count,
          token_total                                       AS token_total,
          token_cost                                        AS token_cost,
      
          -- For ordering inside tree
          created_at                                        AS order_value,
      
          -- Optional icon class if needed
          CASE 
              WHEN item_type = 'PROJECT' THEN 'icon-tree-folder'
              ELSE 'icon-tree-file'
          END                                               AS icon_css
      
      FROM (
          ----------------------------------------------------------------------
          -- Level 1: Projects
          ----------------------------------------------------------------------
          SELECT 
              'PROJECT'                AS item_type,
              cp.CHAT_PROJECT_ID       AS item_id,
              NULL                     AS parent_id,
              cp.PROJECT_NAME          AS item_title,
              cp.IS_ACTIVE             AS is_active,
              cp.CREATED_AT            AS created_at,
              NULL                     AS last_activity,
              (SELECT COUNT(*) 
               FROM CHAT_SESSIONS cs2
               WHERE cs2.CHAT_PROJECT_ID = cp.CHAT_PROJECT_ID
                 AND cs2.IS_ACTIVE = 'Y') AS session_count,
              NULL                     AS token_total,
              NULL                     AS token_cost
          FROM CHAT_PROJECTS cp
          WHERE cp.IS_ACTIVE = 'Y'
          
          UNION ALL
      
          ----------------------------------------------------------------------
          -- Level 2: Sessions
          ----------------------------------------------------------------------
          SELECT
              'SESSION'                AS item_type,
              cs.SESSION_ID            AS item_id,
              cs.CHAT_PROJECT_ID       AS parent_id,
              NVL(cs.SESSION_TITLE, 'Untitled Session') AS item_title,
              cs.IS_ACTIVE             AS is_active,
              cs.CREATED_DATE          AS created_at,
              cs.LAST_ACTIVITY_DATE    AS last_activity,
              NULL                     AS session_count,
              cs.TOKENS_TOTAL          AS token_total,
              cs.TOKENS_TOTAL_COST     AS token_cost
          FROM CHAT_SESSIONS cs
          WHERE cs.IS_ACTIVE = 'Y'
            AND cs.CHAT_PROJECT_ID IS NOT NULL
      )
      START WITH parent_id IS NULL
      CONNECT BY PRIOR item_id = parent_id
      ORDER SIBLINGS BY created_at DESC;
    page-items-to-submit: 
    - P114_ISSUE_LEVEL

  layout: 
    sequence: 10
    parent-region: Left_Side # 299892034523071248
    slot: SUB_REGIONS
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Blank with Attributes
    template-options: 
    - '#DEFAULT#'
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    static-id: myProjectsTreeStaticID
    region-display-selector: false
    exclude-title-from-translation: false

  server-cache: 
    caching: Disabled

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      node-label-column: NODE_LABEL
      node-value-column: NODE_VALUE_COLUMN
      hierarchy: Computed with SQL
      node-id-column: NODE_ID
      parent-key-column: PARENT_NODE_ID
      start-tree-with: Value is NULL
      order-siblings-by: ORDER_VALUE
      tooltip: Database Column
      tooltip-column: NODE_ID
      activate-node-link-with: Single Click
      link: 'javascript:void(0);'
      icon-css-class-column: ICON_CSS
      default-icon-css-class: icon-tree-folder
      selected-node-page-item: P114_ISSUE_LEVEL

    performance: 
      lazy-loading: false

- # ====== Region: myActiveSession =============================
  id: 300501172210850030
  identification: 
    name: myActiveSession
    type: Classic Report

  source: 
    location: Local Database
    type: SQL Query
    sql-query: |
      select   :P114_CHAT_SESSION_ID CHAT_SESSION_ID ,
               :P114_CHAT_PROJECT_ID  CHAT_PROJECT_ID ,
               :P114_CHAT_PROJECT_TITLE CHAT_PROJECT_TITLE,
               :P114_SESSION_TITLE CHAT_SESSION_TITLE,
               'SESSION' as ISSUE_LEVEL,--link to page116
               :P114_CHAT_SESSION_ID as  ENTITY_ID --link to page116
      from dual 
      where :P114_CHAT_SESSION_ID is not null;
      
      
      
    page-items-to-submit: 
    - P114_CHAT_SESSION_ID
    - P114_CHAT_PROJECT_ID
    - P114_NEW_CHAT_PROJECT_TITLE
    - P114_SESSION_TITLE

  order-by: 
    type: None

  layout: 
    sequence: 10
    parent-region: No Parent
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Blank with Attributes (No Grid)
    template-options: 
    - '#DEFAULT#'
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    static-id: myActiveSessionStaticID
    region-display-selector: false
    exclude-title-from-translation: false

  server-cache: 
    caching: Disabled

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    layout: 
      number-of-rows-type: Static Value
      number-of-rows: 15

    appearance: 
      template-type: Theme
      template: Chat SESSION Header
      template-options: 
      - '#DEFAULT#'

    pagination: 
      type: No Pagination (Show All Rows)
      partial-page-refresh: true

    performance: 
      lazy-loading: false

    break-formatting: 
      break-columns: No Break

    advanced: 
      strip-html: false
      sort-nulls: Last

    heading: 
      type: Custom Headings

    download: 
      csv-export-enabled: false

    printing: 
      enabled: false

  columns: 
  - # ====== Column: CHAT_SESSION_ID =============================
    id: 151667862254556198
    identification: 
      column-name: CHAT_SESSION_ID
      type: Plain Text

    heading: 
      heading: Chat Session Id
      alignment: start

    layout: 
      sequence: 20
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: true

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: CHAT_PROJECT_ID =============================
    id: 151668211942556199
    identification: 
      column-name: CHAT_PROJECT_ID
      type: Plain Text

    heading: 
      heading: Chat Project Id
      alignment: end

    layout: 
      sequence: 10
      column-alignment: end

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: true

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: CHAT_PROJECT_TITLE ==========================
    id: 151668657445556200
    identification: 
      column-name: CHAT_PROJECT_TITLE
      type: Plain Text

    heading: 
      heading: Chat Project Title
      alignment: start

    layout: 
      sequence: 30
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: true

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: CHAT_SESSION_TITLE ==========================
    id: 151669045823556201
    identification: 
      column-name: CHAT_SESSION_TITLE
      type: Plain Text

    heading: 
      heading: Chat Session Title
      alignment: start

    layout: 
      sequence: 40
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: true

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: ISSUE_LEVEL =================================
    id: 151669458452556202
    identification: 
      column-name: ISSUE_LEVEL
      type: Plain Text

    heading: 
      heading: Issue Level
      alignment: start

    layout: 
      sequence: 50
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: true

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: ENTITY_ID ===================================
    id: 151669883169556203
    identification: 
      column-name: ENTITY_ID
      type: Plain Text

    heading: 
      heading: Entity Id
      alignment: start

    layout: 
      sequence: 60
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: true

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

- # ====== Region: dlg-New Project =============================
  id: 301798403176221119
  identification: 
    name: dlg-New Project
    title: New Project
    type: Static Content

  layout: 
    sequence: 120
    parent-region: No Parent
    slot: REGION_POSITION_04
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Inline Dialog
    template-options: 
    - '#DEFAULT#'
    - js-dialog-size600x400
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    static-id: new_project_dialog
    custom-attributes: 
    - data-parent-element="#btnNewProject"
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: dlg-New-Session =============================
  id: 301798572574221120
  identification: 
    name: dlg-New-Session
    title: New Session
    type: Static Content

  source: 
    html-code: ' '

  layout: 
    sequence: 130
    parent-region: No Parent
    slot: REGION_POSITION_04
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Inline Dialog
    template-options: 
    - '#DEFAULT#'
    - js-dialog-size600x400
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    static-id: new_session_dialog
    custom-attributes: 
    - data-parent-element="#btnNewSession"
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: Session&Project Actions =====================
  id: 301801575118221150
  identification: 
    name: Session&Project Actions
    type: Static Content

  layout: 
    sequence: 10
    parent-region: Left_Side # 299892034523071248
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Buttons Container
    template-options: 
    - '#DEFAULT#'
    - t-ButtonRegion--noUI
    css-classes: 
    - sidebar-actions
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: LLM Calls ===================================
  id: 301843113611557821
  identification: 
    name: LLM Calls
    type: Classic Report

  source: 
    location: Local Database
    type: SQL Query
    sql-query: |
      SELECT  
             -- Core Identifiers
             c.call_id,
             c.call_seq  ,
             'USER' MESSAGE_ROLE, 
             -- Content
             c.user_prompt,
             c.response_text ,
          -- Escaped for JavaScript
             REPLACE(REPLACE(c.response_text, '"', '\"'), CHR(10), '\n') AS response_escaped,
             LENGTH(c.response_text) AS content_length,
             -- Token Usage
             NVL(c.tokens_total, 0)  AS tokens_total,
             NVL(c.tokens_input, 0)  AS tokens_input,
             NVL(c.tokens_output, 0) AS tokens_output,
       
             NVL(c.cost_usd, 0)      AS tokens_cost,
      
             -- Performance Metrics
             NVL(c.total_pipeline_ms, 0) AS processing_time_ms,
      
             -- RAG Context
             NVL(c.rag_context_doc_count, 0) AS rag_doc_count,
              
             CASE WHEN parent_chat_call_id IS NOT NULL THEN '‚Üª REGENERATED'
              ELSE NULL
             END AS REGEN_TEXT,
           
             CASE  WHEN TRUNC(c.db_created_at) = TRUNC(SYSDATE)
                  THEN TO_CHAR(c.db_created_at, 'HH24:MI')
              ELSE  TO_CHAR(c.db_created_at, 'YYYY-MM-DD HH24:MI')
              END AS DISPLAY_DATE,
      
             TO_CHAR(c.db_created_at, 'HH24:MI')               AS message_time,
             TO_CHAR(c.db_created_at, 'YYYY-MM-DD HH24:MI:SS') AS full_timestamp,
             TO_CHAR(c.db_created_at, 'Mon DD, YYYY')          AS message_date,
       
             -- User Rating
             c.user_rating,
             c.user_rating_comment,
             c.user_rating_ts,
      
             CASE c.USER_RATING
                  WHEN 'LIKE' THEN 'üëç'
                  WHEN 'DISLIKE' THEN 'üëé'
                  WHEN 'NEUTRAL' THEN 'üòê'
                  WHEN 'EXCELLENT' THEN '‚≠ê'
                  ELSE ''
              END AS RATING_ICON,
       
             CASE WHEN c.user_rating = 'LIKE'    THEN 'active' ELSE '' END AS rate_like_active,
             CASE WHEN c.user_rating = 'DISLIKE' THEN 'active' ELSE '' END AS rate_dislike_active,
      
             -- Deletion Flag
             NVL(c.is_deleted, 'N') AS is_deleted,
      
             -- Context Domain
             COALESCE(d.domain_name, 'GENERAL') AS context_domain_name,
      
             -- Parent Call (regeneration)
             pr.parent_chat_call_id,
             pc.response_text AS parent_message_content,
             pc.message_role  AS parent_message_role 
       
       
         
      FROM chat_calls c
      
           -- Domain lookup
           LEFT JOIN context_domains d   ON d.context_domain_id = c.context_domain_id
      
           -- Regeneration Link
           LEFT JOIN chat_call_regenerations pr
               ON pr.child_chat_call_id = c.call_id
      
           -- Parent call details
           LEFT JOIN chat_calls pc
               ON pc.call_id = pr.parent_chat_call_id
      
      WHERE c.chat_session_id = :P114_CHAT_SESSION_ID --acive session
       -- AND NVL(c.is_deleted, 'N') = 'N'
           
      ORDER BY c.call_seq Asc;
    page-items-to-submit: 
    - P114_CHAT_SESSION_ID

  order-by: 
    type: None

  layout: 
    sequence: 20
    parent-region: No Parent
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Blank with Attributes
    template-options: 
    - '#DEFAULT#'
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    static-id: ChatCallsStaticId
    region-display-selector: false
    exclude-title-from-translation: false

  server-cache: 
    caching: Disabled

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    layout: 
      number-of-rows-type: Static Value
      number-of-rows: 15

    appearance: 
      template-type: Theme
      template: ChatCalls Region
      template-options: 
      - '#DEFAULT#'

    pagination: 
      type: No Pagination (Show All Rows)
      partial-page-refresh: true

    performance: 
      lazy-loading: false

    break-formatting: 
      break-columns: No Break

    advanced: 
      strip-html: false
      sort-nulls: Last

    heading: 
      type: Custom Headings

    download: 
      csv-export-enabled: false

    printing: 
      enabled: false

  columns: 
  - # ====== Column: CALL_SEQ ====================================
    id: 150189180214001750
    identification: 
      column-name: CALL_SEQ
      type: Plain Text

    heading: 
      heading: Call Seq
      alignment: end

    layout: 
      sequence: 280
      column-alignment: end

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: TOKENS_INPUT ================================
    id: 151672808081556212
    identification: 
      column-name: TOKENS_INPUT
      type: Plain Text

    heading: 
      heading: Tokens Input
      alignment: end

    layout: 
      sequence: 70
      column-alignment: end

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: TOKENS_OUTPUT ===============================
    id: 151673297786556213
    identification: 
      column-name: TOKENS_OUTPUT
      type: Plain Text

    heading: 
      heading: Tokens Output
      alignment: end

    layout: 
      sequence: 80
      column-alignment: end

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: TOKENS_COST =================================
    id: 151673662112556214
    identification: 
      column-name: TOKENS_COST
      type: Plain Text

    heading: 
      heading: Tokens Cost
      alignment: end

    layout: 
      sequence: 100
      column-alignment: end

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: PROCESSING_TIME_MS ==========================
    id: 151674034883556216
    identification: 
      column-name: PROCESSING_TIME_MS
      type: Plain Text

    heading: 
      heading: Processing Time Ms
      alignment: end

    layout: 
      sequence: 110
      column-alignment: end

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: RAG_DOC_COUNT ===============================
    id: 151674404529556217
    identification: 
      column-name: RAG_DOC_COUNT
      type: Plain Text

    heading: 
      heading: Rag Doc Count
      alignment: end

    layout: 
      sequence: 120
      column-alignment: end

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: MESSAGE_TIME ================================
    id: 151674827200556218
    identification: 
      column-name: MESSAGE_TIME
      type: Plain Text

    heading: 
      heading: Message Time
      alignment: start

    layout: 
      sequence: 130
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: FULL_TIMESTAMP ==============================
    id: 151675294520556219
    identification: 
      column-name: FULL_TIMESTAMP
      type: Plain Text

    heading: 
      heading: Full Timestamp
      alignment: start

    layout: 
      sequence: 140
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: MESSAGE_DATE ================================
    id: 151675677166556220
    identification: 
      column-name: MESSAGE_DATE
      type: Plain Text

    heading: 
      heading: Message Date
      alignment: start

    layout: 
      sequence: 150
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: USER_RATING =================================
    id: 151676009115556221
    identification: 
      column-name: USER_RATING
      type: Plain Text

    heading: 
      heading: User Rating
      alignment: start

    layout: 
      sequence: 160
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: IS_DELETED ==================================
    id: 151676418536556222
    identification: 
      column-name: IS_DELETED
      type: Plain Text

    heading: 
      heading: Is Deleted
      alignment: start

    layout: 
      sequence: 170
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: CONTEXT_DOMAIN_NAME =========================
    id: 151676860914556224
    identification: 
      column-name: CONTEXT_DOMAIN_NAME
      type: Plain Text

    heading: 
      heading: Context Domain Name
      alignment: start

    layout: 
      sequence: 180
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: PARENT_MESSAGE_ROLE =========================
    id: 151677209072556225
    identification: 
      column-name: PARENT_MESSAGE_ROLE
      type: Plain Text

    heading: 
      heading: Parent Message Role
      alignment: start

    layout: 
      sequence: 190
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: PARENT_MESSAGE_CONTENT ======================
    id: 151677673439556226
    identification: 
      column-name: PARENT_MESSAGE_CONTENT
      type: Plain Text

    heading: 
      heading: Parent Message Content
      alignment: start

    layout: 
      sequence: 200
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: CONTENT_LENGTH ==============================
    id: 151679650324556231
    identification: 
      column-name: CONTENT_LENGTH
      type: Plain Text

    heading: 
      heading: Content Length
      alignment: end

    layout: 
      sequence: 210
      column-alignment: end

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: CALL_ID =====================================
    id: 151680050806556232
    identification: 
      column-name: CALL_ID
      type: Plain Text

    heading: 
      heading: Call Id
      alignment: end

    layout: 
      sequence: 220
      column-alignment: end

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: USER_PROMPT =================================
    id: 151680407164556233
    identification: 
      column-name: USER_PROMPT
      type: Plain Text

    heading: 
      heading: User Prompt
      alignment: start

    layout: 
      sequence: 60
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: false

  - # ====== Column: USER_RATING_COMMENT =========================
    id: 151680809541556234
    identification: 
      column-name: USER_RATING_COMMENT
      type: Plain Text

    heading: 
      heading: User Rating Comment
      alignment: start

    layout: 
      sequence: 230
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: USER_RATING_TS ==============================
    id: 151681206128556236
    identification: 
      column-name: USER_RATING_TS
      type: Plain Text

    heading: 
      heading: User Rating Ts
      alignment: start

    layout: 
      sequence: 240
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: RATE_LIKE_ACTIVE ============================
    id: 151681614177556237
    identification: 
      column-name: RATE_LIKE_ACTIVE
      type: Plain Text

    heading: 
      heading: Rate Like Active
      alignment: start

    layout: 
      sequence: 250
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: RATE_DISLIKE_ACTIVE =========================
    id: 151682037082556238
    identification: 
      column-name: RATE_DISLIKE_ACTIVE
      type: Plain Text

    heading: 
      heading: Rate Dislike Active
      alignment: start

    layout: 
      sequence: 260
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: PARENT_CHAT_CALL_ID =========================
    id: 151682471630556239
    identification: 
      column-name: PARENT_CHAT_CALL_ID
      type: Plain Text

    heading: 
      heading: Parent Chat Call Id
      alignment: end

    layout: 
      sequence: 270
      column-alignment: end

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: RESPONSE_TEXT ===============================
    id: 151724441177589501
    identification: 
      column-name: RESPONSE_TEXT
      type: Plain Text

    heading: 
      heading: Response Text
      alignment: start

    layout: 
      sequence: 90
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: false

  - # ====== Column: RESPONSE_ESCAPED ============================
    id: 151724591892589502
    identification: 
      column-name: RESPONSE_ESCAPED
      type: Plain Text

    heading: 
      heading: Response Escaped
      alignment: start

    layout: 
      sequence: 300
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: MESSAGE_ROLE ================================
    id: 151724655461589503
    identification: 
      column-name: MESSAGE_ROLE
      type: Plain Text

    heading: 
      heading: Message Role
      alignment: start

    layout: 
      sequence: 310
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: DISPLAY_DATE ================================
    id: 151725668453589513
    identification: 
      column-name: DISPLAY_DATE
      type: Plain Text

    heading: 
      heading: Display Date
      alignment: start

    layout: 
      sequence: 320
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: REGEN_TEXT ==================================
    id: 151726052149589517
    identification: 
      column-name: REGEN_TEXT
      type: Plain Text

    heading: 
      heading: Regen Text
      alignment: start

    layout: 
      sequence: 330
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: TOKENS_TOTAL ================================
    id: 151726177473589518
    identification: 
      column-name: TOKENS_TOTAL
      type: Plain Text

    heading: 
      heading: Tokens Total
      alignment: end

    layout: 
      sequence: 340
      column-alignment: end

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

  - # ====== Column: RATING_ICON =================================
    id: 151726230010589519
    identification: 
      column-name: RATING_ICON
      type: Plain Text

    heading: 
      heading: Rating Icon
      alignment: start

    layout: 
      sequence: 350
      column-alignment: start

    accessibility: 
      value-identifies-row: false

    sorting: 
      sortable: false

    export-/-printing: 
      include-in-export-/-print: true

    advanced: 
      compute-sum: false

    ui-defaults-reference: 
      table-owner: Parsing Schema

    security: 
      escape-special-characters: true

- # ====== Region: MAIN CONTAINER ==============================
  id: 441655286029646467
  identification: 
    name: MAIN CONTAINER
    title: AI Assistant
    type: Static Content

  source: 
    html-code: ' '

  layout: 
    sequence: 40
    parent-region: No Parent
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Blank with Attributes
    template-options: 
    - '#DEFAULT#'
    icon: fa-ai-sparkle-enlarge
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    static-id: AI_CHAT_CONTAINER
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: Settings Panel ==============================
  id: 443084908686063575
  identification: 
    name: Settings Panel
    type: Static Content

  source: 
    html-code: |
      <div class="settings-panel">
          <label>Temperature</label>
          <input type="number" id="temperature" value="0.7" step="0.1" min="0" max="2">
      
          <label>Max Tokens</label>
          <input type="number" id="maxTokens" value="512" min="1">
      
          <label>Top P</label>
          <input type="number" id="topP" value="1" step="0.01" min="0" max="1">
      
          <label>Model</label>
          <select id="modelSelect"></select>
      </div>
      

  layout: 
    sequence: 20
    parent-region: No Parent
    slot: REGION_POSITION_03
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Inline Drawer
    template-options: 
    - '#DEFAULT#'
    - js-dialog-class-t-Drawer--pullOutEnd
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: chatPrompt ==================================
  id: 443085855512063584
  identification: 
    name: chatPrompt
    type: Static Content

  source: 
    html-code: ' '

  layout: 
    sequence: 30
    parent-region: MAIN CONTAINER # 441655286029646467
    slot: SUB_REGIONS
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Blank with Attributes
    template-options: 
    - '#DEFAULT#'
    css-classes: 
    - chatPrompt-wrapper
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    static-id: chatPrompt
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: Right Panel =================================
  id: 443085927550063585
  identification: 
    name: Right Panel
    type: Static Content

  layout: 
    sequence: 10
    parent-region: No Parent
    slot: REGION_POSITION_03
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Blank with Attributes
    template-options: 
    - '#DEFAULT#'
    css-classes: 
    - chatRightPanel
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    static-id: rightPanel
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

- # ====== Region: JS Loader ===================================
  id: 443086551263063591
  identification: 
    name: JS Loader
    type: Static Content

  layout: 
    sequence: 60
    parent-region: No Parent
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    template: Blank with Attributes
    template-options: 
    - '#DEFAULT#'
    render-components: Above Content

  accessibility: 
    use-landmark: true
    landmark-type: Template Default

  advanced: 
    static-id: chatScripts
    region-display-selector: false
    exclude-title-from-translation: false

  customization: 
    customizable: Not Customizable By End Users

  attributes: 
    settings: 
      output-as: HTML
      expand-shortcuts: false

page-items: 
- # ====== Page Item: P114_USER_PROMPT =========================
  id: 151724720828589504
  identification: 
    name: P114_USER_PROMPT
    type: Textarea

  label: 
    alignment: Left

  settings: 
    resizable: true
    auto-height: false
    character-counter: false
    trim-spaces: Leading and Trailing

  layout: 
    sequence: 10
    region: chatPrompt # 443085855512063584
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    width: 30
    height: 5
    value-placeholder: Ask me !!

  validation: 
    value-required: false

  advanced: 
    css-classes: 
    - chatUserPrompt
    - chatPrompt-input
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_CALL_ID =============================
  id: 151726401739589521
  identification: 
    name: P114_CALL_ID
    type: Hidden

  settings: 
    value-protected: true

  layout: 
    sequence: 10
    region: dlg-Call-Rating # 151726325874589520
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_RATING ==============================
  id: 151726564345589522
  identification: 
    name: P114_RATING
    type: Radio Group

  label: 
    label: Rating
    alignment: Left

  settings: 
    number-of-columns: 1
    page-action-on-selection: None

  layout: 
    sequence: 20
    region: dlg-Call-Rating # 151726325874589520
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  validation: 
    value-required: false

  list-of-values: 
    type: Static Values
    static-values: 'STATIC:‚≠ê Excellent;EXCELLENT,üëç Like;LIKE, üòê Neutral;NEUTRAL,üëé Dislike;DISLIKE'
    display-extra-values: true
    display-null-value: true

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    escape-special-characters: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_COMMENT =============================
  id: 151726696369589523
  identification: 
    name: P114_COMMENT
    type: Textarea

  label: 
    label: Comment
    alignment: Left

  settings: 
    resizable: true
    auto-height: false
    character-counter: false
    trim-spaces: Leading and Trailing

  layout: 
    sequence: 30
    region: dlg-Call-Rating # 151726325874589520
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    width: 30
    height: 5

  validation: 
    value-required: false

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_MOVE_SESSION_PROJECT_ID =============
  id: 155687913814186615
  identification: 
    name: P114_MOVE_SESSION_PROJECT_ID
    type: Select List

  label: 
    label: Project
    alignment: Left

  settings: 
    page-action-on-selection: None

  multiple-values: 
    type: No

  layout: 
    sequence: 10
    region: dlg-Move-Session # 155687807448186614
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    height: 1

  validation: 
    value-required: false

  list-of-values: 
    type: SQL Query
    sql-query: |2
       select   PROJECT_NAME ,
            CHAT_PROJECT_ID
             
      from   CHAT_PROJECTS   a
      where   OWNER_USER_ID  = v('G_USER_ID')
      AND IS_DELETED='N' 
      AND IS_ACTIVE='Y';
      -- and TENANT_ID, 
      
    display-extra-values: true
    display-null-value: true

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_SESSION_TITLE =======================
  id: 297379960993313387
  identification: 
    name: P114_SESSION_TITLE
    type: Display Only

  label: 
    label: Session Title
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: false

  layout: 
    sequence: 30
    region: Classifier # 297380456515313363
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_CXD_TRACE_ID ========================
  id: 297381609994313403
  identification: 
    name: P114_CXD_TRACE_ID
    type: Display Only

  label: 
    label: Trace Id
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: true

  layout: 
    sequence: 70
    region: Classifier # 297380456515313363
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_CXD_DETECTION_METHOD_CODE ===========
  id: 297381668510313404
  identification: 
    name: P114_CXD_DETECTION_METHOD_CODE
    type: Display Only

  label: 
    label: Detection Method
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: true

  layout: 
    sequence: 80
    region: Classifier # 297380456515313363
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_CXD_FINAL_DETECTION_METHOD_CODE =====
  id: 297381834670313406
  identification: 
    name: P114_CXD_FINAL_DETECTION_METHOD_CODE
    type: Display Only

  label: 
    label: Final Detection Method
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: true

  layout: 
    sequence: 90
    region: Classifier # 297380456515313363
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_CXD_CONTEXT_DOMAIN_ID ===============
  id: 299331387913666557
  identification: 
    name: P114_CXD_CONTEXT_DOMAIN_ID
    type: Display Only

  label: 
    label: Domain ID
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: true

  layout: 
    sequence: 100
    region: Classifier # 297380456515313363
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_CXD_CONTEXT_DOMAIN_CODE =============
  id: 299331497995666558
  identification: 
    name: P114_CXD_CONTEXT_DOMAIN_CODE
    type: Display Only

  label: 
    label: Context Domain
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: true

  layout: 
    sequence: 110
    region: Classifier # 297380456515313363
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_CXD_CONTEXT_DOMAIN_NAME =============
  id: 299331573359666559
  identification: 
    name: P114_CXD_CONTEXT_DOMAIN_NAME
    type: Display Only

  label: 
    label: Context Domain Name
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: true

  layout: 
    sequence: 120
    region: Classifier # 297380456515313363
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_CXD_CONTEXT_DOMAIN_CONFIDENCE =======
  id: 299331679733666560
  identification: 
    name: P114_CXD_CONTEXT_DOMAIN_CONFIDENCE
    type: Display Only

  label: 
    label: Confidence
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: true

  layout: 
    sequence: 130
    region: Classifier # 297380456515313363
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_CXD_DETECT_STATUS ===================
  id: 299331816253666561
  identification: 
    name: P114_CXD_DETECT_STATUS
    type: Display Only

  label: 
    label: Status
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: true

  layout: 
    sequence: 160
    region: Classifier # 297380456515313363
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_CXD_MESSAGE =========================
  id: 299331880563666562
  identification: 
    name: P114_CXD_MESSAGE
    type: Display Only

  label: 
    label: Message
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: true

  layout: 
    sequence: 170
    region: Classifier # 297380456515313363
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_CXD_SEARCH_TIME_MS ==================
  id: 299331965895666563
  identification: 
    name: P114_CXD_SEARCH_TIME_MS
    type: Display Only

  label: 
    label: Time (ms)
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: true

  layout: 
    sequence: 180
    region: Classifier # 297380456515313363
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_CXD_USED_PROVIDER ===================
  id: 299332037954666564
  identification: 
    name: P114_CXD_USED_PROVIDER
    type: Display Only

  label: 
    label: Provider(if LLM used)
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: true

  layout: 
    sequence: 140
    region: Classifier # 297380456515313363
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_CXD_USED_MODEL ======================
  id: 299332188345666565
  identification: 
    name: P114_CXD_USED_MODEL
    type: Display Only

  label: 
    label: Model(if LLM used)
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: true

  layout: 
    sequence: 150
    region: Classifier # 297380456515313363
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_REPORT_ISSUE_URL ====================
  id: 299335955306666603
  identification: 
    name: P114_REPORT_ISSUE_URL
    type: Display Only

  label: 
    label: Report Issue Url
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: true

  layout: 
    sequence: 10
    region: Classifier # 297380456515313363
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_CHAT_PROJECT_ID =====================
  id: 299892755045071284
  identification: 
    name: P114_CHAT_PROJECT_ID
    type: Display Only

  label: 
    label: Project Id
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: false

  layout: 
    sequence: 40
    region: Classifier # 297380456515313363
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_SELECTED_PROJECT_ID =================
  id: 300400855252857922
  identification: 
    name: P114_SELECTED_PROJECT_ID
    type: Hidden

  settings: 
    value-protected: true

  layout: 
    sequence: 30
    region: Left_Side # 299892034523071248
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_CHAT_PROJECT_TITLE ==================
  id: 300463293930765474
  identification: 
    name: P114_CHAT_PROJECT_TITLE
    type: Display Only

  label: 
    label: Chat Project Title
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: false

  layout: 
    sequence: 50
    region: Classifier # 297380456515313363
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: false
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_ISSUE_LEVEL =========================
  id: 300514525736850135
  identification: 
    name: P114_ISSUE_LEVEL
    type: Hidden

  settings: 
    value-protected: true

  layout: 
    sequence: 10
    region: myActiveSession # 300501172210850030
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_ENTITY_ID ===========================
  id: 300514675176850136
  identification: 
    name: P114_ENTITY_ID
    type: Hidden

  settings: 
    value-protected: true

  layout: 
    sequence: 20
    region: myActiveSession # 300501172210850030
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_NEW_CHAT_PROJECT_TITLE ==============
  id: 301823940639221247
  identification: 
    name: P114_NEW_CHAT_PROJECT_TITLE
    type: Text Field

  label: 
    label: Project Name
    alignment: Left

  settings: 
    subtype: Text
    trim-spaces: Leading and Trailing
    text-case: NO CHANGE
    submit-when-enter-pressed: false
    disabled: false

  layout: 
    sequence: 10
    region: dlg-New Project # 301798403176221119
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Required - Floating
    template-options: 
    - '#DEFAULT#'
    width: 60

  validation: 
    value-required: false
    maximum-length: 200

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_CHAT_PROJECT_INSTRUCTIONS ===========
  id: 301826511310221272
  identification: 
    name: P114_CHAT_PROJECT_INSTRUCTIONS
    type: Textarea

  label: 
    label: Instructions (Optional)
    alignment: Left

  settings: 
    resizable: true
    auto-height: false
    character-counter: false
    trim-spaces: Leading and Trailing

  layout: 
    sequence: 30
    region: dlg-New Project # 301798403176221119
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    width: 60
    height: 5

  validation: 
    value-required: false

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_CHAT_PROJECT_DESCRIPTION ============
  id: 301826547800221273
  identification: 
    name: P114_CHAT_PROJECT_DESCRIPTION
    type: Text Field

  label: 
    label: Description  (Optional)
    alignment: Left

  settings: 
    subtype: Text
    trim-spaces: Leading and Trailing
    text-case: NO CHANGE
    submit-when-enter-pressed: false
    disabled: false

  layout: 
    sequence: 20
    region: dlg-New Project # 301798403176221119
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    width: 30

  validation: 
    value-required: false

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_NEW_SESSION_ID ======================
  id: 301826642353221259
  identification: 
    name: P114_NEW_SESSION_ID
    type: Hidden

  settings: 
    value-protected: true

  layout: 
    sequence: 10
    region: dlg-New-Session # 301798572574221120
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_NEW_SESSION_TITLE ===================
  id: 301826736370221260
  identification: 
    name: P114_NEW_SESSION_TITLE
    type: Text Field

  label: 
    label: Title
    alignment: Left

  settings: 
    subtype: Text
    trim-spaces: Leading and Trailing
    text-case: NO CHANGE
    submit-when-enter-pressed: false
    disabled: false

  layout: 
    sequence: 20
    region: dlg-New-Session # 301798572574221120
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    width: 30

  validation: 
    value-required: false

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_NEW_SESSION_PROJECT_ID ==============
  id: 301827025748221263
  identification: 
    name: P114_NEW_SESSION_PROJECT_ID
    type: Select List

  label: 
    label: Project
    alignment: Left

  settings: 
    page-action-on-selection: None

  multiple-values: 
    type: No

  layout: 
    sequence: 30
    region: dlg-New-Session # 301798572574221120
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    height: 1

  validation: 
    value-required: false

  list-of-values: 
    type: SQL Query
    sql-query: |2
       select   PROJECT_NAME ,
            CHAT_PROJECT_ID
             
      from   CHAT_PROJECTS   a
      where   OWNER_USER_ID  = v('G_USER_ID')
      AND IS_DELETED='N' 
      AND IS_ACTIVE='Y';
      -- and TENANT_ID, 
      
    display-extra-values: true
    display-null-value: true

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_CHAT_SESSION_ID =====================
  id: 441663712820646569
  identification: 
    name: P114_CHAT_SESSION_ID
    type: Display Only

  label: 
    label: Chat Session (Id)
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: false

  layout: 
    sequence: 20
    region: Classifier # 297380456515313363
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_PROVIDER ============================
  id: 441690195456646663
  identification: 
    name: P114_PROVIDER
    type: Select List

  label: 
    label: Provider
    alignment: Left

  settings: 
    page-action-on-selection: None

  multiple-values: 
    type: No

  layout: 
    sequence: 40
    region: Right Panel # 443085927550063585
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    height: 1

  validation: 
    value-required: false

  list-of-values: 
    type: SQL Query
    sql-query: |
      SELECT provider_name  AS display_value,
             provider_code  AS return_value
      FROM   llm_providers
      WHERE  is_active = 'Y'
      ORDER BY display_order;
    display-extra-values: true
    display-null-value: true

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: Static
    static-value: OPENAI

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_MODEL ===============================
  id: 441690298361646664
  identification: 
    name: P114_MODEL
    type: Select List

  label: 
    label: Model
    alignment: Left

  settings: 
    page-action-on-selection: None

  multiple-values: 
    type: No

  layout: 
    sequence: 50
    region: Right Panel # 443085927550063585
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    height: 1

  validation: 
    value-required: false

  list-of-values: 
    type: SQL Query
    sql-query: |
      SELECT model_name AS display_value,
             model_code AS return_value
      FROM   llm_provider_models
      WHERE  is_active = 'Y'
        AND provider_code = :P114_PROVIDER
      ORDER BY display_order;
    display-extra-values: true
    display-null-value: false

  cascading-list-of-values: 
    parent-item(s): 
    - P114_PROVIDER
    items-to-submit: 
    - P114_PROVIDER
    parent-required: true

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_STREAM_CHANNEL ======================
  id: 441691722568646671
  identification: 
    name: P114_STREAM_CHANNEL
    type: Hidden

  settings: 
    value-protected: false

  layout: 
    sequence: 20
    region: MAIN CONTAINER # 441655286029646467
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: Static
    static-value: APEX$CHAT110

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_TYPING_FLAG =========================
  id: 441691793516646672
  identification: 
    name: P114_TYPING_FLAG
    type: Hidden

  settings: 
    value-protected: false

  layout: 
    sequence: 30
    region: MAIN CONTAINER # 441655286029646467
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: Static
    static-value: N

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_STREAM_ENABLED ======================
  id: 441692918592646691
  identification: 
    name: P114_STREAM_ENABLED
    type: Switch

  label: 
    label: Stream Enabled
    alignment: Left

  settings: 
    use-defaults: true

  layout: 
    sequence: 120
    region: Right Panel # 443085927550063585
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  validation: 
    value-required: false

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: Static
    static-value: Y

  session-state: 
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_APP_SESSION_ID ======================
  id: 441693079394646692
  identification: 
    name: P114_APP_SESSION_ID
    type: Display Only

  label: 
    label: App Session Id
    alignment: Left

  settings: 
    format: Plain Text
    based-on: Item Value
    show-line-breaks: true
    send-on-page-submit: true

  layout: 
    sequence: 110
    region: Right Panel # 443085927550063585
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: Item
    item: APP_SESSION

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_CONTEXT_DOMAIN_ID ===================
  id: 441693114093646693
  identification: 
    name: P114_CONTEXT_DOMAIN_ID
    type: Select List

  label: 
    label: Context Domain
    alignment: Left

  settings: 
    page-action-on-selection: None

  multiple-values: 
    type: No

  layout: 
    sequence: 60
    region: Right Panel # 443085927550063585
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    height: 1

  validation: 
    value-required: false

  list-of-values: 
    type: Shared Component
    list-of-values: CONTEXT_DOMAINS(ID) # 152757137945460727
    display-extra-values: true
    display-null-value: true

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_TEMPERATURE =========================
  id: 443118757145063760
  identification: 
    name: P114_TEMPERATURE
    type: Number Field

  label: 
    label: Temperature
    alignment: Left

  settings: 
    minimum-value: 0
    maximum-value: 2
    number-alignment: Start
    virtual-keyboard: Decimal

  layout: 
    sequence: 70
    region: Right Panel # 443085927550063585
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    width: 30

  validation: 
    value-required: false

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: Static
    static-value: 0.7

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_TOP_P ===============================
  id: 443118833612063761
  identification: 
    name: P114_TOP_P
    type: Number Field

  label: 
    label: Top P
    alignment: Left

  settings: 
    minimum-value: 0
    maximum-value: 1
    number-alignment: Start
    virtual-keyboard: Decimal

  layout: 
    sequence: 80
    region: Right Panel # 443085927550063585
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    width: 30

  validation: 
    value-required: false

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: Static
    static-value: 0.7

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_MAX_TOKENS ==========================
  id: 443118982150063762
  identification: 
    name: P114_MAX_TOKENS
    type: Number Field

  label: 
    label: Max Tokens
    alignment: Left

  settings: 
    number-alignment: Start
    virtual-keyboard: Decimal

  layout: 
    sequence: 90
    region: Right Panel # 443085927550063585
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    width: 30

  validation: 
    value-required: false

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: Static
    static-value: 4096

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_TOP_K ===============================
  id: 443119065440063763
  identification: 
    name: P114_TOP_K
    type: Text Field

  label: 
    label: Top K
    alignment: Left

  settings: 
    subtype: Text
    trim-spaces: Leading and Trailing
    text-case: NO CHANGE
    submit-when-enter-pressed: false
    disabled: false

  layout: 
    sequence: 100
    region: Right Panel # 443085927550063585
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'
    width: 30

  validation: 
    value-required: false

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    storage: Per Session (Persistent)

  quick-picks: 
    show-quick-picks: false

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_CHAT_HISTORY_JSON ===================
  id: 443120180908063767
  identification: 
    name: P114_CHAT_HISTORY_JSON
    type: Hidden

  settings: 
    value-protected: true

  layout: 
    sequence: 60
    region: MAIN CONTAINER # 441655286029646467
    slot: BODY

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  session-state: 
    data-type: VARCHAR2
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

- # ====== Page Item: P114_JSON_MODE ===========================
  id: 443123862971063785
  identification: 
    name: P114_JSON_MODE
    type: Switch

  label: 
    label: Json Mode
    alignment: Left

  settings: 
    use-defaults: true

  layout: 
    sequence: 130
    region: Right Panel # 443085927550063585
    slot: BODY
    alignment: Left
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    label-column-span: Page Template Default

  appearance: 
    template: Optional - Floating
    template-options: 
    - '#DEFAULT#'

  validation: 
    value-required: false

  advanced: 
    warn-on-unsaved-changes: Page Default

  source: 
    type: Null
    used: Only when current value in session state is null

  default: 
    type: Static
    static-value: Y

  session-state: 
    storage: Per Session (Persistent)

  security: 
    session-state-protection: Unrestricted
    store-value-encrypted-in-session-state: true
    restricted-characters: All characters can be saved.

buttons: 
- # ====== Button: BTN_NEW_PROJECT =============================
  id: 151666248908556190
  identification: 
    button-name: BTN_NEW_PROJECT
    label: New Project

  layout: 
    sequence: 10
    region: Session&Project Actions # 301801575118221150
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    alignment: Left center

  appearance: 
    button-template: Text with Icon
    hot: false
    template-options: 
    - '#DEFAULT#'
    - t-Button--primary
    - t-Button--iconLeft
    - t-Button--stretch
    icon: fa-folder-plus

  behavior: 
    action: Defined by Dynamic Action
    execute-validations: true

  advanced: 
    static-id: btnNewProject

- # ====== Button: BTN_NEW_SESSION =============================
  id: 151666668812556192
  identification: 
    button-name: BTN_NEW_SESSION
    label: New Chat

  layout: 
    sequence: 20
    region: Session&Project Actions # 301801575118221150
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    alignment: Left center

  appearance: 
    button-template: Text with Icon
    hot: true
    template-options: 
    - '#DEFAULT#'
    - t-Button--iconLeft
    - t-Button--stretch
    icon: fa-comments

  behavior: 
    action: Defined by Dynamic Action
    execute-validations: true

  advanced: 
    static-id: btnNewSession

- # ====== Button: Create-dlg-New-Project ======================
  id: 151683235799556242
  identification: 
    button-name: Create-dlg-New-Project
    label: Create Project

  layout: 
    sequence: 40
    region: dlg-New Project # 301798403176221119
    slot: CREATE
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    button-template: Text
    hot: true
    template-options: 
    - '#DEFAULT#'

  behavior: 
    action: Defined by Dynamic Action
    execute-validations: true

  advanced: 
    static-id: SaveNewProjStaticId

- # ====== Button: Close-dlg-New-Project =======================
  id: 151683646737556243
  identification: 
    button-name: Close-dlg-New-Project
    label: Cancel

  layout: 
    sequence: 50
    region: dlg-New Project # 301798403176221119
    slot: PREVIOUS
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    button-template: Text
    hot: false
    template-options: 
    - '#DEFAULT#'

  behavior: 
    action: Defined by Dynamic Action
    execute-validations: true

- # ====== Button: create-dlg-New-Session ======================
  id: 151685365208556249
  identification: 
    button-name: create-dlg-New-Session
    label: Create Session

  layout: 
    sequence: 40
    region: dlg-New-Session # 301798572574221120
    slot: CREATE
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    button-template: Text
    hot: true
    template-options: 
    - '#DEFAULT#'

  behavior: 
    action: Defined by Dynamic Action
    execute-validations: true

  advanced: 
    static-id: SaveNewSessionStaticId

- # ====== Button: Close-dlg-New-Session =======================
  id: 151685714152556250
  identification: 
    button-name: Close-dlg-New-Session
    label: Cancel

  layout: 
    sequence: 50
    region: dlg-New-Session # 301798572574221120
    slot: PREVIOUS
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    button-template: Text
    hot: false
    template-options: 
    - '#DEFAULT#'

  behavior: 
    action: Defined by Dynamic Action
    execute-validations: true

- # ====== Button: BTN_SETTINGS ================================
  id: 151689139194556264
  identification: 
    button-name: BTN_SETTINGS
    label: ‚öô Settings

  layout: 
    sequence: 10
    region: Settings Panel # 443084908686063575
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    alignment: Left center

  appearance: 
    button-template: Text
    hot: false
    template-options: 
    - '#DEFAULT#'

  behavior: 
    action: Defined by Dynamic Action
    execute-validations: true

  advanced: 
    static-id: btnSettings

- # ====== Button: BTN_CLOSE_SETTINGS ==========================
  id: 151689593540556265
  identification: 
    button-name: BTN_CLOSE_SETTINGS
    label: '  Close Settings'

  layout: 
    sequence: 20
    region: Settings Panel # 443084908686063575
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    alignment: Left center

  appearance: 
    button-template: Icon
    hot: false
    template-options: 
    - '#DEFAULT#'
    icon: fa-window-close-o

  behavior: 
    action: Defined by Dynamic Action
    execute-validations: true

- # ====== Button: SEND ========================================
  id: 151724868627589505
  identification: 
    button-name: SEND
    label: Send

  layout: 
    sequence: 20
    region: chatPrompt # 443085855512063584
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    alignment: Left center

  appearance: 
    button-template: Text
    hot: false
    template-options: 
    - '#DEFAULT#'
    css-classes: 
    - chatPrompt-sendBtn

  behavior: 
    action: Defined by Dynamic Action
    execute-validations: true

  advanced: 
    static-id: sendBtn

- # ====== Button: rightPanelToggle ============================
  id: 151725791213589514
  identification: 
    button-name: rightPanelToggle
    label: ‚öôÔ∏è Parameters

  layout: 
    sequence: 20
    region: Right Panel # 443085927550063585
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    alignment: Left center

  appearance: 
    button-template: Text
    hot: false
    template-options: 
    - '#DEFAULT#'
    css-classes: 
    - chatRightPanel-toggleBtn

  behavior: 
    action: Submit Page
    execute-validations: true
    show-processing: false
    warn-on-unsaved-changes: Do Not Check

  comments: 
    comments: appears only on small screens

- # ====== Button: projectPanelToggle ==========================
  id: 151725865728589515
  identification: 
    button-name: projectPanelToggle
    label: ‚ò∞ Sessions

  layout: 
    sequence: 10
    region: Left_Side # 299892034523071248
    slot: BODY
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic
    alignment: Left center

  appearance: 
    button-template: Text
    hot: false
    template-options: 
    - '#DEFAULT#'
    css-classes: 
    - chatLeftPanel-toggleBtn

  behavior: 
    action: Submit Page
    execute-validations: true
    show-processing: false
    warn-on-unsaved-changes: Do Not Check

- # ====== Button: Save-Call-Rating-dlg ========================
  id: 151726736642589524
  identification: 
    button-name: Save-Call-Rating-dlg
    label: Save

  layout: 
    sequence: 40
    region: dlg-Call-Rating # 151726325874589520
    slot: CREATE
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    button-template: Text
    hot: false
    template-options: 
    - '#DEFAULT#'

  behavior: 
    action: Defined by Dynamic Action
    execute-validations: true

- # ====== Button: Close-Call-Rating-dlg =======================
  id: 151726864927589525
  identification: 
    button-name: Close-Call-Rating-dlg
    label: Cancel

  layout: 
    sequence: 50
    region: dlg-Call-Rating # 151726325874589520
    slot: CLOSE
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    button-template: Text
    hot: false
    template-options: 
    - '#DEFAULT#'

  behavior: 
    action: Defined by Dynamic Action
    execute-validations: true

- # ====== Button: Save-dlg-Move-Session =======================
  id: 155688052284186616
  identification: 
    button-name: Save-dlg-Move-Session
    label: Save

  layout: 
    sequence: 20
    region: dlg-Move-Session # 155687807448186614
    slot: CREATE
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    button-template: Text with Icon
    hot: true
    template-options: 
    - '#DEFAULT#'
    - t-Button--iconLeft
    icon: fa-save

  behavior: 
    action: Defined by Dynamic Action
    execute-validations: true

- # ====== Button: Cancel-dlg-Move-Session =====================
  id: 155688145084186617
  identification: 
    button-name: Cancel-dlg-Move-Session
    label: Cancel

  layout: 
    sequence: 30
    region: dlg-Move-Session # 155687807448186614
    slot: CLOSE
    start-new-layout: false
    start-new-row: true
    column: Automatic
    new-column: true
    column-span: Automatic

  appearance: 
    button-template: Text with Icon
    hot: false
    template-options: 
    - '#DEFAULT#'
    - t-Button--iconLeft
    icon: fa-times

  behavior: 
    action: Defined by Dynamic Action
    execute-validations: true

dynamic-actions: 
- # ====== Dynamic Action: init Page ===========================
  id: 151702503475556320
  identification: 
    name: init Page

  execution: 
    sequence: 20
    event-scope: Static

  when: 
    event: Page Load

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 151703015089556323
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        console.log("üöÄ Page 115 Execute When Page Loads...");
        
        // ---------------------------------------------------------------------
        // Resolve APEX Application Item (text is injected server-side)
        // ---------------------------------------------------------------------
        const env = '&G_APP_ENV.'.trim();
        console.log("Current Environment =", env);
        
        
        
        // ---------------------------------------------------------------------
        // UNIVERSAL SEQUENTIAL SCRIPT LOADER  (APEX safe)
        // Ensures chatPrompt ‚Üí chatSession ‚Üí chatCalls load in correct order
        // ---------------------------------------------------------------------
        function loadSequential(urls, doneCallback) {
            if (!urls || urls.length === 0) {
                console.log("üéâ All scripts loaded");
                if (typeof doneCallback === "function") doneCallback();
                return;
            }
        
            const url = urls.shift();
            const script = document.createElement("script");
        
            script.src = url;
            script.type = "text/javascript";
        
            script.onload = () => {
                console.log("üì¶ Loaded:", url);
                loadSequential(urls, doneCallback);  // Continue loading next
            };
        
            script.onerror = () => {
                console.error("‚ùå Failed to load:", url);
                loadSequential(urls, doneCallback);  // Fail-safe: continue
            };
        
            document.head.appendChild(script);
        }
        
        
        
        // =====================================================================
        // MODE: DEVELOPMENT (Load individual modules in order)
        // =====================================================================
        if (env === "DEV") {
            console.log("Mode: DEVELOPMENT");
        
            const devScripts = [
                "#WORKSPACE_FILES#chat/assistant/src/chatPrompt#MIN#.js",
                "#WORKSPACE_FILES#chat/assistant/src/chatSession#MIN#.js",
                "#WORKSPACE_FILES#chat/assistant/src/chatCalls#MIN#.js"
                // "#WORKSPACE_FILES#chat/assistant/src/chatProjects#MIN#.js"
            ];
        
            loadSequential(devScripts, function () {
                console.log("üî• DEV scripts ready ‚Äî calling init()");
                if (window.chatPrompt?.init) chatPrompt.init();
                if (window.chatSession?.init) chatSession.init();
                if (window.chatCalls?.init) chatCalls.init();
                 console.log('[Page Load] chatCalls version: ' + chatCalls.version);
            });
        }
        
        
        
        // =====================================================================
        // MODE: PRODUCTION (Load one combined minified file)
        // =====================================================================
        else if (env === "PROD") {
            console.log("Mode: PRODUCTION");
        
            loadSequential([
                "#WORKSPACE_FILES#chat/assistant/dist/chatAssistant#MIN#.js"
            ], function () {
                console.log("üî• PROD bundle ready ‚Äî initializing...");
                if (window.chatAssistant?.init) chatAssistant.init();
                if (window.chatCalls?.init) chatCalls.init();
         
            });
        }
        
        
        

    execution: 
      sequence: 90
      event: init Page # 151702503475556320
      fire-when-event-result-is: True
      fire-on-initialization: false

    configuration: 
      build-option: Commented Out # 123954063565486069

  - # ====== Action: init session ================================
    id: 151703581379556324
    identification: 
      name: init session
      action: Execute Server-side Code

    settings: 
      language: PE.PROPERTY.SOURCE_SNIPPET_LANG.LOV.PLSQL.D
      pl/sql-code: |
        :P114_CHAT_SESSION_ID     :=null;
        :P114_SELECTED_PROJECT_ID :=null;
        :P114_SESSION_TITLE       :=null;  
        :P114_CXD_TRACE_ID        :=null;
        :P114_CONTEXT_DOMAIN_ID   :=NULL;
        
         
        
           --  APEX_UTIL.SET_SESSION_STATE('P114_CHAT_SESSION_ID', :P114_CHAT_SESSION_ID );
         --   APEX_UTIL.SET_SESSION_STATE('P114_SELECTED_PROJECT_ID', :P114_SELECTED_PROJECT_ID );
        
        
          :P114_CXD_TRACE_ID := null;
          :P114_CXD_DETECTION_METHOD_CODE := null;
          :P114_CXD_CONTEXT_DOMAIN_ID:= null;
          :P114_CXD_CONTEXT_DOMAIN_CODE := null;
          :P114_CXD_CONTEXT_DOMAIN_NAME:= null;
          :P114_CXD_CONTEXT_DOMAIN_CONFIDENCE:= null;
          :P114_CXD_DETECT_STATUS:= null;
          :P114_CXD_MESSAGE:= null;
          :P114_CXD_SEARCH_TIME_MS:= null;
          :P114_CXD_USED_PROVIDER:= null;
          :P114_CXD_USED_MODEL:= null;
          :P114_CONTEXT_DOMAIN_ID := null;
          :P114_CXD_FINAL_DETECTION_METHOD_CODE:= null;
        
      items-to-submit: 
      - P114_CHAT_SESSION_ID
      items-to-return: 
      - P114_CHAT_SESSION_ID
      - P114_SESSION_TITLE
      suppress-change-event: false

    execution: 
      sequence: 10
      event: init Page # 151702503475556320
      fire-when-event-result-is: True
      fire-on-initialization: false
      stop-execution-on-error: true
      wait-for-result: true

  - # ====== Action: DisableBtns =================================
    id: 151704093404556325
    identification: 
      name: DisableBtns
      action: Execute JavaScript Code

    settings: 
      code: |
        const sid = $v("P114_CHAT_SESSION_ID");
        
        if (!sid || sid === "") {
            console.log("üö´ No session detected ‚Üí disabling header buttons");
            SessionHeader.disableButtons();   // FIXED
        } else {
            console.log("üü¢ Session active ‚Üí enabling header buttons");
            SessionHeader.enableButtons();    // FIXED
        }

    execution: 
      sequence: 20
      event: init Page # 151702503475556320
      fire-when-event-result-is: True
      fire-on-initialization: false

    configuration: 
      build-option: Commented Out # 123954063565486069

  - # ====== Action: init Model ==================================
    id: 151704597800556326
    identification: 
      name: init Model
      action: Execute Server-side Code

    settings: 
      language: PE.PROPERTY.SOURCE_SNIPPET_LANG.LOV.PLSQL.D
      pl/sql-code: |
        if :P114_MODEL is not null then
        
        select  
               DEFAULT_TEMPERATURE,
               DEFAULT_TOP_P,
               DEFAULT_TOP_K,
               MAX_OUTPUT_TOKENS,
               SUPPORTS_STREAMING
              /* ,
                  CONTEXT_WINDOW_TOKENS,
               SUPPORTS_FUNCTION_CALLING,
               SUPPORTS_VISION,
               SUPPORTS_JSON_MODE,
               DEFAULT_FREQUENCY_PENALTY,
               DEFAULT_PRESENCE_PENALTY ,
               RATE_LIMIT_RPM,
               RATE_LIMIT_TPM,
               EMBEDDING_DIMENSIONS,
                IS_DEFAULT,
               IS_ACTIVE,
               IS_EMBEDDING_MODE */
            into :P114_TEMPERATURE,
            :P114_TOP_P,
            :P114_TOP_K,
            :P114_MAX_TOKENS,
            :P114_STREAM_ENABLED
        
        from "LLM_PROVIDER_MODELS" a
        where  MODEL_CODE =:P114_MODEL ;
        
        end if;
        
      items-to-submit: 
      - P114_ISSUE_LEVEL
      items-to-return: 
      - P114_ISSUE_LEVEL
      suppress-change-event: false

    execution: 
      sequence: 30
      event: init Page # 151702503475556320
      fire-when-event-result-is: True
      fire-on-initialization: false
      stop-execution-on-error: true
      wait-for-result: true

  - # ====== Action: Create Default Project if Not Exists ========
    id: 151705008784556328
    identification: 
      name: Create Default Project if Not Exists
      action: Execute Server-side Code

    settings: 
      language: PE.PROPERTY.SOURCE_SNIPPET_LANG.LOV.PLSQL.D
      pl/sql-code: |
        :P114_CHAT_PROJECT_ID := CHAT_PROJECTS_PKG.default_handling(p_user_id=>v('G_USER_ID') );
        :P114_SELECTED_PROJECT_ID :=  :P114_CHAT_PROJECT_ID ;
        
         APEX_UTIL.SET_SESSION_STATE('P114_CHAT_PROJECT_ID',:P114_CHAT_PROJECT_ID );
         APEX_UTIL.SET_SESSION_STATE('P114_SELECTED_PROJECT_ID',:P114_CHAT_PROJECT_ID );
      items-to-return: 
      - P114_CHAT_PROJECT_ID
      - P114_SELECTED_PROJECT_ID
      suppress-change-event: false

    execution: 
      sequence: 40
      event: init Page # 151702503475556320
      fire-when-event-result-is: True
      fire-on-initialization: false
      stop-execution-on-error: true
      wait-for-result: true

  - # ====== Action: Refresh project after adding Default Project 
    id: 151705591109556330
    identification: 
      name: Refresh project after adding Default Project
      action: Refresh

    settings: 
      maintain-pagination: false

    affected-elements: 
      selection-type: Region
      region: MyProjectsTree # 300461147415765424

    execution: 
      sequence: 50
      event: init Page # 151702503475556320
      fire-when-event-result-is: True
      fire-on-initialization: false

    server-side-condition: 
      type: Function Body
      language: PL/SQL
      pl/sql-function-body: return Not CHAT_PROJECTS_PKG.is_default_exists(p_user_id=>v('G_USER_ID')) ;

  - # ====== Action: Refresh =====================================
    id: 151706077961556331
    identification: 
      action: Refresh

    settings: 
      maintain-pagination: false

    affected-elements: 
      selection-type: Region
      region: myActiveSession # 300501172210850030

    execution: 
      sequence: 70
      event: init Page # 151702503475556320
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Execute JavaScript Code =====================
    id: 151706503134556332
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        const container = document.getElementById('ChatCallsStaticId');
        console.log('Container:', container);
        console.log('ScrollHeight:', container.scrollHeight);

    execution: 
      sequence: 80
      event: init Page # 151702503475556320
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: model change ========================
  id: 151706993823556333
  identification: 
    name: model change

  execution: 
    sequence: 30
    event-scope: Static
    type: Immediate

  when: 
    event: Change
    selection-type: Item(s)
    item(s): 
    - P114_MODEL

  actions: 
  - # ====== Action: Execute Server-side Code ====================
    id: 151707407402556334
    identification: 
      action: Execute Server-side Code

    settings: 
      language: PE.PROPERTY.SOURCE_SNIPPET_LANG.LOV.PLSQL.D
      pl/sql-code: |
        if :P114_MODEL is not null then
        
        select  
               DEFAULT_TEMPERATURE,
               DEFAULT_TOP_P,
               DEFAULT_TOP_K,
               MAX_OUTPUT_TOKENS,
               SUPPORTS_STREAMING
              /* ,
                  CONTEXT_WINDOW_TOKENS,
               SUPPORTS_FUNCTION_CALLING,
               SUPPORTS_VISION,
               SUPPORTS_JSON_MODE,
               DEFAULT_FREQUENCY_PENALTY,
               DEFAULT_PRESENCE_PENALTY ,
               RATE_LIMIT_RPM,
               RATE_LIMIT_TPM,
               EMBEDDING_DIMENSIONS,
                IS_DEFAULT,
               IS_ACTIVE,
               IS_EMBEDDING_MODE */
            into :P114_TEMPERATURE,
            :P114_TOP_P,
            :P114_TOP_K,
            :P114_MAX_TOKENS,
            :P114_STREAM_ENABLED
        
        from "LLM_PROVIDER_MODELS" a
        where  MODEL_CODE =:P114_MODEL ;
        
        end if;
        
      items-to-submit: 
      - P114_MODEL
      items-to-return: 
      - P114_TOP_P
      - P114_TOP_K
      - P114_MAX_TOKENS
      - P114_STREAM_ENABLED
      suppress-change-event: false

    execution: 
      sequence: 10
      event: model change # 151706993823556333
      fire-when-event-result-is: True
      fire-on-initialization: false
      stop-execution-on-error: true
      wait-for-result: true

- # ====== Dynamic Action: ProjectTree Node Selected ===========
  id: 151707878399556335
  identification: 
    name: ProjectTree Node Selected

  execution: 
    sequence: 60
    event-scope: Static
    type: Immediate

  when: 
    event: NATIVE_JSTREE|REGION TYPE|treeviewselectionchange
    selection-type: Region
    region: MyProjectsTree # 300461147415765424

  actions: 
  - # ====== Action: Refresh =====================================
    id: 151708333331556336
    identification: 
      action: Refresh

    settings: 
      maintain-pagination: false

    affected-elements: 
      selection-type: Region
      region: LLM Calls # 301843113611557821

    execution: 
      sequence: 70
      event: ProjectTree Node Selected # 151707878399556335
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Execute JavaScript Code =====================
    id: 151708801969556338
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        var node = apex.region("myProjectsTreeStaticID").call("getSelectedNodes")[0];
        if (!node) return;
        
        // Read node metadata
        var raw = node.id;                // PROJECT|1|   or SESSION|302|2
        var label = node.label;           // "üìÅ HR Portal"  or "üí¨ what is my salary"
        console.log("RAW NODE_ID:", raw);
        console.log("label:", label);
        
        // Split metadata
        var parts = raw.split("|");
        var type   = parts[0];  // PROJECT / SESSION
        var id     = parts[1];  // Project ID or Session ID
        var parent = parts[2];  // Parent project ID (may be "" for root)
        
         
        // PROJECT NODE
        if (type === "PROJECT") {
            apex.item("P114_CHAT_PROJECT_ID").setValue(id);
            apex.item("P114_SELECTED_PROJECT_ID").setValue(id);
            
            // extract clean project title
            var cleanTitle = label.replace("üìÅ ", "");
            apex.item("P114_CHAT_PROJECT_TITLE").setValue(cleanTitle);
        }
        
        // SESSION NODE
        if (type === "SESSION") {
            apex.item("P114_CHAT_SESSION_ID").setValue(id);
            apex.item("P114_CHAT_PROJECT_ID").setValue(parent);
            apex.item("P114_SELECTED_PROJECT_ID").setValue(parent);
        
            // extract clean session title
            var cleanTitle = label.replace("üí¨ ", "");
            apex.item("P114_SESSION_TITLE").setValue(cleanTitle);
        
        
            // GET PROJECT TITLE FROM TREE NODE (not from items)
            var parentLabel = "";
            if (node._parent && node._parent.label) {
                parentLabel = node._parent.label.replace("üìÅ ", "");
            }
        
            console.log("PARENT PROJECT TITLE:", parentLabel);
        
            // Set APEX item for UI/header
            apex.item("P114_CHAT_PROJECT_TITLE").setValue(parentLabel);
        
        
            // Push value to session state immediately
          // apex.server.process(  "", // Name of a defined AJAX Callback process
           // { x01: apex.item("P114_CHAT_SESSION_ID").getValue(),x02: apex.item("P114_SELECTED_PROJECT_ID").getValue() },
            
          //  {  success: function(pData) {  console.log("Session state updated");
            //    } } );
        
        
        
        
                   try {
                    apex.server.process(
                        "SET_SESSION_ITEM",
                        {
                            pageItems: "#P114_CHAT_SESSION_ID,#P114_SELECTED_PROJECT_ID" 
                        },
                        {
                            url: window.location.href,
                            dataType: "text",
                            success: () => {  console.log("‚úÖ Protected item synced.");  },
                            error: (err) => { console.error("‚ùå Protected Item Sync Failed:", err);
                                                apex.message.alert("Failed to sync protected items.");
                            }
                        }
                    );
                } catch (e) { console.error("‚ùå openReportIssueDialog Exception:", e); };
         
        }
        

    execution: 
      sequence: 40
      event: ProjectTree Node Selected # 151707878399556335
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Refresh =====================================
    id: 151709319379556339
    identification: 
      action: Refresh

    settings: 
      maintain-pagination: false

    affected-elements: 
      selection-type: Region
      region: myActiveSession # 300501172210850030

    execution: 
      sequence: 60
      event: ProjectTree Node Selected # 151707878399556335
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Execute JavaScript Code =====================
    id: 155687768062186613
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |2
         
        const sessionId = $v("P114_CHAT_SESSION_ID");
        if (sessionId) {
            chatContext.setSession(sessionId);
        }

    execution: 
      sequence: 50
      event: ProjectTree Node Selected # 151707878399556335
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: Menu-SESSION-Show Menu-Button Click =
  id: 151709784893556340
  identification: 
    name: Menu-SESSION-Show Menu-Button Click

  execution: 
    sequence: 70
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: jQuery Selector
    jquery-selector: .session-actions-menu button

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 151710258038556341
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        const sessionId = $(this.triggeringElement).attr('id').replace('sessionMenu_', '');
        toggleSessionMenu(sessionId);

    execution: 
      sequence: 10
      event: Menu-SESSION-Show Menu-Button Click # 151709784893556340
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: Menu-SESSION-Handle Item Clicks =====
  id: 151710694822556342
  identification: 
    name: Menu-SESSION-Handle Item Clicks

  execution: 
    sequence: 80
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: jQuery Selector
    jquery-selector: .apex-menu-link

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 151711120371556343
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        const $link = $(this.triggeringElement);
        const action = $link.data('action');
        const sessionId = $link.data('session-id');
        
        // Close menu
        $link.closest('.apex-menu').hide();
        
        // Handle action
        switch(action) {
            case 'edit-title':
                toggleEditMode(sessionId);
                break;
                
            case 'copy-title':
                const title = $('#sessionTitle_' + sessionId).text().trim();
                copyToClipboard(title);
                break;
                
            case 'export-session':
                // Set session ID and submit
                apex.item('P114_CHAT_SESSION_ID').setValue(sessionId);
                apex.page.submit('EXPORT_SESSION');
                break;
                
            case 'reassign-project':
                // Open dialog
                apex.item('P114_REASSIGN_SESSION_ID').setValue(sessionId);
                apex.theme.openRegion('reassignProjectDialog');
                break;
                
            case 'clear-session':
                apex.message.confirm(
                    'Are you sure you want to clear this session? This cannot be undone.',
                    function(okPressed) {
                        if (okPressed) {
                            apex.item('P114_CLEAR_SESSION_ID').setValue(sessionId);
                            apex.page.submit('CLEAR_SESSION');
                        }
                    }
                );
                break;
        }

    execution: 
      sequence: 10
      event: Menu-SESSION-Handle Item Clicks # 151710694822556342
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: Menu-SESSION- Save Session Title ====
  id: 151711527146556344
  identification: 
    name: Menu-SESSION- Save Session Title

  execution: 
    sequence: 90
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: jQuery Selector
    jquery-selector: .session-save-btn

  actions: 
  - # ====== Action: Execute Server-side Code ====================
    id: 151712029394556345
    identification: 
      action: Execute Server-side Code

    settings: 
      language: PE.PROPERTY.SOURCE_SNIPPET_LANG.LOV.PLSQL.D
      pl/sql-code: |
        DECLARE
            v_session_id    NUMBER;
            v_new_title     VARCHAR2(200);
            v_user_id       NUMBER:= v('G_USER_ID');
        BEGIN
            -- Get session ID from button data attribute via JavaScript
            v_session_id := apex_application.g_x01;
            v_new_title := apex_application.g_x02;
            
         
            
            -- Update session title
            UPDATE chat_sessions
            SET session_title = v_new_title,
                last_activity_date = SYSTIMESTAMP
            WHERE session_id = v_session_id
              AND user_id = v_user_id;
            
            COMMIT;
            
            apex_json.open_object;
            apex_json.write('success', TRUE);
            apex_json.close_object;
            
        EXCEPTION
            WHEN OTHERS THEN
                ROLLBACK;
                apex_json.open_object;
                apex_json.write('success', FALSE);
                apex_json.write('message', SQLERRM);
                apex_json.close_object;
        END;
      items-to-submit: 
      - P114_ISSUE_LEVEL
      items-to-return: 
      - P114_ISSUE_LEVEL
      suppress-change-event: false

    execution: 
      sequence: 10
      event: Menu-SESSION- Save Session Title # 151711527146556344
      fire-when-event-result-is: True
      fire-on-initialization: false
      stop-execution-on-error: true
      wait-for-result: true

  - # ====== Action: Execute JavaScript Code =====================
    id: 151712571203556346
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        const $btn = $(this.triggeringElement);
        const sessionId = $btn.data('session-id');
        const newTitle = $('#sessionTitleEdit_' + sessionId).val().trim();
        
        if (!newTitle) {
            apex.message.alert('Session title cannot be empty');
            return;
        }
        
        // Call APEX process
        apex.server.process('UPDATE_SESSION_TITLE', {
            x01: sessionId,
            x02: newTitle
        }, {
            success: function(data) {
                if (data.success) {
                    // Update display
                    $('#sessionTitle_' + sessionId).text(newTitle);
                    cancelEdit(sessionId);
                    apex.message.showPageSuccess('Session title updated');
                    
                    // Refresh region to show new title
                    apex.region('Session_Header').refresh();
                } else {
                    apex.message.alert('Error: ' + data.message);
                }
            },
            error: function(xhr, status, error) {
                apex.message.alert('Failed to update: ' + error);
            }
        });

    execution: 
      sequence: 20
      event: Menu-SESSION- Save Session Title # 151711527146556344
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: SESSION-HEADER-Save on Enter Key ====
  id: 151712993918556347
  identification: 
    name: SESSION-HEADER-Save on Enter Key

  execution: 
    sequence: 100
    event-scope: Static
    type: Immediate

  when: 
    event: Key Press
    selection-type: jQuery Selector
    jquery-selector: .session-title-edit

  client-side-condition: 
    type: JavaScript expression
    javascript-expression: this.browserEvent.key === 'Enter'

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 151713413689556349
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        const sessionId = $(this.triggeringElement).data('session-id');
        $('#saveBtn_' + sessionId).click();

    execution: 
      sequence: 10
      event: SESSION-HEADER-Save on Enter Key # 151712993918556347
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: SESSION-HEADER-Cancel on Escape Key =
  id: 151713861017556350
  identification: 
    name: SESSION-HEADER-Cancel on Escape Key

  execution: 
    sequence: 110
    event-scope: Static
    type: Immediate

  when: 
    event: Key Press
    selection-type: jQuery Selector
    jquery-selector: .session-title-edit

  client-side-condition: 
    type: JavaScript expression
    javascript-expression: this.browserEvent.key === 'Escape'

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 151714380142556351
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        const sessionId = $(this.triggeringElement).data('session-id');
        cancelEdit(sessionId);

    execution: 
      sequence: 10
      event: SESSION-HEADER-Cancel on Escape Key # 151713861017556350
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: Cancel Region New Session Dialog ====
  id: 151714724196556352
  identification: 
    name: Cancel Region New Session Dialog

  execution: 
    sequence: 150
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: Button
    button: Close-dlg-New-Session # 151685714152556250

  actions: 
  - # ====== Action: Close Region ================================
    id: 151715236662556353
    identification: 
      action: Close Region

    affected-elements: 
      selection-type: Region
      region: dlg-New-Session # 301798572574221120

    execution: 
      sequence: 20
      event: Cancel Region New Session Dialog # 151714724196556352
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: Save New Project ====================
  id: 151715647293556354
  identification: 
    name: Save New Project

  execution: 
    sequence: 160
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: Button
    button: Create-dlg-New-Project # 151683235799556242

  actions: 
  - # ====== Action: Execute Server-side Code ====================
    id: 151716153363556355
    identification: 
      action: Execute Server-side Code

    settings: 
      language: PE.PROPERTY.SOURCE_SNIPPET_LANG.LOV.PLSQL.D
      pl/sql-code: |
        DECLARE
            v_project_id NUMBER;
            v_user_id    NUMBER := V('G_USER_ID');
        BEGIN
            -- Validate
            IF :P114_CHAT_PROJECT_TITLE IS NULL THEN
                apex_error.add_error(  p_message => '~ Project name is required',
                    p_display_location => apex_error.c_inline_in_notification );
                RETURN;
            END IF;
            
            -- Create project
               v_project_id:= CHAT_PROJECTS_PKG.add_project(
                                                p_project_code         => :APP_USER|| to_char(systimestamp,'YYYYMMDDHH24MISSFF3'), 
                                                p_project_name         => TRIM(:P114_NEW_CHAT_PROJECT_TITLE),
                                                p_project_description  =>  :P114_CHAT_PROJECT_DESCRIPTION,
                                                p_project_instructions => :P114_CHAT_PROJECT_INSTRUCTIONS,
                                                p_owner_user_id        => V('G_USER_ID'),
                                                p_is_default           => 'N',
                                                p_tenant_id            => v('G_TENANT_ID') );
            
            -- Store new project ID
            :P114_SELECTED_PROJECT_ID := v_project_id;
            commit;
            apex_application.g_print_success_message := '‚úÖ Project created successfully';
            
        EXCEPTION
            WHEN OTHERS THEN
                apex_error.add_error(  p_message          => 'Error creating project: ' || SQLERRM,
                                       p_display_location => apex_error.c_inline_in_notification );
        END;
        
        
        
        
        
         
      items-to-submit: 
      - P114_NEW_CHAT_PROJECT_TITLE
      - P114_CHAT_PROJECT_DESCRIPTION
      - P114_CHAT_PROJECT_INSTRUCTIONS
      - P114_CHAT_PROJECT_TITLE
      items-to-return: 
      - P114_SELECTED_PROJECT_ID
      suppress-change-event: false

    execution: 
      sequence: 10
      event: Save New Project # 151715647293556354
      fire-when-event-result-is: True
      fire-on-initialization: false
      stop-execution-on-error: true
      wait-for-result: true

  - # ====== Action: Refresh =====================================
    id: 151716642719556356
    identification: 
      action: Refresh

    settings: 
      maintain-pagination: false

    affected-elements: 
      selection-type: Region
      region: MyProjectsTree # 300461147415765424

    execution: 
      sequence: 10
      event: Save New Project # 151715647293556354
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Close Region ================================
    id: 151717134270556358
    identification: 
      action: Close Region

    affected-elements: 
      selection-type: Region
      region: dlg-New Project # 301798403176221119

    execution: 
      sequence: 30
      event: Save New Project # 151715647293556354
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Refresh New S Project =======================
    id: 155690058385186636
    identification: 
      name: Refresh New S Project
      action: Refresh

    settings: 
      maintain-pagination: false

    affected-elements: 
      selection-type: Item(s)
      item(s): 
      - P114_NEW_SESSION_PROJECT_ID

    execution: 
      sequence: 20
      event: Save New Project # 151715647293556354
      fire-when-event-result-is: True
      fire-on-initialization: false

    comments: 
      comments: |
        Refresh P114_NEW_SESSION_PROJECT_ID
        it does have the new created project in the same session, if you create project ,you will find this in the list,so we refresh here

- # ====== Dynamic Action: Cancel Region New Project Dialog ====
  id: 151717506324556358
  identification: 
    name: Cancel Region New Project Dialog

  execution: 
    sequence: 170
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: Button
    button: Close-dlg-New-Project # 151683646737556243

  actions: 
  - # ====== Action: Close Region ================================
    id: 151718045268556360
    identification: 
      name: Close Region
      action: Close Region

    affected-elements: 
      selection-type: Region
      region: dlg-New Project # 301798403176221119

    execution: 
      sequence: 20
      event: Cancel Region New Project Dialog # 151717506324556358
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: Open New Project Dialog =============
  id: 151718424760556360
  identification: 
    name: Open New Project Dialog

  execution: 
    sequence: 180
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: Button
    button: BTN_NEW_PROJECT # 151666248908556190

  actions: 
  - # ====== Action: Clear =======================================
    id: 151718977545556362
    identification: 
      action: Clear

    affected-elements: 
      selection-type: Item(s)
      item(s): 
      - P114_NEW_CHAT_PROJECT_TITLE
      - P114_CHAT_PROJECT_INSTRUCTIONS
      - P114_CHAT_PROJECT_DESCRIPTION

    execution: 
      sequence: 10
      event: Open New Project Dialog # 151718424760556360
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Open Region =================================
    id: 151719481104556363
    identification: 
      action: Open Region

    affected-elements: 
      selection-type: Region
      region: dlg-New Project # 301798403176221119

    execution: 
      sequence: 20
      event: Open New Project Dialog # 151718424760556360
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: Open New Session Dialog =============
  id: 151719809158556364
  identification: 
    name: Open New Session Dialog

  execution: 
    sequence: 200
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: Button
    button: BTN_NEW_SESSION # 151666668812556192

  actions: 
  - # ====== Action: Clear =======================================
    id: 151720388913556365
    identification: 
      action: Clear

    affected-elements: 
      selection-type: Item(s)
      item(s): 
      - P114_NEW_SESSION_TITLE
      - P114_NEW_SESSION_PROJECT_ID

    execution: 
      sequence: 10
      event: Open New Session Dialog # 151719809158556364
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Open Region =================================
    id: 151720822480556366
    identification: 
      action: Open Region

    affected-elements: 
      selection-type: Region
      region: dlg-New-Session # 301798572574221120

    execution: 
      sequence: 20
      event: Open New Session Dialog # 151719809158556364
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: Save new Session ====================
  id: 151721299750556367
  identification: 
    name: Save new Session

  execution: 
    sequence: 210
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: Button
    button: create-dlg-New-Session # 151685365208556249

  actions: 
  - # ====== Action: Execute Server-side Code ====================
    id: 151721772125556368
    identification: 
      action: Execute Server-side Code

    settings: 
      language: PE.PROPERTY.SOURCE_SNIPPET_LANG.LOV.PLSQL.D
      pl/sql-code: |
        DECLARE
           --P114_NEW_SESSION_PROJECT_ID,P114_NEW_SESSION_TITLE,P114_PROVIDER,P114_MODEL
            vcaller  VARCHAR2(100)   := 'DYNA-PAGE'||:APP_PAGE_ID||'.'||'ADD-NEW-SESSION';
            v_session_id    NUMBER;
            v_user_id       NUMBER          := V('G_USER_ID');
            v_project_id    NUMBER          := :P114_NEW_SESSION_PROJECT_ID;
            v_session_title VARCHAR2(200)   := :P114_NEW_SESSION_TITLE;
            v_provider  VARCHAR2(100)   := :P114_PROVIDER;
            v_model     VARCHAR2(100)   := :P114_MODEL;
            v_traceid   VARCHAR2(200) ;
        BEGIN
            -- Validate
            IF v_session_title IS NULL THEN
                apex_error.add_error(   p_message          => 'Session title is required',
                                        p_display_location => apex_error.c_inline_in_notification );
                RETURN;
            END IF;
            
            IF v_project_id IS NULL THEN
                apex_error.add_error(  p_message          => 'No active project selected',
                                       p_display_location => apex_error.c_inline_in_notification );
                RETURN;
            END IF;
        
              -- Create new session
                v_session_id := chat_session_pkg.new_session(   p_provider       => v_provider,
                                                                p_model          => v_model,
                                                                p_session_title  => v_session_title,
                                                                p_user_id        => v_user_id,
                                                                p_app_session_id => :APP_SESSION,
                                                                p_app_id         => :APP_ID,
                                                                p_app_page_id    => :APP_PAGE_ID,
                                                                p_project_id     =>  v_project_id,
                                                                p_tenant_id      => v('G_TENANT_ID'),
                                                                p_trace_id       => v_traceid
                                                            );
          
            
            COMMIT;
            If v_session_id is not null then
                :P114_SESSION_TITLE:= v_session_title;
                :P114_NEW_SESSION_ID  := v_session_id;
                :P114_CHAT_SESSION_ID := v_session_id;
           --P114_SESSION_TITLE,P114_NEW_SESSION_ID,P114_CHAT_SESSION_ID
            end if;
            
            apex_application.g_print_success_message := '‚úÖ Session created successfully';
            
        EXCEPTION
            WHEN OTHERS THEN
                ROLLBACK;
                debug_util.error(sqlerrm,vcaller,v_traceid );
                apex_error.add_error(  p_message          => 'Error creating session: ' || SQLERRM,
                                       p_display_location => apex_error.c_inline_in_notification  );
        END;
        
         
      items-to-submit: 
      - P114_NEW_SESSION_PROJECT_ID
      - P114_NEW_SESSION_TITLE
      - P114_PROVIDER
      - P114_MODEL
      items-to-return: 
      - P114_SESSION_TITLE
      - P114_NEW_SESSION_ID
      - P114_CHAT_SESSION_ID
      suppress-change-event: false

    execution: 
      sequence: 10
      event: Save new Session # 151721299750556367
      fire-when-event-result-is: True
      fire-on-initialization: false
      stop-execution-on-error: true
      wait-for-result: true

  - # ====== Action: Refresh =====================================
    id: 151722270518556370
    identification: 
      action: Refresh

    settings: 
      maintain-pagination: false

    affected-elements: 
      selection-type: Region
      region: MyProjectsTree # 300461147415765424

    execution: 
      sequence: 20
      event: Save new Session # 151721299750556367
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Refresh =====================================
    id: 151722763772556371
    identification: 
      action: Refresh

    settings: 
      maintain-pagination: false

    affected-elements: 
      selection-type: Region
      region: myActiveSession # 300501172210850030

    execution: 
      sequence: 30
      event: Save new Session # 151721299750556367
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Close Region ================================
    id: 151723225218556372
    identification: 
      action: Close Region

    affected-elements: 
      selection-type: Region
      region: dlg-New-Session # 301798572574221120

    execution: 
      sequence: 40
      event: Save new Session # 151721299750556367
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: Send Key Down =======================
  id: 151724919967589506
  identification: 
    name: Send Key Down

  execution: 
    sequence: 220
    event-scope: Static
    type: Immediate

  when: 
    event: Key Down
    selection-type: Button
    button: SEND # 151724868627589505

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 151725027793589507
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        if (event.key === "Enter" && !event.shiftKey) {
            event.preventDefault();
            $("#sendBtn").click();   // Replace with your actual Send button ID
        }

    execution: 
      sequence: 10
      event: Send Key Down # 151724919967589506
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: after Region Refresh ================
  id: 151725372492589510
  identification: 
    name: after Region Refresh

  execution: 
    sequence: 230
    event-scope: Static
    type: Immediate

  when: 
    event: After Refresh
    selection-type: Region
    region: chatCall-scrollBtn # 151725297394589509

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 151725474059589511
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        apex.region("chatCalls_region").onRefresh(function() {
            const cards = document.querySelectorAll(".chatCall-card");
            const lastCard = cards[cards.length - 1];
            if (lastCard) {
                lastCard.classList.add("chatCall-highlight");
                setTimeout(() => lastCard.classList.remove("chatCall-highlight"), 1200);
            }
        });

    execution: 
      sequence: 10
      event: after Region Refresh # 151725372492589510
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: save ================================
  id: 151726924631589526
  identification: 
    name: save

  execution: 
    sequence: 240
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: Button
    button: Save-Call-Rating-dlg # 151726736642589524

  actions: 
  - # ====== Action: Execute Server-side Code ====================
    id: 151727014493589527
    identification: 
      action: Execute Server-side Code

    settings: 
      language: PE.PROPERTY.SOURCE_SNIPPET_LANG.LOV.PLSQL.D
      pl/sql-code: |
        UPDATE chat_calls
        SET 
            user_rating = :P114_RATING,
            user_rating_comment = :P114_COMMENT,
            user_rating_ts = SYSTIMESTAMP
        WHERE call_id = :P114_CALL_ID;
        Commit;

    execution: 
      sequence: 10
      event: save # 151726924631589526
      fire-when-event-result-is: True
      fire-on-initialization: false
      stop-execution-on-error: true
      wait-for-result: true

  - # ====== Action: Close Region ================================
    id: 151727487132589531
    identification: 
      action: Close Region

    affected-elements: 
      selection-type: Region
      region: dlg-Call-Rating # 151726325874589520

    execution: 
      sequence: 20
      event: save # 151726924631589526
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: close Rating Dialog =================
  id: 151727105583589528
  identification: 
    name: close Rating Dialog

  execution: 
    sequence: 250
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: Button
    button: Close-Call-Rating-dlg # 151726864927589525

  actions: 
  - # ====== Action: Close Region ================================
    id: 151727298171589529
    identification: 
      action: Close Region

    affected-elements: 
      selection-type: Region
      region: dlg-Call-Rating # 151726325874589520

    execution: 
      sequence: 10
      event: close Rating Dialog # 151727105583589528
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Refresh =====================================
    id: 151727392964589530
    identification: 
      action: Refresh

    settings: 
      maintain-pagination: false

    affected-elements: 
      selection-type: Region
      region: LLM Calls # 301843113611557821

    execution: 
      sequence: 20
      event: close Rating Dialog # 151727105583589528
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: close Move ==========================
  id: 155688250824186618
  identification: 
    name: close Move

  execution: 
    sequence: 260
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: Button
    button: Cancel-dlg-Move-Session # 155688145084186617

  actions: 
  - # ====== Action: Close Region ================================
    id: 155688384009186619
    identification: 
      action: Close Region

    affected-elements: 
      selection-type: Region
      region: dlg-Move-Session # 155687807448186614

    execution: 
      sequence: 20
      event: close Move # 155688250824186618
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Refresh =====================================
    id: 155688482189186620
    identification: 
      action: Refresh

    settings: 
      maintain-pagination: false

    affected-elements: 
      selection-type: Region
      region: myActiveSession # 300501172210850030

    execution: 
      sequence: 40
      event: close Move # 155688250824186618
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Refresh =====================================
    id: 155688518262186621
    identification: 
      action: Refresh

    settings: 
      maintain-pagination: false

    affected-elements: 
      selection-type: Region
      region: MyProjectsTree # 300461147415765424

    execution: 
      sequence: 30
      event: close Move # 155688250824186618
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Execute JavaScript Code =====================
    id: 155689512112186631
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: $("#moveSessionRegionId").slideUp(180);

    execution: 
      sequence: 10
      event: close Move # 155688250824186618
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: saveMove ============================
  id: 155688656710186622
  identification: 
    name: saveMove

  execution: 
    sequence: 270
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: Button
    button: Save-dlg-Move-Session # 155688052284186616

  actions: 
  - # ====== Action: Execute Server-side Code ====================
    id: 155688733434186623
    identification: 
      action: Execute Server-side Code

    settings: 
      language: PE.PROPERTY.SOURCE_SNIPPET_LANG.LOV.PLSQL.D
      pl/sql-code: |
        if :P114_MOVE_SESSION_PROJECT_ID is not null then
                UPDATE chat_sessions
                SET chat_project_id  = :P114_MOVE_SESSION_PROJECT_ID
                WHERE session_id = :P114_CHAT_SESSION_ID;
                Commit;
        end if;
      items-to-submit: 
      - P114_CHAT_SESSION_ID
      - P114_MOVE_SESSION_PROJECT_ID

    execution: 
      sequence: 10
      event: saveMove # 155688656710186622
      fire-when-event-result-is: True
      fire-on-initialization: false
      stop-execution-on-error: true
      wait-for-result: true

  - # ====== Action: Close Region ================================
    id: 155688834253186624
    identification: 
      action: Close Region

    affected-elements: 
      selection-type: Region
      region: dlg-Move-Session # 155687807448186614

    execution: 
      sequence: 20
      event: saveMove # 155688656710186622
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: Open ReAssign Session to Proj Dialog 
  id: 155689601267186632
  identification: 
    name: Open ReAssign Session to Proj Dialog

  execution: 
    sequence: 190
    event-scope: Static
    type: Immediate

  when: 
    event: Custom
    custom-event: open-reassign-session
    selection-type: JavaScript Expression
    javascript-expression: document

  actions: 
  - # ====== Action: Clear =======================================
    id: 155689732815186633
    identification: 
      action: Clear

    affected-elements: 
      selection-type: Item(s)
      item(s): 
      - P114_MOVE_SESSION_PROJECT_ID

    execution: 
      sequence: 20
      event: Open ReAssign Session to Proj Dialog # 155689601267186632
      fire-when-event-result-is: True
      fire-on-initialization: false

  - # ====== Action: Open Region =================================
    id: 155689804753186634
    identification: 
      action: Open Region

    affected-elements: 
      selection-type: Region
      region: dlg-Move-Session # 155687807448186614

    execution: 
      sequence: 30
      event: Open ReAssign Session to Proj Dialog # 155689601267186632
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: Menu-chatCall-more Btn ==============
  id: 155690587766186641
  identification: 
    name: Menu-chatCall-more Btn

  execution: 
    sequence: 280
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: jQuery Selector
    jquery-selector: .chatCall-moreBtn

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 155690640317186642
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: |
        // Close all open menus
        $(".chatCall-moreDropdown").hide();
        
        const btn  = this.triggeringElement;
        const rect = btn.getBoundingClientRect();
        
        const $menu = $(btn)
            .closest(".chatCall-more")
            .find(".chatCall-moreDropdown");
        
        // Position relative to viewport (FIXED)
        $menu.css({
            top:  rect.bottom + 4 + "px",
            left: rect.left + "px"
        });
        
        // Show menu
        $menu.show();
        

    execution: 
      sequence: 10
      event: Menu-chatCall-more Btn # 155690587766186641
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: Menu-chatCall-more Btn_close ========
  id: 155690754552186643
  identification: 
    name: Menu-chatCall-more Btn_close

  execution: 
    sequence: 290
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: jQuery Selector
    jquery-selector: document

  client-side-condition: 
    type: JavaScript expression
    javascript-expression: |
      !$(this.triggeringElement)
          .closest(".chatCall-more").length

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 155690825690186644
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: $(".chatCall-moreDropdown").hide();

    execution: 
      sequence: 10
      event: Menu-chatCall-more Btn_close # 155690754552186643
      fire-when-event-result-is: True
      fire-on-initialization: false

- # ====== Dynamic Action: Menu-chatCall-Close after Menu Action
  id: 155690937302186645
  identification: 
    name: Menu-chatCall-Close after Menu Action

  execution: 
    sequence: 300
    event-scope: Static
    type: Immediate

  when: 
    event: Click
    selection-type: jQuery Selector
    jquery-selector: .chatCall-menuItem

  client-side-condition: 
    type: JavaScript expression
    javascript-expression: |
      !$(this.triggeringElement)
          .closest(".chatCall-more").length

  actions: 
  - # ====== Action: Execute JavaScript Code =====================
    id: 155691127230186647
    identification: 
      action: Execute JavaScript Code

    settings: 
      code: $(".chatCall-moreDropdown").hide();

    execution: 
      sequence: 10
      event: Menu-chatCall-Close after Menu Action # 155690937302186645
      fire-when-event-result-is: True
      fire-on-initialization: false

validations: 
- # ====== Validation: ProjectNameNotEmpty =====================
  id: 151727572155589532
  identification: 
    name: ProjectNameNotEmpty

  execution: 
    sequence: 10

  validation: 
    type: Expression
    language: PL/SQL
    pl/sql-expression: ':P114_NEW_CHAT_PROJECT_TITLE IS NOT NULL'
    always-execute: false

  error: 
    error-message: Project should have a name!
    display-location: Inline with Field and in Notification
    associated-item: P114_NEW_CHAT_PROJECT_TITLE # 301823940639221247

  server-side-condition: 
    when-button-pressed: Create-dlg-New-Project # 151683235799556242

processes: 
- # ====== Process: INVOKE_LLM =================================
  id: 151695428887556300
  identification: 
    name: INVOKE_LLM
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
          vcaller        CONSTANT VARCHAR2(70) := 'PROCESS_PAGE'||:APP_PAGE_ID||'.INVOKE_LLM';
          v_req          llm_types.t_llm_request;
          v_resp         llm_types.t_llm_response;
          v_json_text    CLOB := apex_application.g_x01;
          v_json_obj     JSON_OBJECT_T;
          v_trace_id     VARCHAR2(200);
          v_msg          VARCHAR2(4000);
      BEGIN
          apex_json.initialize_output;
          
          -- 1. Safe JSON Parsing
          IF v_json_text IS NULL THEN
              RAISE_APPLICATION_ERROR(-20001, 'Empty Payload');
          END IF;
      
          BEGIN
              v_json_obj := JSON_OBJECT_T.parse(v_json_text);
          EXCEPTION WHEN OTHERS THEN
              -- Catch invalid JSON immediately
              apex_json.open_object;
              apex_json.write('success', FALSE);
              apex_json.write('error', 'Invalid JSON Payload');
              apex_json.close_object;
              RETURN;
          END;
          
          -- 2. Extract Trace ID (Safe)
          IF v_json_obj.has('traceid') THEN v_trace_id := v_json_obj.get_string('traceid');
          ELSIF v_json_obj.has('trace_id') THEN v_trace_id := v_json_obj.get_string('trace_id');
          ELSE v_trace_id := 'MISSING-' || TO_CHAR(SYSTIMESTAMP, 'HH24MISS'); END IF;
      
          debug_util.starting(vcaller, 'Payload Size: ' || DBMS_LOB.getlength(v_json_text), v_trace_id);
      
          -- 3. Map Request
          v_req.trace_id            := v_trace_id;
          v_req.chat_session_id     := v_json_obj.get_number('chat_session_id');
          v_req.chat_call_id        := v_json_obj.get_number('chat_call_id');
          v_req.context_domain_id   := v_json_obj.get_number('context_domain_id');
          
          -- Safe String Extraction
          v_req.provider            := NVL(v_json_obj.get_string('provider'), 'OPENAI');
          v_req.model               := NVL(v_json_obj.get_string('model'), 'gpt-4o-mini');
          v_req.user_prompt         := v_json_obj.get_string('user_prompt');
          v_req.system_instructions := v_json_obj.get_string('system_instructions');
          
          -- Safe Number Extraction
          v_req.temperature         := NVL(v_json_obj.get_number('temperature'), 0.7);
          v_req.max_tokens          := NVL(v_json_obj.get_number('max_tokens'), 1024);
          v_req.top_p               := NVL(v_json_obj.get_number('top_p'), 1.0);
          v_req.top_k               := NVL(v_json_obj.get_number('top_k'), 0);
      
          -- Context
          v_req.app_id              := :APP_ID;
          v_req.user_id             := v('G_USER_ID');
          v_req.tenant_id           := v('G_TENANT_ID');
      
          -- 4. Execute Engine
          v_resp := CHAT_ENGINE_PKG.invoke_chat(v_req);
      
          -- 5. Response
          IF v_resp.success THEN
              audit_util.log_event('PROC_OK', 'LLM Success', v_trace_id, vcaller);
              apex_json.open_object;
              apex_json.write('success', TRUE);
              apex_json.write('response_text', v_resp.response_text);
              apex_json.write('trace_id', v_trace_id);
              apex_json.close_object;
          ELSE
              -- Return controlled failure
              apex_json.open_object;
              apex_json.write('success', FALSE);
              apex_json.write('error', v_resp.msg);
              apex_json.write('trace_id', v_trace_id);
              apex_json.close_object;
          END IF;
      
          debug_util.ending(vcaller, 'OK', v_trace_id);
      
      EXCEPTION WHEN OTHERS THEN
          ROLLBACK;
          
          -- üö® Log Critical Error to Chat Table (so UI Refresh shows it)
          BEGIN
              CHAT_CALL_PKG.update_call_response(
                  p_call_id => v_req.chat_call_id, 
                  p_trace_id => v_trace_id, 
                  p_user_prompt => v_req.user_prompt,
                  p_response => 'System Error: ' || SQLERRM, 
                  p_status => 'F'
              );
              COMMIT; 
          EXCEPTION WHEN OTHERS THEN NULL; END;
      
          debug_util.error(SQLERRM, vcaller, v_trace_id);
          
          -- Return JSON (Prevent 500 Error)
          apex_json.open_object;
          apex_json.write('success', FALSE);
          apex_json.write('error', 'Internal System Error: ' || SQLERRM);
          apex_json.close_object;
      END;

  execution: 
    sequence: 160
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

- # ====== Process: ENSURE_SESSION =============================
  id: 151695766663556301
  identification: 
    name: ENSURE_SESSION
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      -- Process Name: ENSURE_SESSION
      -- Point: Ajax Callback
      
      DECLARE
           vcaller varchar2(30):= 'PROCESS_PAGE'||:APP_PAGE_ID||'.ENSURE_SESSION';
          v_session_id  NUMBER;
          v_ChatCallId  NUMBER;
          v_trace_id VARCHAR2(200);
          v_user_id NUMBER;
          v_suggested_title VARCHAR2(200);
          v_user_prompt CLOB := apex_application.g_x01;
          v_provider VARCHAR2(50);
          v_model VARCHAR2(100);
      BEGIN
          v_session_id := NVL(TO_NUMBER(:P114_CHAT_SESSION_ID), NULL);
          -- Step 1: Get user_id
          v_user_id := NVL(v('G_USER_ID'), NULL);
          IF  v_session_id is not null then --we will trace start from call
             v_trace_id:= CHAT_CALL_PKG.New_traceid;
          END IF;   
      
          IF v_user_id IS NULL THEN
              BEGIN
                  SELECT user_id INTO v_user_id  
                  FROM users
                  WHERE user_name = :APP_USER;
              EXCEPTION
                  WHEN NO_DATA_FOUND THEN
                      apex_json.open_object;
                      apex_json.write('success', FALSE);
                      apex_json.write('error', 'User not found: ' || :APP_USER);
                      apex_json.close_object;
                      debug_util.error('User not found - ' || :APP_USER,vcaller,v_trace_id);
                      RETURN;
              END;
          END IF;
          
          -- Step 2: Get provider and model (with validation)
          v_provider := NVL(:P114_PROVIDER, 'OPENAI');
          v_model := NVL(:P114_MODEL, 'gpt-4o-mini');
          
          -- Debug: Log what we received
          debug_util.info('Provider( '||v_provider || ' )  , Model ( ' || v_model ||' )',vcaller,v_trace_id);
          
          -- Step 3: Check if session exists
          
          IF v_session_id IS NULL THEN
              -- === CREATE NEW SESSION ===
              debug_util.info('No Session,create a new chatsession for userid('||v_user_id|| ') ',vcaller,v_trace_id);
              
              -- Generate suggested title
              v_suggested_title := CASE 
                  WHEN LENGTH(v_user_prompt) <= 50 THEN v_user_prompt
                  ELSE SUBSTR(v_user_prompt, 1, 47) || '...'    
              END;
              
              -- Create new session
              v_session_id := chat_session_pkg.new_session(
                  p_provider       => v_provider,
                  p_model          => v_model,
                  p_session_title  => v_suggested_title,
                  p_user_id        => v_user_id,
                  p_app_session_id => :APP_SESSION,
                  p_app_id         => :APP_ID,
                  p_app_page_id    => :APP_PAGE_ID,
                  p_project_id     => v('G_CHAT_PROJECT_ID'),
                  p_tenant_id      => v('G_TENANT_ID'),
                  p_trace_id       => v_trace_id --out
              );
      
             -- Validate session was created
              IF v_session_id IS NULL THEN
                  apex_json.open_object;
                  apex_json.write('success', FALSE);
                  apex_json.write('error', 'Chatsession creation returned NULL');
                  apex_json.close_object;
                  debug_util.error('ChatSession creation returned NULL',vcaller,v_trace_id);
                  RETURN;
              END IF;
      
      
              -- Persist to session state
              apex_util.set_session_state(  p_name  => 'P114_CHAT_SESSION_ID',  p_value => v_session_id  );
              
              -- Set session title if empty
              IF :P114_SESSION_TITLE IS NULL THEN
                  apex_util.set_session_state(  p_name  => 'P114_SESSION_TITLE', p_value => v_suggested_title  );
              END IF;
              
              debug_util.info('New sessionId =' || v_session_id,vcaller,v_trace_id);
              
          ELSE
              -- === REUSE EXISTING SESSION ===
              debug_util.info('Reusing existing chatsessionId ' || v_session_id,vcaller,v_trace_id);
              
              -- Get existing title
              v_suggested_title := NVL(:P114_SESSION_TITLE, 'Chat Session');
              
              -- Update last activity
              UPDATE chat_sessions
              SET last_activity_date = SYSTIMESTAMP
              WHERE session_id = v_session_id;
              debug_util.info('Chat-Session Updated of lastActivity ',vcaller,v_trace_id);
              
          END IF;
          ---New or reuse will create an call record
          IF v_session_id is NOT null then
                    v_ChatCallId :=  CHAT_CALL_PKG.New_ChatCall (p_chat_session_id => v_session_id, p_trace_id => v_trace_id);
                     debug_util.info('new chatCall ('||v_ChatCallId|| ') for session('||v_session_id|| ') ',vcaller,v_trace_id);
           End If;
          
          -- Return JSON response
          apex_json.open_object;
          apex_json.write('success', TRUE);
          apex_json.write('session_id', v_session_id);
          apex_json.write('chatcall_id', v_ChatCallId);
          apex_json.write('trace_id', v_trace_id);
          apex_json.write('suggested_title', v_suggested_title);
          apex_json.write('is_new', CASE WHEN :P114_CHAT_SESSION_ID IS NULL THEN TRUE ELSE FALSE END);
          apex_json.close_object;
          
      EXCEPTION
          WHEN OTHERS THEN
              apex_json.open_object;
              apex_json.write('success', FALSE);
              apex_json.write('error', SQLERRM);
              apex_json.write('backtrace', DBMS_UTILITY.FORMAT_ERROR_BACKTRACE);
              apex_json.close_object;
              debug_util.error(SQLERRM ||' ,'|| DBMS_UTILITY.FORMAT_ERROR_BACKTRACE,vcaller,v_trace_id);
      END;

  execution: 
    sequence: 140
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

- # ====== Process: DETECT_DOMAIN ==============================
  id: 151696154173556302
  identification: 
    name: DETECT_DOMAIN
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
          vcaller             CONSTANT VARCHAR2(70) := 'PROCESS_PAGE'||:APP_PAGE_ID||'.DETECT_DOMAIN';
          v_session_id        NUMBER;
          v_user_prompt       CLOB;
          v_trace_id          VARCHAR2(200);
          v_chat_call_id      NUMBER;
          
          -- Direct Input Variables
          v_in_provider       VARCHAR2(100);
          v_in_model          VARCHAR2(100);
          v_in_sys_inst       VARCHAR2(4000);
          v_in_domain_id      NUMBER;
      
          v_classifier_req    CXD_TYPES.t_cxd_classifier_req;
          v_classifier_resp   CXD_TYPES.t_cxd_classifier_resp;
          v_intent_classifier_resp CXD_TYPES.t_intent_classifier_resp;
      BEGIN
          apex_json.initialize_output;
      
          -- 1. Map Inputs
          v_session_id   := TO_NUMBER(apex_application.g_x01);
          v_chat_call_id := TO_NUMBER(apex_application.g_x02);
          v_trace_id     := apex_application.g_x03;
          v_user_prompt  := apex_application.g_x04;
          
          -- üöÄ DIRECT READ (Bypassing potential Session State NULLs)
          v_in_provider  := apex_application.g_x05;
          v_in_model     := apex_application.g_x06;
          v_in_sys_inst  := apex_application.g_x07;
          v_in_domain_id := TO_NUMBER(apex_application.g_x08);
      
          debug_util.starting(vcaller, 'Session: '||v_session_id||' | Provider: '||v_in_provider, v_trace_id);
      
          -- 2. Build Request
          v_classifier_req.trace_id              := v_trace_id;
          v_classifier_req.chat_session_id       := v_session_id;
          v_classifier_req.chat_call_id          := v_chat_call_id;
          v_classifier_req.detection_Method_code := 'AUTO';
          
          v_classifier_req.context_domain_id     := v_in_domain_id; 
          v_classifier_req.provider              := v_in_provider;
          v_classifier_req.model                 := v_in_model;
          v_classifier_req.user_prompt           := v_user_prompt;
          
          -- Standard Context
          v_classifier_req.user_id               := v('G_USER_ID');
          v_classifier_req.app_id                := :APP_ID;
          v_classifier_req.app_session_id        := :APP_SESSION;
          v_classifier_req.tenant_id             := v('G_TENANT_ID');
          v_classifier_req.chat_project_id       := v('G_CHAT_PROJECT_ID');
      
          -- 3. Execute Detection
          cxd_classifier_pkg.detect(
              p_req         => v_classifier_req,
              P_resp_Domain => v_classifier_resp,
              P_resp_Intent => v_intent_classifier_resp
          );
      
          -- 4. Process Result
          IF v_classifier_resp.context_domain_id IS NOT NULL THEN
              -- Update Session with new Domain
              UPDATE chat_sessions
                 SET context_domain_id = v_classifier_resp.context_domain_id,
                     last_activity_date = SYSTIMESTAMP
               WHERE session_id = v_session_id;
              COMMIT;
              
              audit_util.log_event('PROC_OK', 'Domain Detected: '||v_classifier_resp.context_domain_name, v_trace_id, vcaller);
      
              apex_json.open_object;
              apex_json.write('success', TRUE);
              apex_json.write('context_domain_id', v_classifier_resp.context_domain_id);
              apex_json.write('trace_id', v_classifier_resp.trace_id);
              apex_json.close_object;
          ELSE
              -- Log Failure
              CHAT_CALL_PKG.update_call_response(
                  p_call_id => v_chat_call_id, p_trace_id => v_trace_id, p_user_prompt => v_user_prompt,
                  p_response => 'Domain detection failed: '||v_classifier_resp.message, p_status => 'F'
              );
              COMMIT;
      
              apex_json.open_object;
              apex_json.write('success', FALSE);
              apex_json.write('error', 'Domain detection failed');
              apex_json.close_object;
          END IF;
      
          debug_util.ending(vcaller, 'DONE', v_trace_id);
      
      EXCEPTION WHEN OTHERS THEN
          ROLLBACK;
          -- Log System Error to Call Table so user sees it
          CHAT_CALL_PKG.update_call_response(
              p_call_id => v_chat_call_id, p_trace_id => v_trace_id, p_user_prompt => v_user_prompt,
              p_response => 'System Error in Detection: '||SQLERRM, p_status => 'F'
          );
          COMMIT;
          
          debug_util.error(SQLERRM, vcaller, v_trace_id);
          apex_json.open_object;
          apex_json.write('success', FALSE);
          apex_json.write('error', 'System Error');
          apex_json.close_object;
      END;

  execution: 
    sequence: 150
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

- # ====== Process: SET_SESSION_ITEM ===========================
  id: 151696532903556304
  identification: 
    name: SET_SESSION_ITEM
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |2
       
        declare  
           vcaller varchar2(30):= 'PROCESS_PAGE'||:APP_PAGE_ID||'.SET_SESSION_ITEM';
           v_CHAT_SESSION_ID           NUMBER := TO_NUMBER(apex_application.g_x01);
           v_SELECTED_PROJECT_ID       NUMBER := TO_NUMBER(apex_application.g_x02);
       --  v     NUMBER := apex_application.g_x03;
       BEGIN
          APEX_UTIL.SET_SESSION_STATE('P114_CHAT_SESSION_ID', v_CHAT_SESSION_ID);
          APEX_UTIL.SET_SESSION_STATE('P114_SELECTED_PROJECT_ID', v_SELECTED_PROJECT_ID);
         -- APEX_UTIL.SET_SESSION_STATE('P1_ITEM', :x03);
      END;  
      
         

  execution: 
    sequence: 80
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

- # ====== Process: SAVE_ASSISTANT_MESSAGE =====================
  id: 151696943127556305
  identification: 
    name: SAVE_ASSISTANT_MESSAGE
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      -- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      -- CORRECTED: SAVE_ASSISTANT_MESSAGE Process
      -- Issue: P114_CHAT_SESSION_ID was NULL after new_session call
      -- Fix: Explicit assignment with proper NULL handling
      -- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      
      DECLARE
           vcaller varchar2(30):= 'PROCESS_PAGE'||:APP_PAGE||'.SAVE_ASSISTANT_MESSAGE';
          v_session_id NUMBER;
          v_msg_id NUMBER;
          v_check NUMBER;
      BEGIN
          -- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          -- STEP 1: Get or Create Session
          -- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          
          APEX_DEBUG.INFO('STEP 1: Checking P114_CHAT_SESSION_ID = ' || 
                          NVL(:P114_CHAT_SESSION_ID, 'NULL'));
          
          -- Convert to NUMBER safely
          BEGIN
              v_session_id := TO_NUMBER(:P114_CHAT_SESSION_ID);
          EXCEPTION
              WHEN VALUE_ERROR OR INVALID_NUMBER THEN
                  v_session_id := NULL;
                  APEX_DEBUG.WARN('P114_CHAT_SESSION_ID is not a valid number, will create new');
          END;
          
          -- Check if session exists and is valid
          IF v_session_id IS NOT NULL THEN
              SELECT COUNT(*) INTO v_check
              FROM chat_sessions
              WHERE session_id = v_session_id;
              
              IF v_check = 0 THEN
                  APEX_DEBUG.WARN('Session ' || v_session_id || ' not found, will create new');
                  v_session_id := NULL;
              ELSE
                  APEX_DEBUG.INFO('Using existing session: ' || v_session_id);
              END IF;
          END IF;
          
          -- Create new session if needed
          IF v_session_id IS NULL THEN
              APEX_DEBUG.INFO('Creating new session...');
              
              v_session_id := chat_session_pkg.new_session(
                  p_user_id        => TO_NUMBER(v('G_USER_ID')),
                  p_session_title  => 'Chat Session - ' || TO_CHAR(SYSDATE, 'YYYY-MM-DD HH24:MI'),
                  p_provider       => NVL(:P114_PROVIDER, 'OPENAI'),
                  p_model          => NVL(:P114_MODEL, 'gpt-4o-mini'),
                  p_project_id     => TO_NUMBER(NVL(:P114_CHAT_PROJECT_ID, '0')),
                  p_app_id         => TO_NUMBER(v('APP_ID')),
                  p_app_page_id    => TO_NUMBER(v('APP_PAGE_ID')),
                  p_app_session_id => TO_NUMBER(v('APP_SESSION')),
                  p_tenant_id      => TO_NUMBER(NVL(v('G_TENANT_ID'), '0'))
              );
              
              APEX_DEBUG.INFO('Created new session_id: ' || NVL(TO_CHAR(v_session_id), 'NULL'));
              
              -- CRITICAL: Update page item with new session_id
              :P114_CHAT_SESSION_ID := v_session_id;
              
              -- Verify it was set
              APEX_DEBUG.INFO('P114_CHAT_SESSION_ID now = ' || NVL(:P114_CHAT_SESSION_ID, 'NULL'));
          END IF;
          
          -- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          -- STEP 2: Final Validation
          -- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          
          IF v_session_id IS NULL THEN
              RAISE_APPLICATION_ERROR(-20001, 
                  'FATAL: Failed to create or retrieve session_id');
          END IF;
          
          -- Verify session exists in database
          SELECT COUNT(*) INTO v_check
          FROM chat_sessions
          WHERE session_id = v_session_id;
          
          IF v_check = 0 THEN
              RAISE_APPLICATION_ERROR(-20001, 
                  'FATAL: Session ' || v_session_id || ' not found in chat_sessions table');
          END IF;
          
          APEX_DEBUG.INFO('‚úì Session validated: ' || v_session_id);
          
          -- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          -- STEP 3: Save Assistant Message
          -- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          
          APEX_DEBUG.INFO('STEP 3: Saving assistant message for session ' || v_session_id);
          
          v_msg_id := chat_message_pkg.add_message(
              p_session_id     => v_session_id,
              p_message_role   => 'ASSISTANT',
              p_content        => apex_application.g_x01,
              p_params         => NULL,
              p_rag_context    => NULL,
              p_rag_doc_count  => NULL,
              p_tokens_input   => NULL,
              p_tokens_output  => NULL,
              p_tokens_total   => NULL,
              p_processing_ms  => NULL,
              p_metadata       => NULL
          );
          
          APEX_DEBUG.INFO('‚úì Message saved with ID: ' || v_msg_id);
          
          -- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          -- STEP 4: Return Success Response
          -- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          
          HTP.p(JSON_OBJECT(
              'success' VALUE TRUE,
              'message_id' VALUE v_msg_id,
              'session_id' VALUE v_session_id
          ));
          
      EXCEPTION
          WHEN OTHERS THEN
              APEX_DEBUG.ERROR('ERROR in SAVE_ASSISTANT_MESSAGE: ' || SQLERRM);
              APEX_DEBUG.ERROR('  Session ID attempted: ' || NVL(TO_CHAR(v_session_id), 'NULL'));
              APEX_DEBUG.ERROR('  P114_CHAT_SESSION_ID: ' || NVL(:P114_CHAT_SESSION_ID, 'NULL'));
              
              HTP.p(JSON_OBJECT(
                  'success' VALUE FALSE,
                  'error' VALUE SQLERRM,
                  'session_id' VALUE v_session_id
              ));
              
              RAISE;
      END;

  execution: 
    sequence: 90
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

  configuration: 
    build-option: Commented Out # 123954063565486069

- # ====== Process: SYNC_PROTECTED_ITEMS =======================
  id: 151698110562556308
  identification: 
    name: SYNC_PROTECTED_ITEMS
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      
        -- Force-check protected item by assigning it to itself
        :P114_CHAT_SESSION_ID := :P114_CHAT_SESSION_ID;

  execution: 
    sequence: 170
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

- # ====== Process: GENERATE_REPORT_ISSUE_URL ==================
  id: 151698561619556309
  identification: 
    name: GENERATE_REPORT_ISSUE_URL
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
           vcaller varchar2(30):= 'PROCESS_PAGE'||:APP_PAGE_ID||'.GENERATE_REPORT_ISSUE_URL';
          l_url         VARCHAR2(4000);
          v_entity_id   NUMBER;
          v_issue_level VARCHAR2(20);
      BEGIN
          IF apex_application.g_x01 IS NULL
             OR apex_application.g_x02 IS NULL
          THEN
              RAISE_APPLICATION_ERROR(-20001, 'Missing issue context');
          END IF;
      
          v_entity_id   := TO_NUMBER(apex_application.g_x01);
          v_issue_level := UPPER(apex_application.g_x02);
      
          IF v_issue_level NOT IN ('SESSION','MESSAGE') THEN
              RAISE_APPLICATION_ERROR(-20002, 'Invalid issue level');
          END IF;
      
          l_url := apex_page.get_url(
              p_page   => 116,
              p_items  => 'P116_ENTITY_ID,P116_ISSUE_LEVEL',
              p_values => v_entity_id || ',' || v_issue_level
          );
      
          apex_json.open_object;
          apex_json.write('success', true);
          apex_json.write('url', l_url);
          apex_json.close_object;
      END;

  execution: 
    sequence: 180
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

- # ====== Process: GET_PROJECT_SESSIONS =======================
  id: 151698972720556310
  identification: 
    name: GET_PROJECT_SESSIONS
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
           vcaller varchar2(30):= 'PROCESS_PAGE'||:APP_PAGE_ID||'.GET_PROJECT_SESSIONS';
          v_project_id    NUMBER := TO_NUMBER(apex_application.g_x01);
          v_current_session_id NUMBER := TO_NUMBER(NVL(:P114_CHAT_SESSION_ID, 0));
          v_html          CLOB := '';
          
          CURSOR c_sessions IS
              SELECT 
                  cs.session_id,
                  cs.session_title,
                  cs.message_count,
                  cs.last_activity_date,
                  -- Format last activity
                  CASE 
                      WHEN cs.last_activity_date >= TRUNC(SYSDATE) THEN
                          'Today ' || TO_CHAR(cs.last_activity_date, 'HH24:MI')
                      WHEN cs.last_activity_date >= TRUNC(SYSDATE) - 1 THEN
                          'Yesterday'
                      WHEN cs.last_activity_date >= TRUNC(SYSDATE) - 7 THEN
                          TO_CHAR(cs.last_activity_date, 'Day')
                      ELSE
                          TO_CHAR(cs.last_activity_date, 'Mon DD')
                  END AS last_activity_display
              FROM chat_sessions cs
              WHERE cs.chat_project_id = v_project_id
                AND cs.is_active = 'Y'
              ORDER BY cs.last_activity_date DESC NULLS LAST;
              
      BEGIN
          -- Build sessions HTML
          FOR rec IN c_sessions LOOP
              v_html := v_html || 
                  '<div class="session-item ' || 
                  CASE WHEN rec.session_id = v_current_session_id THEN 'active-session' ELSE '' END ||
                  '" data-session-id="' || rec.session_id || 
                  '" data-project-id="' || v_project_id || 
                  '" onclick="loadSession(' || rec.session_id || ')">' ||
                  '<div class="session-icon">' ||
                      '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">' ||
                          '<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>' ||
                      '</svg>' ||
                  '</div>' ||
                  '<div class="session-info">' ||
                      '<div class="session-title">' || APEX_ESCAPE.HTML(rec.session_title) || '</div>' ||
                      '<div class="session-meta">' ||
                          '<span class="session-date">' || rec.last_activity_display || '</span>';
                          
              -- Add message count badge if > 0
              IF rec.message_count > 0 THEN
                  v_html := v_html || '<span class="message-badge">' || rec.message_count || '</span>';
              END IF;
              
              v_html := v_html || '</div></div>';
              
              -- Add active indicator if current session
              IF rec.session_id = v_current_session_id THEN
                  v_html := v_html || '<span class="active-indicator"></span>';
              END IF;
              
              v_html := v_html || '</div>';
          END LOOP;
          
          -- If no sessions found
          IF v_html IS NULL THEN
              v_html := '<div class="no-sessions-message">' ||
                          '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">' ||
                              '<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>' ||
                          '</svg>' ||
                          'No sessions in this project' ||
                        '</div>';
          END IF;
          
          -- Return HTML
          HTP.PRN(v_html);
          
      EXCEPTION
          WHEN OTHERS THEN
              HTP.PRN('<div class="no-sessions-message">Error loading sessions</div>');
      END;

  execution: 
    sequence: 190
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

- # ====== Process: UPDATE_SESSION_TITLE =======================
  id: 151699321457556311
  identification: 
    name: UPDATE_SESSION_TITLE
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |2
       
      
      DECLARE
           vcaller varchar2(30):= 'PROCESS_PAGE'||:APP_PAGE_ID||'.UPDATE_SESSION_TITLE';
          v_session_id    NUMBER := TO_NUMBER(apex_application.g_x01);
          v_new_title     VARCHAR2(200) := apex_application.g_x02;
          v_user_id       NUMBER:= v('G_USER_ID');
      BEGIN
          -- Validate title
          IF v_new_title IS NULL OR LENGTH(TRIM(v_new_title)) = 0 THEN
              apex_json.open_object;
              apex_json.write('success', FALSE);
              apex_json.write('message', 'Title cannot be empty');
              apex_json.close_object;
              RETURN;
          END IF;
          
       
          
          -- Update session title
          UPDATE  chat_sessions
          SET session_title = TRIM(v_new_title),
              last_activity_date = SYSTIMESTAMP
          WHERE session_id = v_session_id
            AND user_id = v_user_id;
          
          IF SQL%ROWCOUNT = 0 THEN
              ROLLBACK;
              apex_json.open_object;
              apex_json.write('success', FALSE);
              apex_json.write('message', 'Session not found or access denied');
              apex_json.close_object;
              RETURN;
          END IF;
          
          COMMIT;
          
          apex_json.open_object;
          apex_json.write('success', TRUE);
          apex_json.close_object;
          
      EXCEPTION
          WHEN NO_DATA_FOUND THEN
              apex_json.open_object;
              apex_json.write('success', FALSE);
              apex_json.write('message', 'User not found');
              apex_json.close_object;
          WHEN OTHERS THEN
              ROLLBACK;
              apex_json.open_object;
              apex_json.write('success', FALSE);
              apex_json.write('message', SQLERRM);
              apex_json.close_object;
      END;

  execution: 
    sequence: 200
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

- # ====== Process: SAVE_NEW_SESSION ===========================
  id: 151700124313556313
  identification: 
    name: SAVE_NEW_SESSION
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |2
       DECLARE
            vcaller varchar2(30):= 'PROCESS_PAGE'||:APP_PAGE_ID||'.SAVE_NEW_SESSION';
          v_session_id    NUMBER;
          v_user_id       NUMBER := V('G_USER_ID');
          v_project_id    NUMBER :=  :P114_NEW_SESSION_PROJECT_ID ; -- Current project
        -- v_project_id    NUMBER := TO_NUMBER(apex_application.g_x01);
      
          v_session_title VARCHAR2(200) := :P114_NEW_SESSION_TITLE ;
         -- v_session_title VARCHAR2(200) := apex_application.g_x02 ;
      
      BEGIN
          -- Validate inputs
          IF v_session_title IS NULL OR TRIM(v_session_title) IS NULL THEN
              apex_json.open_object;
              apex_json.write('success', FALSE);
              apex_json.write('message', 'Session title is required');
              apex_json.close_object;
              RETURN;
          END IF;
          
          IF v_project_id IS NULL THEN
              apex_json.open_object;
              apex_json.write('success', FALSE);
              apex_json.write('message', 'No active project selected');
              apex_json.close_object;
              RETURN;
          END IF;
          
                 -- Create new session
              v_session_id := chat_session_pkg.new_session(
                  p_provider       => :P114_MODEL,
                  p_model          => :P114_MODEL,
                  p_session_title  => :P114_NEW_SESSION_TITLE,
                  p_user_id        => v('G_USER_ID'),
                  p_app_session_id => :APP_SESSION,
                  p_app_id         => :APP_ID,
                  p_app_page_id    => :APP_PAGE_ID,
                  p_project_id     => v('G_CHAT_PROJECT_ID'),
                  p_tenant_id      => v('G_TENANT_ID')
              );
      
              :P114_NEW_SESSION_ID :=v_session_id;
              :P114_CHAT_SESSION_ID :=v_session_id;
          
          COMMIT;
          
          -- Return success
          apex_json.open_object;
          apex_json.write('success', TRUE);
          apex_json.write('session_id', v_session_id);
          apex_json.write('message', 'Session created successfully');
          apex_json.close_object;
          
      EXCEPTION
          WHEN OTHERS THEN
              ROLLBACK;
              apex_json.open_object;
              apex_json.write('success', FALSE);
              apex_json.write('message', 'Error: ' || SQLERRM);
              apex_json.close_object;
      END;

  execution: 
    sequence: 230
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

- # ====== Process: SAVE_TO_FAVORITES ==========================
  id: 151700530576556314
  identification: 
    name: SAVE_TO_FAVORITES
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
           vcaller varchar2(30):= 'PROCESS_PAGE'||:APP_PAGE_ID||'.SAVE_TO_FAVORITES';
          v_message_id NUMBER := apex_application.g_x01;
          v_session_id NUMBER := apex_application.g_x02;
          v_user_id NUMBER:= v('G_USER_ID');
      BEGIN
       
          
          -- Save to favorites (you may need to create this table)
          INSERT INTO chat_favorites (
              favorite_id,
              chat_session_id,
              chat_message_id,
              user_id,
              created_at
          ) VALUES (
              chat_favorites_seq.NEXTVAL,
              v_session_id,
              v_message_id,
              v_user_id,
              SYSTIMESTAMP
          );
          
          COMMIT;
          
          apex_json.open_object;
          apex_json.write('success', TRUE);
          apex_json.write('message', 'Message saved to favorites');
          apex_json.close_object;
          
      EXCEPTION
          WHEN DUP_VAL_ON_INDEX THEN
              apex_json.open_object;
              apex_json.write('success', FALSE);
              apex_json.write('message', 'Message already in favorites');
              apex_json.close_object;
          WHEN OTHERS THEN
              apex_json.open_object;
              apex_json.write('success', FALSE);
              apex_json.write('error', SQLERRM);
              apex_json.close_object;
      END;

  execution: 
    sequence: 240
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

- # ====== Process: PIN_TO_CONTEXT =============================
  id: 151701392897556316
  identification: 
    name: PIN_TO_CONTEXT
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
           vcaller varchar2(30):= 'PROCESS_PAGE'||:APP_PAGE_ID||'.PIN_TO_CONTEXT';
          v_message_id   NUMBER := apex_application.g_x01;
          v_session_id   NUMBER := apex_application.g_x02;
      
          v_json_array   JSON_ARRAY_T;
      BEGIN
          -- 1. Load existing JSON array or create new one
          SELECT CASE 
                     WHEN pinned_message_ids IS NULL THEN JSON_ARRAY_T()
                     ELSE JSON_ARRAY_T.parse(pinned_message_ids)
                 END
          INTO v_json_array
          FROM chat_sessions
          WHERE session_id = v_session_id
          FOR UPDATE;
      
          -- 2. Append the new pinned message ID
          v_json_array.append(v_message_id);
      
          -- 3. Save it back
          UPDATE chat_sessions
          SET pinned_message_ids = v_json_array.to_clob
          WHERE session_id = v_session_id;
      
          COMMIT;
      
          apex_json.open_object;
          apex_json.write('success', TRUE);
          apex_json.close_object;
      
      EXCEPTION
          WHEN OTHERS THEN
              apex_json.open_object;
              apex_json.write('success', FALSE);
              apex_json.write('error', SQLERRM);
              apex_json.close_object;
      END;
      

  execution: 
    sequence: 260
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

- # ====== Process:  DELETE_MESSAGE ============================
  id: 151701712615556317
  identification: 
    name: ' DELETE_MESSAGE'
    type: Execute Code
    execution-chain: None

  source: 
    location: Local Database
    language: PL/SQL
    pl/sql-code: |
      DECLARE
           vcaller varchar2(30):= 'PROCESS_PAGE'||:APP_PAGE||'.XXXXXXXXX';
          v_message_id NUMBER := apex_application.g_x01;
      BEGIN
          -- Soft delete (mark as deleted)
          UPDATE  chat_Calls
          SET is_deleted = 'Y',
              DELETED_TS = SYSTIMESTAMP 
          WHERE message_id = v_message_id;
          
          COMMIT;
          
          apex_json.open_object;
          apex_json.write('success', TRUE);
          apex_json.close_object;
          
      EXCEPTION
          WHEN OTHERS THEN
              ROLLBACK;
              apex_json.open_object;
              apex_json.write('success', FALSE);
              apex_json.write('error', SQLERRM);
              apex_json.close_object;
      END;

  execution: 
    sequence: 270
    point: Ajax Callback
    run-process: Once Per Page Visit (default)

  configuration: 
    build-option: Commented Out # 123954063565486069

